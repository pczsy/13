<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修.Net Core 3.0 WebAPI && MySQL 8.0搭建详情' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>.Net Core 3.0 WebAPI && MySQL 8.0搭建详情</center></div><div class='banquan'>原文出处:本文由博客园博主冷火不火提供。<br/>
原文连接:https://www.cnblogs.com/mcf52259/p/11707240.html</div><br>
    <p><span style="font-size:12pt"><span style="font-family:微软雅黑">微软在</span><span style="font-family:Consolas">2019</span><span style="font-family:微软雅黑">年</span><span style="font-family:Consolas">9</span><span style="font-family:微软雅黑">月</span><span style="font-family:Consolas">24</span><span style="font-family:微软雅黑">日发布了</span><span style="font-family:Consolas">dotNet Core 3.0</span><span style="font-family:微软雅黑">和</span><span style="font-family:Consolas">C# 8.0</span><span style="font-family:微软雅黑">，添加了许多新</span><span style="font-family:Consolas">Features</span><span style="font-family:微软雅黑">，<a href="https://devblogs.microsoft.com/dotnet/announcing-net-core-3-0/">详情点我</a>。无疑</span><span style="font-family:Consolas">dotNet Core 3.0</span><span style="font-family:微软雅黑">和一个月之后即将发布的</span><span style="font-family:Consolas">dotNet Core 3.1</span><span style="font-family:微软雅黑">对于</span><span style="font-family:Consolas">dotNet</span><span style="font-family:微软雅黑">来说是一个重要的里程碑。</span><span style="font-family:Consolas">
			</span></span></p><p><span style="font-size:12pt"><span style="font-family:微软雅黑">对于</span><span style="font-family:Consolas">MySQL</span><span style="font-family:微软雅黑">而言，现在越来越多的商业公司使用</span><span style="font-family:Consolas">MySQL</span><span style="font-family:微软雅黑">来作为自己的主要数据库，虽然</span><span style="font-family:Consolas">MySQL</span><span style="font-family:微软雅黑">已经迎来了</span><span style="font-family:Consolas">8.0</span><span style="font-family:微软雅黑">的版本，有着更完善的数据能力，更好的性能，但是还是有很多公司在新项目上使用</span><span style="font-family:Consolas">MySQL5.7</span><span style="font-family:微软雅黑">。我在技术上很鄙视这样的做法，一旦使用的老技术</span><span style="font-family:Consolas">Out of support</span><span style="font-family:微软雅黑">，对已有项目的改动和迁移所做的努力将会是当初学习新和试错的</span><span style="font-family:Consolas">N</span><span style="font-family:微软雅黑">倍。</span><span style="font-family:Consolas">
			</span></span></p><p><span style="font-size:12pt"><span style="font-family:微软雅黑">言归正传，今天来记录一下使用</span><span style="font-family:Consolas">dotNet Core 3.0</span><span style="font-family:微软雅黑">的</span><span style="font-family:Consolas">WebAPI</span><span style="font-family:微软雅黑">和</span><span style="font-family:Consolas">MySQL 8.0</span><span style="font-family:微软雅黑">的使用（本次实践基于已有数据库，没有完成数据库的需要使用</span><span style="font-family:Consolas">Workbench</span><span style="font-family:微软雅黑">或</span><span style="font-family:Consolas">Navicat</span><span style="font-family:微软雅黑">搭建数据库）。</span><span style="font-family:Consolas">
			</span></span></p><ol><li><span style="font-size:14pt"><strong><span style="font-family:微软雅黑">准备工作</span><span style="font-family:Consolas">
					</span></strong></span></li></ol><p><span style="font-size:12pt"><span style="font-family:微软雅黑">准备工作的目的是搭建一个便于我们调试的工程环境。考虑到以后用到微服务的可能，这里并不能用硬编码（</span><span style="font-family:Consolas">Hardcoding</span><span style="font-family:微软雅黑">）写死启动的地址和端口，以下工作就是为了达到指定端口启动的目的。</span><span style="font-family:Consolas">
			</span></span></p><ol><li><div><span style="font-size:12pt"><strong><span style="font-family:微软雅黑">建立工程</span><span style="font-family:Consolas">
						</span></strong></span></div><p><span style="font-size:12pt"><span style="font-family:微软雅黑">平常一些小项目我都用</span><span style="font-family:Consolas">VS Code</span><span style="font-family:微软雅黑">来创建工程了，但这次我使用</span><span style="font-family:Consolas">Visual Studio 2019 16.3.5</span><span style="font-family:微软雅黑">（</span><span style="font-family:Consolas">dotNet Core 3.0</span><span style="font-family:微软雅黑">需要至少</span><span style="font-family:Consolas">16.3</span><span style="font-family:微软雅黑">的版本，如果用</span><span style="font-family:Consolas">VS Code</span><span style="font-family:微软雅黑">需要最新的</span><span style="font-family:Consolas">C#</span><span style="font-family:微软雅黑">插件）创建工程。</span><span style="font-family:Consolas">
					</span></span></p><p style="text-align: center"><img src="./images/.Net Core 3.0 WebAPI && MySQL 8.0搭建详情0.png" alt=""/><span style="font-family:Consolas; font-size:12pt">
				</span></p><p><span style="font-size:12pt"><span style="font-family:微软雅黑">为了日后上微服务可能，我们并不能写死项目的启动地址和端口；而且得益于</span><span style="font-family:Consolas">dotNet Core</span><span style="font-family:微软雅黑">自带</span><span style="font-family:Consolas">Kestrel</span><span style="font-family:微软雅黑">，所以我并不打算使用</span><span style="font-family:Consolas">IIS Express</span><span style="font-family:微软雅黑">作为调试使用。在"解决方案次源管理器"中右击项目名——"属性"——"调试"——"配置文件"中选择项目名对应项——"启动"选择"项目"，""应用程序参数先不填，这个后面会用到。</span><span style="font-family:Consolas">
					</span></span></p><p style="text-align: center"><img src="./images/.Net Core 3.0 WebAPI && MySQL 8.0搭建详情1.png" alt=""/><span style="font-family:Consolas; font-size:12pt">
				</span></p><p>
 </p></li><li><div><span style="font-size:12pt"><strong><span style="font-family:微软雅黑">添加启动参数</span><span style="font-family:Consolas">
						</span></strong></span></div><p><span style="font-size:12pt"><span style="font-family:微软雅黑">要想指定地址和端口启动，我们可以用硬编码；也可以读取</span><span style="font-family:Consolas">Json</span><span style="font-family:微软雅黑">配置；也可以像我一样，在程序启动时传入参数。下面介绍如何通过重写</span><span style="font-family:Consolas">Program.cs</span><span style="font-family:微软雅黑">来读取程序的启动参数。</span><span style="font-family:Consolas">
					</span></span></p><p><span style="font-size:12pt"><span style="font-family:微软雅黑">可以删除</span><span style="font-family:Consolas">CreateHostBuilder</span><span style="font-family:微软雅黑">方法，并填加如下方法：</span><span style="font-family:Consolas">
					</span></span></p><ol><li><div style="background: white"><span style="color:#006699; font-family:Consolas; font-size:12pt"><strong>public</strong><span style="color:black"> <span style="color:#006699"><strong>static</strong><span style="color:black"> IWebHost BuildWebHost(<span style="color:#006699"><strong>string</strong><span style="color:black">[] args)  <span style="color:#5c5c5c">
												</span></span></span></span></span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">{  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">    var config = <span style="color:#006699"><strong>new</strong><span style="color:black"> ConfigurationBuilder()  <span style="color:#5c5c5c">
									</span></span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">    .AddCommandLine(args)  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">    .Build();  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">    <span style="color:#006699"><strong>string</strong><span style="color:black"> ip = config[<span style="color:blue">"ip"<span style="color:black">];  <span style="color:#5c5c5c">
											</span></span></span></span></span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">    <span style="color:#006699"><strong>string</strong><span style="color:black"> port = config[<span style="color:blue">"port"<span style="color:black">];  <span style="color:#5c5c5c">
											</span></span></span></span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">    Console.WriteLine($<span style="color:blue">"ip={ip}:port={port}"<span style="color:black">);  <span style="color:#5c5c5c">
									</span></span></span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">    <span style="color:#006699"><strong>return</strong><span style="color:black"> WebHost.CreateDefaultBuilder(args)  <span style="color:#5c5c5c">
									</span></span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">    .UseStartup&lt;Startup&gt;()  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">    .UseUrls($<span style="color:blue">"http://{ip}:{port}"<span style="color:black">)  <span style="color:#5c5c5c">
									</span></span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">    .Build();  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">}  <span style="color:#5c5c5c">
							</span></span></div></li></ol><p><span style="font-size:12pt"><span style="font-family:微软雅黑">修改</span><span style="font-family:Consolas">Main</span><span style="font-family:微软雅黑">方法为：</span><span style="font-family:Consolas">
					</span></span></p><ol><li><div style="background: white"><span style="color:#006699; font-family:Consolas; font-size:12pt"><strong>public</strong><span style="color:black"> <span style="color:#006699"><strong>static</strong><span style="color:black"> <span style="color:#006699"><strong>void</strong><span style="color:black"> Main(<span style="color:#006699"><strong>string</strong><span style="color:black">[] args)  <span style="color:#5c5c5c">
														</span></span></span></span></span></span></span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">{  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">    BuildWebHost(args).Run();  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">}  <span style="color:#5c5c5c">
							</span></span></div></li></ol><p>
 </p><p><span style="font-size:12pt"><span style="font-family:微软雅黑">在项目"属性"页——"调试"选项卡——"应用程序参数"中填写相应参数，例如我这里填写"</span><span style="font-family:Consolas">—ip 127.0.0.1 –port 8000</span><span style="font-family:微软雅黑">"。</span><span style="font-family:Consolas">
					</span></span></p><p style="text-align: center"><img src="./images/.Net Core 3.0 WebAPI && MySQL 8.0搭建详情2.png" alt=""/><span style="font-family:Consolas; font-size:12pt">
				</span></p><p><span style="font-size:12pt"><span style="font-family:微软雅黑">在调试按钮的下拉选项中选择项目名。</span><span style="font-family:Consolas">
					</span></span></p><p style="text-align: center"><img src="./images/.Net Core 3.0 WebAPI && MySQL 8.0搭建详情3.png" alt=""/><span style="font-family:Consolas; font-size:12pt">
				</span></p><p><span style="font-size:12pt"><span style="font-family:微软雅黑">到此，按</span><span style="font-family:Consolas">F5</span><span style="font-family:微软雅黑">或</span><span style="font-family:Consolas">Ctrl+F5</span><span style="font-family:微软雅黑">启动调试，浏览器会跳转到我们指定的地址和端口。</span><span style="font-family:Consolas">
					</span></span></p><ol><li><span style="font-size:14pt"><strong><span style="font-family:微软雅黑">添加数据库</span><span style="font-family:Consolas">
							</span></strong></span></li></ol><p><span style="font-size:12pt"><span style="font-family:微软雅黑">官方教程并没有给出添加</span><span style="font-family:Consolas">MySQL</span><span style="font-family:微软雅黑">的实例，但其过程和</span><span style="font-family:Consolas">SQL Server</span><span style="font-family:微软雅黑">是一样的。</span><span style="font-family:Consolas">
					</span></span></p></li><li><div><span style="font-size:12pt"><strong><span style="font-family:微软雅黑">准备工作</span><span style="font-family:Consolas">
						</span></strong></span></div><p><span style="font-size:12pt"><span style="font-family:微软雅黑">添加</span><span style="font-family:Consolas">NuGet</span><span style="font-family:微软雅黑">包：在"程序包管理器控制台"中键入：</span><span style="font-family:Consolas">
					</span></span></p><p style="text-align: center"><span style="color:black; font-family:Consolas; font-size:12pt"><span style="background-color:white">dotnet <span style="color:#006699"><strong>add</strong><span style="color:black"> package MySql.Data.EntityFrameworkCore <span style="color:#008200">--version 8.0.18</span></span></span></span>
				</span></p><p><span style="font-size:12pt"><span style="font-family:微软雅黑">我并没有使用</span><span style="font-family:Consolas">Pomelo</span><span style="font-family:微软雅黑">库，而用的是</span><span style="font-family:Consolas">MySQL</span><span style="font-family:微软雅黑">官方库，截止到当天是</span><span style="font-family:Consolas">8.0.18</span><span style="font-family:微软雅黑">。</span><span style="font-family:Consolas">
					</span></span></p><p><span style="font-size:12pt"><span style="font-family:微软雅黑">创建如下几个目录：</span><span style="font-family:Consolas">
					</span></span></p><p><span style="font-size:12pt"><span style="font-family:Consolas">Data</span><span style="font-family:微软雅黑">——用来存放数据库上下文等数据文件</span><span style="font-family:Consolas">
					</span></span></p><p><span style="font-size:12pt"><span style="font-family:Consolas">Models</span><span style="font-family:微软雅黑">——用来存放数据模型</span><span style="font-family:Consolas">
					</span></span></p></li><li><div><span style="font-size:12pt"><strong><span style="font-family:微软雅黑">创建模型</span><span style="font-family:Consolas">
						</span></strong></span></div><p><span style="font-size:12pt"><span style="font-family:微软雅黑">在</span><span style="font-family:Consolas">Models</span><span style="font-family:微软雅黑">目录下创建与数据库匹配的数据模型</span><span style="font-family:Consolas">TestModel.cs</span><span style="font-family:微软雅黑">。如要指定主键，可以用</span><span style="font-family:Consolas">[Key]</span><span style="font-family:微软雅黑">属性在模型中指定。</span><span style="font-family:Consolas">
					</span></span></p><ol><li><div style="background: white"><span style="color:#006699; font-family:Consolas; font-size:12pt"><strong>using</strong><span style="color:black"> System;    <span style="color:#5c5c5c">
								</span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:#006699; font-family:Consolas; font-size:12pt"><strong>using</strong><span style="color:black"> System.ComponentModel.DataAnnotations;    <span style="color:#5c5c5c">
								</span></span></span></div></li><li><div style="background: white"><span style="color:#006699; font-family:Consolas; font-size:12pt"><strong>namespace</strong><span style="color:black"> LRMS.Server    <span style="color:#5c5c5c">
								</span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">{    <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">    <span style="color:#006699"><strong>public</strong><span style="color:black"> <span style="color:#006699"><strong>class</strong><span style="color:black"> TestModel    <span style="color:#5c5c5c">
											</span></span></span></span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">    {    <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">        [Key]    <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">        <span style="color:#006699"><strong>public</strong><span style="color:black"> <span style="color:#006699"><strong>int</strong><span style="color:black"> uid { <span style="color:#006699"><strong>get</strong><span style="color:black">; <span style="color:#006699"><strong>set</strong><span style="color:black">; }    <span style="color:#5c5c5c">
															</span></span></span></span></span></span></span></span></span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">        <span style="color:#006699"><strong>public</strong><span style="color:black"> <span style="color:#006699"><strong>string</strong><span style="color:black"> username { <span style="color:#006699"><strong>get</strong><span style="color:black">; <span style="color:#006699"><strong>set</strong><span style="color:black">; }    <span style="color:#5c5c5c">
															</span></span></span></span></span></span></span></span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">        <span style="color:#006699"><strong>public</strong><span style="color:black"> <span style="color:#006699"><strong>string</strong><span style="color:black"> password { <span style="color:#006699"><strong>get</strong><span style="color:black">; <span style="color:#006699"><strong>set</strong><span style="color:black">; }    <span style="color:#5c5c5c">
															</span></span></span></span></span></span></span></span></span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">    }    <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">}  <span style="color:#5c5c5c">
							</span></span></div></li></ol><p>
 </p></li><li><div><span style="font-size:12pt"><strong><span style="font-family:微软雅黑">创建数据库上下文</span><span style="font-family:Consolas">
						</span></strong></span></div><p><span style="font-size:12pt"><span style="font-family:微软雅黑">在</span><span style="font-family:Consolas">Data</span><span style="font-family:微软雅黑">目录下创建数据库上下文</span><span style="font-family:Consolas">TestDbContext.cs</span><span style="font-family:微软雅黑">。在上下文中使用</span><span style="font-family:Consolas">EF Core</span><span style="font-family:微软雅黑">中的</span><span style="font-family:Consolas">DbSet</span><span style="font-family:微软雅黑">类型创建对应的与数据表名称（可忽略大小写）相应的实例。</span><span style="font-family:Consolas">
					</span></span></p><ol style="margin-left: 42pt"><li><div style="background: white"><span style="color:#006699; font-family:Consolas; font-size:12pt"><strong>using</strong><span style="color:black"> Microsoft.EntityFrameworkCore;    <span style="color:#5c5c5c">
								</span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:#006699; font-family:Consolas; font-size:12pt"><strong>namespace</strong><span style="color:black"> LRMS.Server    <span style="color:#5c5c5c">
								</span></span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">{    <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">    <span style="color:#006699"><strong>public</strong><span style="color:black"> <span style="color:#006699"><strong>class</strong><span style="color:black"> UserInfoDbContext : DbContext    <span style="color:#5c5c5c">
											</span></span></span></span></span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">    {    <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">        <span style="color:#006699"><strong>public</strong><span style="color:black"> UserInfoDbContext(DbContextOptions options) : <span style="color:#006699"><strong>base</strong><span style="color:black">(options) { }    <span style="color:#5c5c5c">
											</span></span></span></span></span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">        <span style="color:#006699"><strong>public</strong><span style="color:black"> DbSet&lt;TestModel&gt; User_Login { <span style="color:#006699"><strong>get</strong><span style="color:black">; <span style="color:#006699"><strong>set</strong><span style="color:black">; }    <span style="color:#5c5c5c">
													</span></span></span></span></span></span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">    }    <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">}    <span style="color:#5c5c5c">
							</span></span></div></li></ol></li><li><div><span style="font-size:12pt"><strong><span style="font-family:微软雅黑">添加数据库连接字</span><span style="font-family:Consolas">
						</span></strong></span></div><p><span style="font-size:12pt"><span style="font-family:微软雅黑">打开在工程的根目录下的</span><span style="font-family:Consolas">appsettings.json</span><span style="font-family:微软雅黑">。替换以下对象：</span><span style="font-family:Consolas">
					</span></span></p><ol><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">{  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">    <span style="color:blue">"ConnectionStrings"<span style="color:black">: {  <span style="color:#5c5c5c">
									</span></span></span></span></div></li><li><div style="background: white"><span style="color:black; font-size:12pt"><span style="font-family:Consolas">        <span style="color:blue">"</span></span><span style="font-family:宋体">连接字名称</span><span style="color:blue"><span style="font-family:Consolas">"<span style="color:black">: <span style="color:blue">"Server=</span></span></span><span style="font-family:宋体">数据库地址</span><span style="font-family:Consolas">;uid=</span><span style="font-family:宋体">数据库账户</span><span style="font-family:Consolas">;pwd=</span><span style="font-family:宋体">数据库密码</span><span style="font-family:Consolas">;database=</span><span style="font-family:宋体">数据库</span><span style="font-family:Consolas">Schema;charset=utf8;SslMode=None;"<span style="color:black">,  <span style="color:#5c5c5c">
										</span></span></span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">    },  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">    <span style="color:blue">"Logging"<span style="color:black">: {  <span style="color:#5c5c5c">
									</span></span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">        <span style="color:blue">"LogLevel"<span style="color:black">: {  <span style="color:#5c5c5c">
									</span></span></span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">            <span style="color:blue">"Default"<span style="color:black">: <span style="color:blue">"Information"<span style="color:black">,  <span style="color:#5c5c5c">
											</span></span></span></span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">            <span style="color:blue">"Microsoft"<span style="color:black">: <span style="color:blue">"Warning"<span style="color:black">,  <span style="color:#5c5c5c">
											</span></span></span></span></span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">            <span style="color:blue">"Microsoft.Hosting.Lifetime"<span style="color:black">: <span style="color:blue">"Information"<span style="color:black">  <span style="color:#5c5c5c">
											</span></span></span></span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">        }  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">    },  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">    <span style="color:blue">"AllowedHosts"<span style="color:black">: <span style="color:blue">"*"<span style="color:black">  <span style="color:#5c5c5c">
											</span></span></span></span></span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">}  <span style="color:#5c5c5c">
							</span></span></div></li></ol><p>
 </p><p><span style="font-size:12pt"><span style="font-family:微软雅黑">打开</span><span style="font-family:Consolas">Startup.cs</span><span style="font-family:微软雅黑">，在</span><span style="font-family:Consolas">CoinfigureServices</span><span style="font-family:微软雅黑">方法中添加如下代码：</span><span style="font-family:Consolas">
					</span></span></p><ol><li><div style="background: white"><span style="color:#006699; font-family:Consolas; font-size:12pt"><strong>public</strong><span style="color:black"> <span style="color:#006699"><strong>void</strong><span style="color:black"> ConfigureServices(IServiceCollection services)  <span style="color:#5c5c5c">
										</span></span></span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">{  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">    services.AddControllers();  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">    services.AddDbContext&lt;UserInfoDbContext&gt;(options =&gt;  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">    {  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-size:12pt"><span style="font-family:Consolas">        options.UseMySQL(Configuration.GetConnectionString(<span style="color:blue">"</span></span><span style="font-family:宋体">连接字名称</span><span style="color:blue; font-family:Consolas">"<span style="color:black">));  <span style="color:#5c5c5c">
									</span></span></span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">    });  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">}  <span style="color:#5c5c5c">
							</span></span></div></li></ol><p><span style="font-size:12pt"><span style="font-family:微软雅黑">到此，数据库的使用部分结束了。</span><span style="font-family:Consolas">
					</span></span></p><ol><li><span style="font-size:14pt"><strong><span style="font-family:微软雅黑">后续</span><span style="font-family:Consolas">
							</span></strong></span></li></ol><p><span style="font-size:12pt"><span style="font-family:微软雅黑">为了安全，防止泄漏，在控制器中我们并不能直接使用数据库上下文，下面的代码展示了一种简单的处理。</span><span style="font-family:Consolas">
					</span></span></p><ol><li><div style="background: white"><span style="color:#008200; font-size:12pt"><span style="font-family:Consolas">// </span><span style="font-family:宋体">创建私有、只读的数据库上下文实例</span><span style="color:black; font-family:Consolas">  <span style="color:#5c5c5c">
								</span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:#006699; font-family:Consolas; font-size:12pt"><strong>private</strong><span style="color:black"> <span style="color:#006699"><strong>readonly</strong><span style="color:black"> UserInfoDbContext _db;  <span style="color:#5c5c5c">
										</span></span></span></span></span></div></li><li><div style="background: white"><span style="color:#008200; font-size:12pt"><span style="font-family:Consolas">// </span><span style="font-family:宋体">构造函数中为其赋值</span><span style="color:black; font-family:Consolas">  <span style="color:#5c5c5c">
								</span></span></span></div></li><li><div style="background: #f8f8f8"><span style="color:#006699; font-family:Consolas; font-size:12pt"><strong>public</strong><span style="color:black"> UserLoginController(UserInfoDbContext db)  <span style="color:#5c5c5c">
								</span></span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">{  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: #f8f8f8"><span style="color:black; font-family:Consolas; font-size:12pt">    _db = db;  <span style="color:#5c5c5c">
							</span></span></div></li><li><div style="background: white"><span style="color:black; font-family:Consolas; font-size:12pt">}  <span style="color:#5c5c5c">
							</span></span></div></li></ol><p>
 </p><p><span style="font-family:微软雅黑; font-size:12pt">以上。</span></p></li></ol>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>