<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修【Json】1.Newtonsoft—Json.NET常用方法简述' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>【Json】1.Newtonsoft—Json.NET常用方法简述</center></div><div class='banquan'>原文出处:本文由博客园博主裤兜提供。<br/>
原文连接:https://www.cnblogs.com/512kd/p/11774756.html</div><br>
    <hr /><hr />
<p style="text-align: center;">&nbsp;</p>
<h1 style="text-align: center;"><span style="font-size: 18pt;"><strong>Json.NET常用方法汇总（可解决日常百分之90的需求）</strong></span></h1>
<p>&nbsp;</p>
<h2>0.Json.NET基础用法</h2>
<hr />
<p>&nbsp;<span style="font-size: 16px;">　　首先去<a title="Json.NET官方网站" href="https://www.newtonsoft.com/json" target="_blank">官网</a>下载最新的Newtonsoft.Json.dll（也可以使用VS自带的NuGet搜索Json.NET下载（下载下图第二个））并引用至项目。</span></p>
<p><span style="font-size: 16px;">　　<img src="./images/【Json】1.Newtonsoft—Json.NET常用方法简述0.png" alt="" width="623" height="222" /></span></p>
<ul>
<li><span style="font-size: 16px;"><strong>（1）序列化实体类（将实体类对象序列化为Json字符串）</strong></span></li>
</ul>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;"><span style="color: #0000ff;">using</span><span style="color: #000000;"> System;
</span><span style="color: #0000ff;">using</span><span style="color: #000000;"> Newtonsoft.Json;

</span><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> Json_NET_Test
{
    </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
    <span style="color: #808080;">///</span><span style="color: #008000;"> 定义一个实体类
    </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Student
    {
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> Name;
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> Age;
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> Class;
    }
    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {
        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建实体类对象           </span>
            Student stu = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Student
            {
                Name </span>= <span style="color: #800000;">"</span><span style="color: #800000;">老王</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                Age </span>= <span style="color: #800080;">99</span><span style="color: #000000;">,
                Class </span>= <span style="color: #800000;">"</span><span style="color: #800000;">三班</span><span style="color: #800000;">"</span><span style="color: #000000;">
            };
            </span><span style="color: #008000;">//</span><span style="color: #008000;">开始序列化</span>
            <span style="color: #0000ff;">string</span> jsonStr =<span style="color: #000000;"> JsonConvert.SerializeObject(stu, Formatting.Indented);
            Console.WriteLine(jsonStr);
        }
    }
}</span></span></pre>
</div>
<p>　　结果：</p>
<p>　　<img src="./images/【Json】1.Newtonsoft—Json.NET常用方法简述1.png" alt="" width="168" height="136" /></p>
<ul>
<li><span style="font-size: 16px;"><strong>（2）反序列化（将Json字符串反序列化为实体类对象）</strong></span></li>
</ul>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;"><span style="color: #0000ff;">using</span><span style="color: #000000;"> System;
</span><span style="color: #0000ff;">using</span><span style="color: #000000;"> Newtonsoft.Json;

</span><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> Json_NET_Test
{
    </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
    <span style="color: #808080;">///</span><span style="color: #008000;"> 定义一个实体类
    </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Student
    {
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> Name;
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> Age;
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> Class;
    }
    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {
        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">Json字符串</span>
            <span style="color: #0000ff;">string</span> jsonStr = <span style="color: #800000;">"</span><span style="color: #800000;">{\"Name\": \"老王\",\"Age\": 99,\"Class\": \"三班\"}</span><span style="color: #800000;">"</span><span style="color: #000000;">;
            </span><span style="color: #008000;">//</span><span style="color: #008000;">开始反序列化</span>
            Student stu = JsonConvert.DeserializeObject&lt;Student&gt;<span style="color: #000000;">(jsonStr);
        }
    }
}</span></span></pre>
</div>
<p>&nbsp;</p>
<h2>1.序列化与反序列化时忽略某些属性</h2>
<hr />
<ul>
<li>&nbsp;<strong><span style="font-size: 16px;">（1）忽略类内所有属性</span></strong></li>
</ul>
<p><span style="font-size: 16px;"> 　　[JsonObject(MemberSerialization.OptIn)]用于在序列化与反序列化时忽略一个类里所有的属性，</span><span style="font-size: 16px;">只有当在类内属性上打特性标签[JsonProperty]时才支持序列化与反序列化。</span><span style="font-size: 16px;">所以[JsonObject(MemberSerialization.OptIn)]常用于与[JsonProperty]配合使用。</span></p>
<p><span style="font-size: 16px;"> 　　例：</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;"><span style="color: #000000;">[JsonObject(MemberSerialization.OptIn)]
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Person
{
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Age { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

    [JsonProperty]
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Sex { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">bool</span> IsMarry { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

    </span><span style="color: #0000ff;">public</span> DateTime Birthday { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
}</span></span></pre>
</div>
<p>&nbsp;</p>
<ul>
<li><strong><span style="font-size: 16px;">（2）序列化所有属性（默认）</span></strong></li>
</ul>
<p><span style="font-size: 16px;"> 　　默认实体类上默认打着[JsonObject(MemberSerialization.OptOut)]特性标签（可以省略不写），</span><span style="font-size: 16px;">如果要忽略某些属性，要在属性上打[JsonIgnore]。</span></p>
<p><span style="font-size: 16px;"> 　　例：</span></p>
<div>
<div>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;"><span style="color: #000000;">[JsonObject(MemberSerialization.OptOut)]
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Person
{
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Age { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Sex { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

    [JsonIgnore]
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">bool</span> IsMarry { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

    </span><span style="color: #0000ff;">public</span> DateTime Birthday { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
}</span></span></pre>
</div>
</div>
</div>
<p>&nbsp;</p>
<ul>
<li><span style="font-size: 16px;"><strong>（3）动态控制实体类属性的是否忽略序列化（默认）</strong></span></li>
</ul>
<p><span style="font-size: 16px;">　　当某些条件下需要序列化A属性和B属性，某些情况下需要忽略A属性与B属性，我们该怎么做？</span><br /><span style="font-size: 16px;">    　　答：使用JsonSerializerSettings设置某实体类对象要忽略序列化的属性（配合if与else控制属性的动态忽略）。</span></p>
<p><span style="font-size: 16px;">　　例：以下方式忽略p对象的Age属性与IsMarry属性：</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;">　　JsonSerializerSettings jsetting=<span style="color: #0000ff;">new</span><span style="color: #000000;"> JsonSerializerSettings();
　　jsetting.ContractResolver </span>= <span style="color: #0000ff;">new</span> LimitPropsContractResolver(<span style="color: #0000ff;">new</span> <span style="color: #0000ff;">string</span>[] { <span style="color: #800000;">"</span><span style="color: #800000;">Age</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">IsMarry</span><span style="color: #800000;">"</span><span style="color: #000000;"> });
　　Console.WriteLine(JsonConvert.SerializeObject(p, Formatting.Indented, jsetting));</span></span></pre>
</div>
<hr />
<p>&nbsp;</p>
<h2><span style="font-size: 14pt;"><strong>2.默认值处理</strong></span></h2>
<hr />
<ul>
<li>&nbsp;<strong><span style="font-size: 16px;">（1）设置属性默认值</span></strong></li>
</ul>
<p><span style="font-size: 16px;"> 　　在属性上打 [DefaultValue("xxx")]</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 14pt;"><strong>3.空值处理</strong></span></p>
<hr />
<ul>
<li>&nbsp;<strong><span style="font-size: 16px;">（1）不序列化为null的属性（使用JsonSerializerSettings方式）</span></strong></li>
</ul>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;">    Person p = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Person 
    { 
         room </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">,
         Age </span>= <span style="color: #800080;">10</span><span style="color: #000000;">, 
         Name </span>= <span style="color: #800000;">"</span><span style="color: #800000;">张三丰</span><span style="color: #800000;">"</span><span style="color: #000000;">, 
         Sex </span>= <span style="color: #800000;">"</span><span style="color: #800000;">男</span><span style="color: #800000;">"</span><span style="color: #000000;">, 
         IsMarry </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">, 
         Birthday </span>= <span style="color: #0000ff;">new</span> DateTime(<span style="color: #800080;">1991</span>, <span style="color: #800080;">1</span>, <span style="color: #800080;">2</span><span style="color: #000000;">) 
    };
    JsonSerializerSettings jsetting</span>=<span style="color: #0000ff;">new</span><span style="color: #000000;"> JsonSerializerSettings();
    jsetting.NullValueHandling </span>=<span style="color: #000000;"> NullValueHandling.Ignore;
    Console.WriteLine(JsonConvert.SerializeObject(p, Formatting.Indented, jsetting));</span></span></pre>
</div>
<p><span style="font-size: 16px;"><strong> 　　ps：</strong>使用这种方式可能bool为false的也无法序列，最后的结果只包含Birthday、Sex、Name、Age。</span></p>
<p>&nbsp;</p>
<ul>
<li><strong><span style="font-size: 16px;"> （2）不序列化为null的属性（使用特性标签方式）</span></strong></li>
</ul>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;">[JsonProperty(NullValueHandling=<span style="color: #000000;">NullValueHandling.Ignore)]
</span><span style="color: #0000ff;">public</span> Room room { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span>; }</span></pre>
</div>
<p>&nbsp;</p>
<h2><span style="font-size: 14pt;"><strong>4.序列化私有成员</strong></span></h2>
<hr />
<p>&nbsp;<span style="font-size: 16px;">　　因为默认只序列化public的成员，所以如果想序列化private成员，</span><span style="font-size: 16px;">要在实体类的属性上打[JsonProperty]标签。</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;"><span style="color: #000000;">[JsonProperty]
</span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span> Height { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span>; }</span></pre>
</div>
<hr />
<p>&nbsp;</p>
<p><strong><span style="font-size: 14pt;">5.自定义序列化名称</span></strong></p>
<hr />
<p>&nbsp;<span style="font-size: 14pt;"><span style="font-size: 16px;">　　在序列化与反序列化时可以自定义序列化出字符串的属性名称，如下代码可以将实体类的Name属性序列化为CName属性，并且可以将Json中的CName反序列化为当前实体类的Name属性。（双向）</span></span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;">[JsonProperty(PropertyName = <span style="color: #800000;">"</span><span style="color: #800000;">CName</span><span style="color: #800000;">"</span><span style="color: #000000;">)]
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span>; }</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-size: 14pt;"><strong>6.日期处理</strong></span></p>
<hr />
<ul>
<li><strong><span style="font-size: 16px;">（1）解决方案1：在可以动Model代码的情况下</span></strong></li>
</ul>
<p><span style="font-size: 16px;"> 　　系统自带的DateTime会格式化成iso日期标准，</span><span style="font-size: 16px;">但是实际使用过程中大多数使用的可能是yyyy-MM-dd 或者yyyy-MM-dd HH:mm:ss两种格式的日期，</span><span style="font-size: 16px;">解决办法是可以将DateTime类型改成string类型自己格式化好，然后在序列化。</span><br /><span style="font-size: 16px;">    　　例：</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;">    [JsonProperty(PropertyName = <span style="color: #800000;">"</span><span style="color: #800000;">startTime</span><span style="color: #800000;">"</span><span style="color: #000000;">)]//因为默认只序列化public属性，所以要打上JsonProperty标签并且声明名称
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">string</span> m_StartTime{<span style="color: #0000ff;">get</span>;<span style="color: #0000ff;">set</span><span style="color: #000000;">;}

    [JsonIgnore]//这个标签用于在序列化与反序列化时忽略StartTime属性
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> DateTime StartTime
    {
        </span><span style="color: #0000ff;">get</span>{ <span style="color: #0000ff;">return</span><span style="color: #000000;"> Convert.ToDateTime(m_StartTime); }
        </span><span style="color: #0000ff;">set</span><span style="color: #000000;">
        {
            DateTime time </span>=<span style="color: #000000;"> value;
            m_StartTime </span>= time.ToString(<span style="color: #800000;">"</span><span style="color: #800000;">yyyy-MM-dd</span><span style="color: #800000;">"</span>);<span style="color: #008000;">//</span><span style="color: #008000;">这里写自己想要的格式</span>
<span style="color: #000000;">        }
    }</span></span></pre>
</div>
<p><span style="font-size: 16px;"><strong> 　　ps:</strong>代码思路是不去序列化StartTime属性，而去序列化string类型的m_StartTime属性（m_StartTime相当于StartTime属性的私有字段）。</span></p>
<p>&nbsp;</p>
<ul>
<li><strong><span style="font-size: 16px;"> （2）解决方案2：使用DateTimeConverterBase</span></strong></li>
</ul>
<p><span style="font-size: 16px;"> 　　Json.Net提供了IsoDateTimeConverter日期转换这个类，可以通过JsnConverter实现相应的日期转换</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;">[JsonConverter(<span style="color: #0000ff;">typeof</span><span style="color: #000000;">(IsoDateTimeConverter))]
</span><span style="color: #0000ff;">public</span> DateTime Birthday { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span>; }</span></pre>
</div>
<p><span style="font-size: 16px;">　　但是IsoDateTimeConverter日期格式（yyyy-MM-ddTHH:mm:ss）不是我们想要的，</span><span style="font-size: 16px;">我们可以继承该类实现自己的日期</span><br /><span style="font-size: 16px;">    　　例：</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;">    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ChinaDateTimeConverter : DateTimeConverterBase
    {
        </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> IsoDateTimeConverter dtConverter = <span style="color: #0000ff;">new</span> IsoDateTimeConverter { DateTimeFormat = <span style="color: #800000;">"</span><span style="color: #800000;">yyyy-MM-dd</span><span style="color: #800000;">"</span><span style="color: #000000;"> };

        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">object</span> ReadJson(JsonReader reader, Type objectType, <span style="color: #0000ff;">object</span><span style="color: #000000;"> existingValue, JsonSerializer serializer)
        {
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> dtConverter.ReadJson(reader, objectType, existingValue, serializer);
        }

        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">void</span> WriteJson(JsonWriter writer, <span style="color: #0000ff;">object</span><span style="color: #000000;"> value, JsonSerializer serializer)
        {
            dtConverter.WriteJson(writer, value, serializer);
        }
    }</span></span></pre>
</div>
<p><span style="font-size: 16px;"> 　　使用方式：</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;">[JsonConverter(<span style="color: #0000ff;">typeof</span><span style="color: #000000;">(ChinaDateTimeConverter))]
</span><span style="color: #0000ff;">public</span> DateTime Birthday { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span>; }</span></pre>
</div>
<p>&nbsp;</p>
<p><strong><span style="font-size: 14pt;">7.以驼峰命名法序列化</span></strong></p>
<hr />
<p>&nbsp;<span style="font-size: 16px;">　　有时我们会碰到这种需求，比如我们代码里实体类型的属性名称均是以大写字母开头，如Name、StartTime等，但是要求我们序列出的Json字符串的属性名称要以小写字母开头，如name、startTime、endTime等。我们可以使用如下代码解决</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;">JsonSerializerSettings setting = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JsonSerializerSettings();
setting.ContracResolver </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> CamelCasePropertyNamesContractResolver();
</span><span style="color: #0000ff;">string</span> jsonStr = JsonConvert.Serializeobject(p, Newtonsoft.json.Formatting.Indented, setting);</span></pre>
</div>
<p><span style="font-size: 16px;"> 　　这样子的话，在序列实体类对象p的属性时，属性名称将由PersonName转换为personName。</span></p>
<p>&nbsp;</p>
<p><strong><span style="font-size: 14pt;">8.枚举的序列化</span></strong></p>
<hr />
<p>&nbsp;<span style="font-size: 16px;">　　枚举默认序列化为枚举的Int值，如果想要序列化为枚举string值，使用如下方式</span></p>
<div class="cnblogs_code">
<div>
<div><span style="font-size: 14px;">　　[JsonConverter(typeof(StringEnumConverter))]</span></div>
<div><span style="font-size: 14px;">　　public&nbsp;NotifyTypeEnum&nbsp;Type&nbsp;{&nbsp;get;&nbsp;set;&nbsp;}</span></div>
</div>
</div>
<p>&nbsp;</p>
<p><span style="font-size: 14pt;"><strong>9.将多个数据类型序列化为1个Json对象（序列化匿名类）</strong></span></p>
<hr />
<p>&nbsp;　　有时我们有这样的需求，对方要求我们传输过去的Json字符串要包含我们多个实体类型的信息，笨方法就是重新构建一个符合要求的实体类型，但是我们又更好的方法，我们可以使用匿名类，把Json需要的信息均放在匿名类中，我们可以对匿名类进行序列化。</p>
<p>　　例：</p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;">        List&lt;Model&gt; list1 = <span style="color: #0000ff;">new</span> List&lt;Model&gt;<span style="color: #000000;">();
        List</span>&lt;Model2&gt; list2 = <span style="color: #0000ff;">new</span> List&lt;Model2&gt;<span style="color: #000000;">();
        </span><span style="color: #0000ff;">string</span> name = <span style="color: #800000;">"</span><span style="color: #800000;">名字</span><span style="color: #800000;">"</span><span style="color: #000000;">;
        </span><span style="color: #0000ff;">string</span> address = <span style="color: #800000;">"</span><span style="color: #800000;">xx</span><span style="color: #800000;">"</span><span style="color: #000000;">;
        List</span>&lt;<span style="color: #0000ff;">string</span>&gt; info = <span style="color: #0000ff;">new</span> List&lt;<span style="color: #0000ff;">string</span>&gt;<span style="color: #000000;">() { name, address };
        </span><span style="color: #0000ff;">var</span> json = <span style="color: #0000ff;">new</span> { information = info, jsonList1 = list1, jsonList2 = list2 };</span> </pre>
</div>
<p>　　我们只需要对上面的匿名对象&ldquo;json&rdquo;序列化即可。</p>
<p>&nbsp;</p>
<p><span style="font-size: 14pt;"><strong>10.使用<strong>JsonConverter</strong>自定义属性序列化规则（json格式转换器）</strong></span></p>
<hr />
<ul>
<li>&nbsp;<strong><span style="font-size: 16px;">（1）将属性值由double类型序列化时转为字符串类型</span></strong></li>
</ul>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;"><span style="color: #0000ff;">　　public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> DoubleToStringConverter : JsonConverter
    {
        </span><span style="color: #008000;">//表示</span><span style="color: #008000;">反序列化时不执行该转换器</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">bool</span> CanRead =&gt; <span style="color: #0000ff;">false</span><span style="color: #000000;">;
        </span><span style="color: #008000;">//表示</span><span style="color: #008000;">序列化时执行该转换器</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">bool</span> CanWrite =&gt; <span style="color: #0000ff;">true</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//判断</span><span style="color: #008000;">执行条件（当属性的值为double类型时才使用转换器）</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">bool</span><span style="color: #000000;"> CanConvert(Type objectType)
        {
            </span><span style="color: #0000ff;">return</span> objectType == <span style="color: #0000ff;">typeof</span>(<span style="color: #0000ff;">double</span><span style="color: #000000;">);
        }

        </span><span style="color: #008000;">//</span><span style="color: #008000;">因为public override bool CanRead =&gt; false;，所以不用实现反序列化时的转换方法</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">object</span> ReadJson(JsonReader reader, Type objectType, <span style="color: #0000ff;">object</span><span style="color: #000000;"> existingValue, JsonSerializer serializer)
        {
            </span><span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> NotImplementedException();
        }

        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 序列化时执行的转换
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="writer"&gt;</span><span style="color: #008000;">可以用来重写值</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="value"&gt;</span><span style="color: #008000;">属性的原值</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="serializer"&gt;</span><span style="color: #008000;">就是那个serializer对象</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">void</span> WriteJson(JsonWriter writer, <span style="color: #0000ff;">object</span><span style="color: #000000;"> value, JsonSerializer serializer)
        {
            </span><span style="color: #0000ff;">double</span> v = (<span style="color: #0000ff;">double</span><span style="color: #000000;">)value;
            writer.WriteValue(v.ToString());
        }
    }</span></span></pre>
</div>
<p><span style="font-size: 16px;"> 　　使用方式：</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;">[JsonConverter(<span style="color: #0000ff;">typeof</span><span style="color: #000000;">(DoubleToStringConverter))]
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">double</span> Count{<span style="color: #0000ff;">get</span>;<span style="color: #0000ff;">set</span>;}</span></pre>
</div>
<p><span style="font-size: 16px;"> 　　<strong>ps:</strong>这样子，就可以把原本序列化出的Json字符串&nbsp; &nbsp;Count : 12.3&nbsp; &nbsp;转化为&nbsp; &nbsp;Count : "12.3"</span><br /><span style="font-size: 16px;">	　　<strong>ps</strong>:[JsonConverter(typeof(DoubleToStringConverter))]也可以打在类上，表示全局设置</span></p>
<p>&nbsp;</p>
<ul>
<li><strong><span style="font-size: 16px;">  （2）枚举转换为int字符串</span></strong></li>




</ul>
<p><span style="font-size: 16px;">　　为什么要进行这样的转换呢？</span></p>
<p><span style="font-size: 16px;">　　因为枚举类型在序列化时默认序列化为枚举的int类型，即如下代码：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #808080;">　　<span style="font-size: 14px;"> ///</span></span><span style="font-size: 14px;"> <span style="color: #808080;">&lt;summary&gt;</span>
    <span style="color: #808080;">///</span><span style="color: #008000;"> 自定义一个枚举类型
    </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">enum</span><span style="color: #000000;"> MyEnum
    {
        aaa </span>= <span style="color: #800080;">1</span><span style="color: #000000;">,
        bbb </span>= <span style="color: #800080;">2</span><span style="color: #000000;">,
        ccc </span>= <span style="color: #800080;">3</span><span style="color: #000000;">
    }
    </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
    <span style="color: #808080;">///</span><span style="color: #008000;"> 实体类（类内有一个枚举类型的属性MyEnumProp）
    </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Person
    {
        </span><span style="color: #0000ff;">public</span> MyEnum MyEnumProp { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
    }
    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {

        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
            Person p </span>= <span style="color: #0000ff;">new</span> Person() { MyEnumProp =<span style="color: #000000;"> MyEnum.ccc };
            </span><span style="color: #008000;">//</span><span style="color: #008000;">Json字符串</span>
            <span style="color: #0000ff;">string</span> jsonStr =<span style="color: #000000;"> JsonConvert.SerializeObject(p);
            </span><span style="color: #008000;">//</span><span style="color: #008000;">开始反序列化</span>
<span style="color: #000000;">            Console.WriteLine(jsonStr);
            Console.ReadLine();
        }
    }</span></span></pre>
</div>
<p>　　结果为：</p>
<p>　　<img src="./images/【Json】1.Newtonsoft—Json.NET常用方法简述2.png" alt="" width="181" height="85" /></p>
<p>&nbsp;　　<span style="font-size: 16px;">有时候会有这样的需求，序列化出的属性值均要为字符串格式，即要将上图结果的3改为"3"。这时候就需要自定义转换了！</span></p>
<p><span style="font-size: 16px;">　　代码如下：</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 14px;">    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> EnumToIntStringConverter : JsonConverter
    {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">反序列化时不执行</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">bool</span> CanRead =&gt; <span style="color: #0000ff;">false</span><span style="color: #000000;">;
        </span><span style="color: #008000;">//</span><span style="color: #008000;">序列化时执行</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">bool</span> CanWrite =&gt; <span style="color: #0000ff;">true</span><span style="color: #000000;">;

        </span><span style="color: #008000;">//</span><span style="color: #008000;">控制执行条件（当属性的值为枚举类型时才使用转换器）</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">bool</span><span style="color: #000000;"> CanConvert(Type objectType)
        {
            </span><span style="color: #0000ff;">return</span> objectType == <span style="color: #0000ff;">typeof</span><span style="color: #000000;">(Enum);
        }

        </span><span style="color: #008000;">//</span><span style="color: #008000;">因为public override bool CanRead =&gt; false;，所以不用实现反序列化时的转换方法</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">object</span> ReadJson(JsonReader reader, Type objectType, <span style="color: #0000ff;">object</span><span style="color: #000000;"> existingValue, JsonSerializer serializer)
        {
            </span><span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> NotImplementedException();
        }

        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 序列化时执行的转换
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="writer"&gt;</span><span style="color: #008000;">可以用来重写值</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="value"&gt;</span><span style="color: #008000;">属性的原值</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="serializer"&gt;</span><span style="color: #008000;">就是那个serializer对象</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">void</span> WriteJson(JsonWriter writer, <span style="color: #0000ff;">object</span><span style="color: #000000;"> value, JsonSerializer serializer)
        {
            Enum e </span>=<span style="color: #000000;"> (Enum)value;
            </span><span style="color: #0000ff;">int</span> v =<span style="color: #000000;"> Convert.ToInt32(e);
            writer.WriteValue(v.ToString());
        }
    }  </span></span></pre>
</div>
<p><span style="font-size: 16px;">　　使用方法同上例。</span></p>
<p><span style="font-size: 16px;">&nbsp;</span></p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>