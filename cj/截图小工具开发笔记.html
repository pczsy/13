<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修截图小工具开发笔记' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>截图小工具开发笔记</center></div><div class='banquan'>原文出处:本文由博客园博主相信神话提供。<br/>
原文连接:https://www.cnblogs.com/agoodlife/p/10849653.html</div><br>
    <h1>一、开发环境及工具</h1>
<p><span style="font-size: 18px;">Windows 7 <span style="font-family: 宋体;">系统，开发软件为</span>Microsoft Visual Studio Ultimate 2012</span></p>
<h1>二、实现的功能</h1>
<p><span style="font-size: 18px;">屏幕截屏，保存到图片或者保存到剪切板。截屏范围可以随意移动或者改变大小，自由度很高。先预览一下效果：</span></p>
<p><img src="./images/截图小工具开发笔记0.png" alt="" /></p>
<h1>三、实现原理</h1>
<p><span style="font-size: 18px;"><span style="font-family: 宋体;">共</span>2<span style="font-family: 宋体;">个窗体，</span><span style="font-family: Calibri;">1</span><span style="font-family: 宋体;">个是主窗体，主要功能进行热键设置，抓取屏幕到图片传给另一个窗体，另一个窗体对传过来的图片继续截取等操作。</span></span></p>
<h1>四、开发手记</h1>
<h2><span style="font-size: 18px;">1.<span style="font-family: 宋体;">新建</span><span style="font-family: Calibri;">winform</span><span style="font-family: 宋体;">项目</span></span></h2>
<p><span style="font-family: 宋体;"><img src="./images/截图小工具开发笔记1.png" alt="" /></span></p>
<h2><span style="font-size: 18px;">2.<span style="font-family: 宋体;">主界面设计如图</span><span style="font-family: Calibri;">:</span></span></h2>
<p><span style="font-family: Calibri;"><img src="./images/截图小工具开发笔记2.png" alt="" /></span></p>
<p><span style="font-size: 18px;">窗体主要属性设置如下：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">窗口样式</span>
<span style="color: #0000ff;">this</span>.FormBorderStyle =<span style="color: #000000;"> System.Windows.Forms.FormBorderStyle.FixedDialog;
</span><span style="color: #008000;">//</span><span style="color: #008000;">窗口图标</span>
  <span style="color: #0000ff;">this</span>.Icon = ((System.Drawing.Icon)(resources.GetObject(<span style="color: #800000;">"</span><span style="color: #800000;">$this.Icon</span><span style="color: #800000;">"</span><span style="color: #000000;">)));
</span><span style="color: #008000;">//</span><span style="color: #008000;">禁止最大化            </span>
<span style="color: #0000ff;">this</span>.MaximizeBox = <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008000;">//</span><span style="color: #008000;">窗口名称</span>
 <span style="color: #0000ff;">this</span>.Name = <span style="color: #800000;">"</span><span style="color: #800000;">PicCut</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008000;">//</span><span style="color: #008000;">窗口初始位置为屏幕中心</span>
<span style="color: #0000ff;">this</span>.StartPosition =<span style="color: #000000;"> System.Windows.Forms.FormStartPosition.CenterScreen;
</span><span style="color: #008000;">//</span><span style="color: #008000;">窗口标题为&ldquo;截图设置&rdquo;</span>
<span style="color: #0000ff;">this</span>.Text = <span style="color: #800000;">"</span><span style="color: #800000;">截图设置</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008000;">//</span><span style="color: #008000;">窗口浮在所有窗口上面</span>
 <span style="color: #0000ff;">this</span>.TopMost = <span style="color: #0000ff;">true</span>;</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-size: 18px;"><span style="font-family: 宋体;">此窗口内主要包括</span>2<span style="font-family: 宋体;">个</span><span style="font-family: Calibri;">label</span><span style="font-family: 宋体;">控件，</span><span style="font-family: Calibri;">1</span><span style="font-family: 宋体;">个</span><span style="font-family: Calibri;">ComboBox</span><span style="font-family: 宋体;">和</span><span style="font-family: Calibri;">1</span><span style="font-family: 宋体;">个</span><span style="font-family: Calibri;">PictureBox</span><span style="font-family: 宋体;">，摆放位置如上图。</span><span style="font-family: Calibri;">label</span><span style="font-family: 宋体;">用于显示文字说明；</span><span style="font-family: Calibri;">ComboBox</span><span style="font-family: 宋体;">用于显示热键</span><span style="font-family: Calibri;">0</span><span style="font-family: 宋体;">&mdash;</span><span style="font-family: Calibri;">9</span><span style="font-family: 宋体;">个数字供选择；</span><span style="font-family: Calibri;">PictureBox</span><span style="font-family: 宋体;">用于显示二维码图片。</span></span></p>
<h3><span style="font-size: 18px;">3<span style="font-family: 宋体;">.主界面的主要功能是对热键进行设置，同时我们程序运行，该界面自动最小化到托盘，双击进行截图，有机显示上述主界面进行设置，设置完毕可以最小化自动到托盘，点击关闭程序会自动退出。</span></span></h3>
<p>&nbsp;<img src="./images/截图小工具开发笔记3.png" alt="" /></p>
<h4><span style="font-size: 18px;"><span style="font-family: 宋体;">（</span>1）自动到托盘</span></h4>
<p><span style="font-size: 18px;"><span style="font-family: 宋体;">主界面拖入</span>&ldquo;notifyIcon&rdquo;，主要属性设置如下图，其中Text是鼠标滑动到拖盘区域图标上的提示；Icon是托盘图标；Visible设置为false，默认不显示托盘区域图标。</span></p>
<p align="center"><img src="./images/截图小工具开发笔记4.png" alt="" />&nbsp;</p>
<p align="center">&nbsp;</p>
<p><span style="font-size: 18px;">主要程序代码。窗体载入时，最小化窗体，同时设置ComboBox空间的默认值。</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> PicCut_Load(<span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, EventArgs e)
{<br />     </span><span style="color: #0000ff;">this</span>.WindowState =<span style="color: #000000;"> FormWindowState.Minimized;       
     NumberCbox.SelectedIndex </span>=<span style="color: #000000;"> CutPicSet.Default.KeyNumber;            
}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-size: 18px;">窗口大小发生变化时，如果窗口最小化，隐藏当前窗体，托盘区域显示图标。</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> PicCut_SizeChanged(<span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, EventArgs e)
 {
           </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span>.WindowState ==<span style="color: #000000;"> FormWindowState.Minimized)
            {
                 </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Hide();
                MinNot.Visible </span>= <span style="color: #0000ff;">true</span><span style="color: #000000;">;   
            }
 }</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-size: 18px;">上述两段代码实现了，程序开始运行时候，窗口最小化隐藏，同时托盘区域显示图标。</span></p>
<h4><span style="font-size: 18px;">（2）托盘图标左键双击进行截图操作</span></h4>
<p><img src="./images/截图小工具开发笔记5.png" alt="" /></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> MinNot_MouseDoubleClick(<span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, MouseEventArgs e)
{
      </span><span style="color: #0000ff;">if</span> (e.Button==<span style="color: #000000;">MouseButtons.Left)
     {<br /></span><span style="color: #008000;">       //</span><span style="color: #008000;">显示截图窗体<br /></span><span style="color: #000000;">        ShowCutPic();
      }
}</span></pre>
</div>
<p>&nbsp;</p>
<pre><code><span style="font-size: 18px;">ShowCutPic函数：</span></pre>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> ShowCutPic()
        {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> 创建的空白图片和屏幕大小一样大的图片</span>
            Bitmap CatchBmp = <span style="color: #0000ff;">new</span> Bitmap(Screen.AllScreens[<span style="color: #800080;">0</span>].Bounds.Width, Screen.AllScreens[<span style="color: #800080;">0</span><span style="color: #000000;">].Bounds.Height);            
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> 我们可以通过Graphics这个类在这个空白图片上画图</span>
            Graphics g =<span style="color: #000000;"> Graphics.FromImage(CatchBmp);
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> 把屏幕图片拷贝到我们创建的空白图片 CatchBmp中</span>
            g.CopyFromScreen(<span style="color: #0000ff;">new</span> Point(<span style="color: #800080;">0</span>, <span style="color: #800080;">0</span>), <span style="color: #0000ff;">new</span> Point(<span style="color: #800080;">0</span>, <span style="color: #800080;">0</span>), <span style="color: #0000ff;">new</span> Size(Screen.AllScreens[<span style="color: #800080;">0</span>].Bounds.Width, Screen.AllScreens[<span style="color: #800080;">0</span><span style="color: #000000;">].Bounds.Height));
</span><span style="color: #008000;">            //</span><span style="color: #008000;">这个我们截图的窗体创建截图窗体</span>
            cutter = <span style="color: #0000ff;">new</span><span style="color: #000000;"> CutPic();
             </span><span style="color: #008000;">//</span><span style="color: #008000;"> 截图窗体的图片属性设置我们刚才新建的图片;</span>
            cutter.Image =<span style="color: #000000;"> CatchBmp;
</span><span style="color: #008000;">           //</span><span style="color: #008000;">显示窗体</span>
<span style="color: #000000;">            cutter.ShowDialog();
        }</span></pre>
</div>
<p>&nbsp;</p>
<p align="center">&nbsp;</p>
<h4><span style="font-size: 18px;"><span style="font-family: 宋体;">（</span>3）托盘图标右键单击显示界面设置</span></h4>
<div class="cnblogs_code">
<pre><code> <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> MinNot_MouseClick(<span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, MouseEventArgs e)
        {
            </span><span style="color: #0000ff;">if</span> (e.Button==<span style="color: #000000;"> MouseButtons.Right)
            {
</span><span style="color: #008000;">//</span><span style="color: #008000;">显示主窗体</span>
                <span style="color: #0000ff;">this</span><span style="color: #000000;">.Show();
</span><span style="color: #008000;">//</span><span style="color: #008000;">隐藏托盘图标</span>
                MinNot.Visible = <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008000;">//</span><span style="color: #008000;">当前窗口普通设置</span>
                <span style="color: #0000ff;">this</span>.WindowState =<span style="color: #000000;"> FormWindowState.Normal;               
            }
                   
        }</span></pre>
</div>
<p>&nbsp;</p>
<h4><span style="font-size: 18px;"><span style="font-family: 宋体;">（</span>4）热键设置</span></h4>
<div class="cnblogs_code">
<pre><code><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 如果函数执行成功，返回值不为0。
        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 如果函数执行失败，返回值为0。要得到扩展错误信息，调用GetLastError。
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="hWnd"&gt;</span><span style="color: #008000;">要定义热键的窗口的句柄</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="id"&gt;</span><span style="color: #008000;">定义热键ID（不能与其它ID重复）</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="fsModifiers"&gt;</span><span style="color: #008000;">标识热键是否在按Alt、Ctrl、Shift、Windows等键时才会生效</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="vk"&gt;</span><span style="color: #008000;">定义热键的内容</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span>
        [DllImport(<span style="color: #800000;">"</span><span style="color: #800000;">user32.dll</span><span style="color: #800000;">"</span>, SetLastError = <span style="color: #0000ff;">true</span><span style="color: #000000;">)]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">extern</span> <span style="color: #0000ff;">bool</span> RegisterHotKey(IntPtr hWnd, <span style="color: #0000ff;">int</span><span style="color: #000000;"> id, KeyModifiers fsModifiers, Keys vk);

        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 注销热键
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="hWnd"&gt;</span><span style="color: #008000;">要取消热键的窗口的句柄</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="id"&gt;</span><span style="color: #008000;">要取消热键的ID</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span>
        [DllImport(<span style="color: #800000;">"</span><span style="color: #800000;">user32.dll</span><span style="color: #800000;">"</span>, SetLastError = <span style="color: #0000ff;">true</span><span style="color: #000000;">)]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">extern</span> <span style="color: #0000ff;">bool</span> UnregisterHotKey(IntPtr hWnd, <span style="color: #0000ff;">int</span><span style="color: #000000;"> id);

        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 辅助键名称。
        </span><span style="color: #808080;">///</span><span style="color: #008000;"> Alt, Ctrl, Shift, WindowsKey
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
<span style="color: #000000;">        [Flags()]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">enum</span> KeyModifiers { None = <span style="color: #800080;">0</span>, Alt = <span style="color: #800080;">1</span>, Ctrl = <span style="color: #800080;">2</span>, Shift = <span style="color: #800080;">4</span>, WindowsKey = <span style="color: #800080;">8</span><span style="color: #000000;"> }

        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 注册热键
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="hwnd"&gt;</span><span style="color: #008000;">窗口句柄</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="hotKey_id"&gt;</span><span style="color: #008000;">热键ID</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="keyModifiers"&gt;</span><span style="color: #008000;">组合键</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="key"&gt;</span><span style="color: #008000;">热键</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> RegHotKey(IntPtr hwnd, <span style="color: #0000ff;">int</span><span style="color: #000000;"> hotKeyId, KeyModifiers keyModifiers, Keys key)
        {
            </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">RegisterHotKey(hwnd, hotKeyId, keyModifiers, key))
            {
                </span><span style="color: #0000ff;">int</span> errorCode =<span style="color: #000000;"> Marshal.GetLastWin32Error();
                </span><span style="color: #0000ff;">if</span> (errorCode == <span style="color: #800080;">1409</span><span style="color: #000000;">)
                {
                    MessageBox.Show(</span><span style="color: #800000;">"</span><span style="color: #800000;">热键被占用 ！</span><span style="color: #800000;">"</span><span style="color: #000000;">);
                }
                </span><span style="color: #0000ff;">else</span><span style="color: #000000;">
                {
                    MessageBox.Show(</span><span style="color: #800000;">"</span><span style="color: #800000;">注册热键失败！错误代码：</span><span style="color: #800000;">"</span> +<span style="color: #000000;"> errorCode);
                }
            }
        }

        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 注销热键
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="hwnd"&gt;</span><span style="color: #008000;">窗口句柄</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="hotKey_id"&gt;</span><span style="color: #008000;">热键ID</span><span style="color: #808080;">&lt;/param&gt;</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> UnRegHotKey(IntPtr hwnd, <span style="color: #0000ff;">int</span><span style="color: #000000;"> hotKeyId)
        {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">注销指定的热键</span>
<span style="color: #000000;">            UnregisterHotKey(hwnd, hotKeyId);
        }</span></pre>
</div>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">const</span> <span style="color: #0000ff;">int</span> WM_HOTKEY = <span style="color: #800080;">0x312</span>; <span style="color: #008000;">//</span><span style="color: #008000;">窗口消息-热键</span>
        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">const</span> <span style="color: #0000ff;">int</span> WM_CREATE = <span style="color: #800080;">0x1</span>; <span style="color: #008000;">//</span><span style="color: #008000;">窗口消息-创建</span>
        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">const</span> <span style="color: #0000ff;">int</span> WM_DESTROY = <span style="color: #800080;">0x2</span>; <span style="color: #008000;">//</span><span style="color: #008000;">窗口消息-销毁</span>
        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">const</span> <span style="color: #0000ff;">int</span> Space = <span style="color: #800080;">0x3572</span>; <span style="color: #008000;">//</span><span style="color: #008000;">热键ID</span>
        <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">void</span> WndProc(<span style="color: #0000ff;">ref</span><span style="color: #000000;"> Message m)
        {
            </span><span style="color: #0000ff;">base</span>.WndProc(<span style="color: #0000ff;">ref</span><span style="color: #000000;"> m);
            </span><span style="color: #0000ff;">switch</span><span style="color: #000000;"> (m.Msg)
            {
                </span><span style="color: #0000ff;">case</span> WM_HOTKEY: <span style="color: #008000;">//</span><span style="color: #008000;">窗口消息-热键ID</span>
                    <span style="color: #0000ff;">switch</span><span style="color: #000000;"> (m.WParam.ToInt32())
                    {
                        </span><span style="color: #0000ff;">case</span> Space: <span style="color: #008000;">//</span><span style="color: #008000;">热键ID
</span><span style="color: #008000;">//</span><span style="color: #008000;">按下热键显示截图窗体</span>
<span style="color: #000000;">                            ShowCutPic();
                            </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                        </span><span style="color: #0000ff;">default</span><span style="color: #000000;">:
                            </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                    }
                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                </span><span style="color: #0000ff;">case</span> WM_CREATE: <span style="color: #008000;">//</span><span style="color: #008000;">窗口消息-创建</span>
<span style="color: #000000;">                    SetHotKey(CutPicSet.Default.KeyNumber);
                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                </span><span style="color: #0000ff;">case</span> WM_DESTROY: <span style="color: #008000;">//</span><span style="color: #008000;">窗口消息-销毁</span>
                    UnRegHotKey(Handle, Space); <span style="color: #008000;">//</span><span style="color: #008000;">销毁热键</span>
                    <span style="color: #0000ff;">break</span><span style="color: #000000;">;
                </span><span style="color: #0000ff;">default</span><span style="color: #000000;">:
                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
            }
        }

        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> SetHotKey(<span style="color: #0000ff;">int</span><span style="color: #000000;"> keynumber)
        {
            </span><span style="color: #0000ff;">if</span> (keynumber == <span style="color: #800080;">0</span><span style="color: #000000;">)
            {
                RegHotKey(Handle, Space, KeyModifiers.Ctrl, Keys.D0);
            }
            </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (keynumber == <span style="color: #800080;">1</span><span style="color: #000000;">)
            {
                RegHotKey(Handle, Space, KeyModifiers.Ctrl, Keys.D1);
            }
            </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (keynumber == <span style="color: #800080;">2</span><span style="color: #000000;">)
            {
                RegHotKey(Handle, Space, KeyModifiers.Ctrl, Keys.D2);
            }
            </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (keynumber == <span style="color: #800080;">3</span><span style="color: #000000;">)
            {
                RegHotKey(Handle, Space, KeyModifiers.Ctrl, Keys.D3);
            }
            </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (keynumber == <span style="color: #800080;">4</span><span style="color: #000000;">)
            {
                RegHotKey(Handle, Space, KeyModifiers.Ctrl, Keys.D4);
            }
            </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (keynumber == <span style="color: #800080;">5</span><span style="color: #000000;">)
            {
                RegHotKey(Handle, Space, KeyModifiers.Ctrl, Keys.D5);
            }
            </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (keynumber == <span style="color: #800080;">6</span><span style="color: #000000;">)
            {
                RegHotKey(Handle, Space, KeyModifiers.Ctrl, Keys.D6);
            }
            </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (keynumber == <span style="color: #800080;">7</span><span style="color: #000000;">)
            {
                RegHotKey(Handle, Space, KeyModifiers.Ctrl, Keys.D7);
            }
            </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (keynumber == <span style="color: #800080;">8</span><span style="color: #000000;">)
            {
                RegHotKey(Handle, Space, KeyModifiers.Ctrl, Keys.D8);
            }
            </span><span style="color: #0000ff;">else</span><span style="color: #000000;">
            {
                RegHotKey(Handle, Space, KeyModifiers.Ctrl, Keys.D9);
            }
        }</span></pre>
</div>
<p>&nbsp;</p>
<h4>&nbsp;<span style="font-size: 18px;"><span style="font-family: 宋体;">（</span>5）图形热键设置</span></h4>
<div class="cnblogs_code">
<pre><code> <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> NumberCbox_SelectedIndexChanged(<span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, EventArgs e)
        {
</span><span style="color: #008000;">//</span><span style="color: #008000;">把配置文件设置NumberCbox的选择值</span>
            CutPicSet.Default.KeyNumber =<span style="color: #000000;"> NumberCbox.SelectedIndex;
            CutPicSet.Default.Save();
</span><span style="color: #008000;">//</span><span style="color: #008000;">先卸载原来注册的热键</span>
<span style="color: #000000;">            UnRegHotKey(Handle, Space);
</span><span style="color: #008000;">//</span><span style="color: #008000;">从新设置选择的热键</span>
<span style="color: #000000;">            SetHotKey(NumberCbox.SelectedIndex);
        }</span></pre>
</div>
<p>&nbsp;</p>
<h2><span style="font-size: 18px;">4、截图界面设计</span></h2>
<p><span style="font-size: 18px;"><span style="font-family: 宋体;">新建窗体</span>CutPic，名称与之前的名称相对应，主要属性设置如下：</span></p>
<p><span style="font-size: 18px;">Name：CutPic</span></p>
<p><span style="font-size: 18px;">WindowState:Maximized</span></p>
<p><span style="font-size: 18px;">TopMost:true</span></p>
<p><span style="font-size: 18px;">FormBorderStyle:None</span></p>
<h2><span style="font-size: 18px;">5、截图功能实现</span></h2>
<p><span style="font-size: 18px;">主要代码如下：</span></p>
<div class="cnblogs_code">
<pre><code> <span style="color: #0000ff;">private</span> Point m_ptStart;        <span style="color: #008000;">//</span><span style="color: #008000;">起始点位置</span>
        <span style="color: #0000ff;">private</span> Point m_ptCurrent;      <span style="color: #008000;">//</span><span style="color: #008000;">当前鼠标位置</span>
        <span style="color: #0000ff;">private</span> Point m_ptTempForMove;  <span style="color: #008000;">//</span><span style="color: #008000;">移动选框的时候临时用</span>
        <span style="color: #0000ff;">private</span> Rectangle m_rectClip;   <span style="color: #008000;">//</span><span style="color: #008000;">限定鼠标活动的区域</span>
        <span style="color: #0000ff;">private</span> Rectangle[] m_rectDots = <span style="color: #0000ff;">new</span> Rectangle[<span style="color: #800080;">8</span>];  <span style="color: #008000;">//</span><span style="color: #008000;">八个控制点</span>
        <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">bool</span><span style="color: #000000;"> m_bMoving;
        </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">bool</span><span style="color: #000000;"> m_bChangeWidth;
        </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">bool</span><span style="color: #000000;"> m_bChangeHeight;
        </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">bool</span><span style="color: #000000;"> m_bMouseHover;
        </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">bool</span> _IsDrawed; <span style="color: #808080;">///</span><span style="color: #008000;"> 获取当前是否已经选择区域</span>
        <span style="color: #0000ff;">private</span><span style="color: #000000;"> Image _Image;
        </span><span style="color: #808080;">///</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 要裁剪的图像
        </span><span style="color: #808080;">///
</span>        [Description(<span style="color: #800000;">"</span><span style="color: #800000;">要裁剪的图像</span><span style="color: #800000;">"</span>), Category(<span style="color: #800000;">"</span><span style="color: #800000;">Customs</span><span style="color: #800000;">"</span><span style="color: #000000;">)]
        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> Image Image
        {
            </span><span style="color: #0000ff;">get</span> { <span style="color: #0000ff;">return</span><span style="color: #000000;"> _Image; }
            </span><span style="color: #0000ff;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">if</span> (value == <span style="color: #0000ff;">this</span>._Image) <span style="color: #0000ff;">return</span><span style="color: #000000;">;
                _Image </span>=<span style="color: #000000;"> value;
             </span><span style="color: #008000;">//</span><span style="color: #008000;">   this.Clear();</span>
<span style="color: #000000;">            }
        }
        </span><span style="color: #0000ff;">private</span> Color _MaskColor = Color.FromArgb(<span style="color: #800080;">125</span>, <span style="color: #800080;">0</span>, <span style="color: #800080;">0</span>, <span style="color: #800080;">0</span><span style="color: #000000;">);
        </span><span style="color: #808080;">///</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 遮罩颜色
        </span><span style="color: #808080;">///
</span>        [Description(<span style="color: #800000;">"</span><span style="color: #800000;">遮罩颜色</span><span style="color: #800000;">"</span>), Category(<span style="color: #800000;">"</span><span style="color: #800000;">Customs</span><span style="color: #800000;">"</span><span style="color: #000000;">)]
        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> Color MaskColor
        {
            </span><span style="color: #0000ff;">get</span> { <span style="color: #0000ff;">return</span><span style="color: #000000;"> _MaskColor; }
            </span><span style="color: #0000ff;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">if</span> (_MaskColor == value) <span style="color: #0000ff;">return</span><span style="color: #000000;">;
                _MaskColor </span>=<span style="color: #000000;"> value;
                </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span>._Image != <span style="color: #0000ff;">null</span>) <span style="color: #0000ff;">this</span><span style="color: #000000;">.Invalidate();
            }
        }
        </span><span style="color: #0000ff;">private</span> Rectangle _SelectedRectangle;<span style="color: #808080;">///</span><span style="color: #008000;"> 获取或设置悬着区域</span>
       
        <span style="color: #0000ff;">public</span><span style="color: #000000;"> CutPic()
        {
            SetStyle(ControlStyles.UserPaint,&nbsp;</span><span style="color: #0000ff;">true</span><span style="color: #000000;">);&nbsp;&nbsp;
            SetStyle(ControlStyles.AllPaintingInWmPaint,&nbsp;</span><span style="color: #0000ff;">true</span>);&nbsp;<span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;禁止擦除背景.&nbsp;&nbsp;</span>
            SetStyle(ControlStyles.DoubleBuffer,&nbsp;<span style="color: #0000ff;">true</span>);&nbsp;<span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;双缓冲&nbsp;&nbsp;</span>
<span style="color: #000000;">
            InitializeComponent();
        }

        </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> CutPic_MouseDown(<span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, MouseEventArgs e)
        {
            </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span>._Image == <span style="color: #0000ff;">null</span><span style="color: #000000;">)
            {
                </span><span style="color: #0000ff;">return</span>;<span style="color: #008000;">//</span><span style="color: #008000;">Image属性null或者已经锁定选择 直接返回</span>
<span style="color: #000000;">            }
            m_ptStart </span>=<span style="color: #000000;"> e.Location;
            m_bChangeHeight </span>= <span style="color: #0000ff;">true</span><span style="color: #000000;">;
            m_bChangeWidth </span>= <span style="color: #0000ff;">true</span><span style="color: #000000;">;

            </span><span style="color: #008000;">//</span><span style="color: #008000;">判断若不在限定范围内操作 返回</span>
            m_rectClip = <span style="color: #0000ff;">this</span><span style="color: #000000;">.DisplayRectangle;
                Size sz </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">.Size;
                sz </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">.Size;                
                m_rectClip.Intersect(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Rectangle(Point.Empty, sz));
                m_rectClip.Width</span>++; m_rectClip.Height++<span style="color: #000000;">;
                Cursor.Clip </span>=<span style="color: #000000;"> RectangleToScreen(m_rectClip);
            

            </span><span style="color: #0000ff;">if</span> (ToolsPanel.Visible==<span style="color: #0000ff;">true</span><span style="color: #000000;">)
            {
                ToolsPanel.Visible </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
            }
            </span><span style="color: #008000;">//</span><span style="color: #008000;">如果 已经选择区域 若鼠标点下 判断是否在控制顶点上</span>
            <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span><span style="color: #000000;">._IsDrawed)
            {
                </span><span style="color: #0000ff;">this</span>._IsDrawed = <span style="color: #0000ff;">false</span>; <span style="color: #008000;">//</span><span style="color: #008000;">默认表示 要更改选取设置 清楚IsDrawed属性</span>
                <span style="color: #0000ff;">if</span> (m_rectDots[<span style="color: #800080;">0</span><span style="color: #000000;">].Contains(e.Location))
                {
                    m_ptStart.X </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.Right;
                    m_ptStart.Y </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.Bottom;
                }
                </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (m_rectDots[<span style="color: #800080;">1</span><span style="color: #000000;">].Contains(e.Location))
                {
                    m_ptStart.Y </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.Bottom;
                    m_bChangeWidth </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
                }
                </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (m_rectDots[<span style="color: #800080;">2</span><span style="color: #000000;">].Contains(e.Location))
                {
                    m_ptStart.X </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.X;
                    m_ptStart.Y </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.Bottom;
                }
                </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (m_rectDots[<span style="color: #800080;">3</span><span style="color: #000000;">].Contains(e.Location))
                {
                    m_ptStart.X </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.Right;
                    m_bChangeHeight </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
                }
                </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (m_rectDots[<span style="color: #800080;">4</span><span style="color: #000000;">].Contains(e.Location))
                {
                    m_ptStart.X </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.X;
                    m_bChangeHeight </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
                }
                </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (m_rectDots[<span style="color: #800080;">5</span><span style="color: #000000;">].Contains(e.Location))
                {
                    m_ptStart.X </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.Right;
                    m_ptStart.Y </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.Y;
                }
                </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (m_rectDots[<span style="color: #800080;">6</span><span style="color: #000000;">].Contains(e.Location))
                {
                    m_ptStart.Y </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.Y;
                    m_bChangeWidth </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
                }
                </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (m_rectDots[<span style="color: #800080;">7</span><span style="color: #000000;">].Contains(e.Location))
                {
                    m_ptStart </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.Location;
                }
                </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.Contains(e.Location))
                {
                    m_bMoving </span>= <span style="color: #0000ff;">true</span><span style="color: #000000;">;
                    m_bChangeWidth </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
                    m_bChangeHeight </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
                }
                </span><span style="color: #0000ff;">else</span> { <span style="color: #0000ff;">this</span>._IsDrawed = <span style="color: #0000ff;">true</span>; }   <span style="color: #008000;">//</span><span style="color: #008000;">若以上条件不成立 表示不需要更改设置</span>
<span style="color: #000000;">            }
        }

        </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> CutPic_MouseClick(<span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, MouseEventArgs e)
        {
            </span><span style="color: #0000ff;">if</span> (MouseButtons.Right==<span style="color: #000000;">e.Button)
            {
                </span><span style="color: #0000ff;">this</span>.DialogResult =<span style="color: #000000;"> DialogResult.OK;
                </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Close();
            }
        }

        </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> CutPic_Paint(<span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, PaintEventArgs e)
        {
            Graphics g </span>=<span style="color: #000000;"> e.Graphics;
            </span><span style="color: #0000ff;">if</span> (_Image!=<span style="color: #0000ff;">null</span><span style="color: #000000;">)
            {
                  g.DrawImage(</span><span style="color: #0000ff;">this</span>._Image,<span style="color: #800080;">0</span>,<span style="color: #800080;">0</span>,<span style="color: #0000ff;">this</span>._Image.Width,<span style="color: #0000ff;">this</span>._Image.Height);<span style="color: #008000;">//</span><span style="color: #008000;">原图</span>
                  <span style="color: #0000ff;">using</span> (SolidBrush sb = <span style="color: #0000ff;">new</span> SolidBrush(<span style="color: #0000ff;">this</span><span style="color: #000000;">._MaskColor))
                  {
                      g.FillRectangle(sb, </span><span style="color: #0000ff;">this</span>.ClientRectangle);<span style="color: #008000;">//</span><span style="color: #008000;">遮罩</span>
<span style="color: #000000;">                  }
                  </span><span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.IsEmpty)
                      </span><span style="color: #0000ff;">this</span>.DrawSelectedRectangle(g);<span style="color: #008000;">//</span><span style="color: #008000;">选框</span>
<span style="color: #000000;">            }
            SetPanleLocation();
        }

        </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> CutPic_Load(<span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, EventArgs e)
        {
            </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; <span style="color: #800080;">8</span>; i++<span style="color: #000000;">)
            {
                m_rectDots[i].Size </span>= <span style="color: #0000ff;">new</span> Size(<span style="color: #800080;">5</span>, <span style="color: #800080;">5</span><span style="color: #000000;">);
            }        
                          
            m_ptTempForMove </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">.DisplayRectangle.Location;
          
        }

        </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> CutPic_MouseMove(<span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, MouseEventArgs e)
        {
            m_ptCurrent </span>=<span style="color: #000000;"> e.Location;
            </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span>._Image == <span style="color: #0000ff;">null</span><span style="color: #000000;">)
            {
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;
            }
            </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span><span style="color: #000000;">._IsDrawed)
            {</span><span style="color: #008000;">//</span><span style="color: #008000;">如果已经绘制 移动过程中判断是否需要设置鼠标样式</span>
                <span style="color: #0000ff;">this</span><span style="color: #000000;">.SetCursorStyle(e.Location);
            }
            </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (e.Button ==<span style="color: #000000;"> MouseButtons.Left)
            {</span><span style="color: #008000;">//</span><span style="color: #008000;">否则可能表示在选择区域或重置大小</span>
                <span style="color: #0000ff;">if</span><span style="color: #000000;"> (m_bChangeWidth)
                {</span><span style="color: #008000;">//</span><span style="color: #008000;">是否允许选区宽度改变 如重置大小时候 拉动上边和下边中点时候</span>
                    <span style="color: #0000ff;">this</span>._SelectedRectangle.X = e.Location.X &gt; m_ptStart.X ?<span style="color: #000000;"> m_ptStart.X : e.Location.X;
                    </span><span style="color: #0000ff;">this</span>._SelectedRectangle.Width = Math.Abs(e.Location.X -<span style="color: #000000;"> m_ptStart.X);
                }
                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (m_bChangeHeight)
                {
                    </span><span style="color: #0000ff;">this</span>._SelectedRectangle.Y = e.Location.Y &gt; m_ptStart.Y ?<span style="color: #000000;"> m_ptStart.Y : e.Location.Y;
                    </span><span style="color: #0000ff;">this</span>._SelectedRectangle.Height = Math.Abs(e.Location.Y -<span style="color: #000000;"> m_ptStart.Y);
                }
                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (m_bMoving)
                {</span><span style="color: #008000;">//</span><span style="color: #008000;">如果是移动选区 判断选区移动范围</span>
                    <span style="color: #0000ff;">int</span> tempX = m_ptTempForMove.X + e.X -<span style="color: #000000;"> m_ptStart.X;
                    </span><span style="color: #0000ff;">int</span> tempY = m_ptTempForMove.Y + e.Y -<span style="color: #000000;"> m_ptStart.Y;
                    
                    </span><span style="color: #0000ff;">if</span> (tempX &lt; <span style="color: #800080;">0</span>) tempX = <span style="color: #800080;">0</span><span style="color: #000000;">;
                        </span><span style="color: #0000ff;">if</span> (tempY &lt; <span style="color: #800080;">0</span>) tempY = <span style="color: #800080;">0</span><span style="color: #000000;">;
                        </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span>._SelectedRectangle.Width + tempX &gt;= m_rectClip.Width) tempX = m_rectClip.Width - <span style="color: #0000ff;">this</span>._SelectedRectangle.Width - <span style="color: #800080;">1</span><span style="color: #000000;">;
                        </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span>._SelectedRectangle.Height + tempY &gt;= m_rectClip.Height) tempY = m_rectClip.Height - <span style="color: #0000ff;">this</span>._SelectedRectangle.Height - <span style="color: #800080;">1</span><span style="color: #000000;">;
                   
                    </span><span style="color: #0000ff;">this</span>._SelectedRectangle.X =<span style="color: #000000;"> tempX;
                    </span><span style="color: #0000ff;">this</span>._SelectedRectangle.Y =<span style="color: #000000;"> tempY;
                }
                </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Invalidate();
            }
            </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">this</span><span style="color: #000000;">._IsDrawed)
            {
                </span><span style="color: #0000ff;">this</span>.Invalidate();<span style="color: #008000;">//</span><span style="color: #008000;">否则 在需要绘制放大镜并且还没有选好区域同时 都重绘</span>
<span style="color: #000000;">            }
        }
        </span><span style="color: #808080;">///</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 判断鼠标当前位置显示样式
        </span><span style="color: #808080;">///</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 鼠标坐标</span>
        <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">virtual</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> SetCursorStyle(Point pt)
        {
            </span><span style="color: #0000ff;">if</span> (m_rectDots[<span style="color: #800080;">0</span>].Contains(pt) || m_rectDots[<span style="color: #800080;">7</span><span style="color: #000000;">].Contains(pt))
                </span><span style="color: #0000ff;">this</span>.Cursor =<span style="color: #000000;"> Cursors.SizeNWSE;
            </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (m_rectDots[<span style="color: #800080;">1</span>].Contains(pt) || m_rectDots[<span style="color: #800080;">6</span><span style="color: #000000;">].Contains(pt))
                </span><span style="color: #0000ff;">this</span>.Cursor =<span style="color: #000000;"> Cursors.SizeNS;
            </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (m_rectDots[<span style="color: #800080;">2</span>].Contains(pt) || m_rectDots[<span style="color: #800080;">5</span><span style="color: #000000;">].Contains(pt))
                </span><span style="color: #0000ff;">this</span>.Cursor =<span style="color: #000000;"> Cursors.SizeNESW;
            </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (m_rectDots[<span style="color: #800080;">3</span>].Contains(pt) || m_rectDots[<span style="color: #800080;">4</span><span style="color: #000000;">].Contains(pt))
                </span><span style="color: #0000ff;">this</span>.Cursor =<span style="color: #000000;"> Cursors.SizeWE;
            </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.Contains(pt))
                </span><span style="color: #0000ff;">this</span>.Cursor =<span style="color: #000000;"> Cursors.SizeAll;
            </span><span style="color: #0000ff;">else</span>
                <span style="color: #0000ff;">this</span>.Cursor =<span style="color: #000000;"> Cursors.Default;
        }

        </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> CutPic_MouseUp(<span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, MouseEventArgs e)
        {
            </span><span style="color: #0000ff;">this</span>._IsDrawed = !<span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.IsEmpty;
            m_ptTempForMove </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.Location;
            m_bMoving </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
            m_bChangeWidth </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
            m_bChangeHeight </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
            Cursor.Clip </span>=<span style="color: #000000;"> Rectangle.Empty;
            ToolsPanel.Visible </span>= <span style="color: #0000ff;">true</span><span style="color: #000000;">;
            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Invalidate();

            
           
        }

        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> SetPanleLocation()
        {
            ToolsPanel.Left </span>= <span style="color: #0000ff;">this</span>._SelectedRectangle.Left + <span style="color: #0000ff;">this</span>._SelectedRectangle.Width -<span style="color: #000000;"> ToolsPanel.Width;
            ToolsPanel.Top </span>=  <span style="color: #0000ff;">this</span>._SelectedRectangle.Top+<span style="color: #0000ff;">this</span>._SelectedRectangle.Height+<span style="color: #800080;">5</span><span style="color: #000000;">;
        }


        </span><span style="color: #808080;">///</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 绘制选框
        </span><span style="color: #808080;">///</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 绘图表面</span>
        <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">virtual</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> DrawSelectedRectangle(Graphics g)
        {
            m_rectDots[</span><span style="color: #800080;">0</span>].Y = m_rectDots[<span style="color: #800080;">1</span>].Y = m_rectDots[<span style="color: #800080;">2</span>].Y = <span style="color: #0000ff;">this</span>._SelectedRectangle.Y - <span style="color: #800080;">2</span><span style="color: #000000;">;
            m_rectDots[</span><span style="color: #800080;">5</span>].Y = m_rectDots[<span style="color: #800080;">6</span>].Y = m_rectDots[<span style="color: #800080;">7</span>].Y = <span style="color: #0000ff;">this</span>._SelectedRectangle.Bottom - <span style="color: #800080;">2</span><span style="color: #000000;">;
            m_rectDots[</span><span style="color: #800080;">0</span>].X = m_rectDots[<span style="color: #800080;">3</span>].X = m_rectDots[<span style="color: #800080;">5</span>].X = <span style="color: #0000ff;">this</span>._SelectedRectangle.X - <span style="color: #800080;">2</span><span style="color: #000000;">;
            m_rectDots[</span><span style="color: #800080;">2</span>].X = m_rectDots[<span style="color: #800080;">4</span>].X = m_rectDots[<span style="color: #800080;">7</span>].X = <span style="color: #0000ff;">this</span>._SelectedRectangle.Right - <span style="color: #800080;">2</span><span style="color: #000000;">;
            m_rectDots[</span><span style="color: #800080;">3</span>].Y = m_rectDots[<span style="color: #800080;">4</span>].Y = <span style="color: #0000ff;">this</span>._SelectedRectangle.Y + <span style="color: #0000ff;">this</span>._SelectedRectangle.Height / <span style="color: #800080;">2</span> - <span style="color: #800080;">2</span><span style="color: #000000;">;
            m_rectDots[</span><span style="color: #800080;">1</span>].X = m_rectDots[<span style="color: #800080;">6</span>].X = <span style="color: #0000ff;">this</span>._SelectedRectangle.X + <span style="color: #0000ff;">this</span>._SelectedRectangle.Width / <span style="color: #800080;">2</span> - <span style="color: #800080;">2</span><span style="color: #000000;">;

            g.DrawImage(</span><span style="color: #0000ff;">this</span>._Image, <span style="color: #0000ff;">this</span>._SelectedRectangle, <span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle, GraphicsUnit.Pixel);
            g.DrawRectangle(Pens.Cyan, </span><span style="color: #0000ff;">this</span>._SelectedRectangle.Left, <span style="color: #0000ff;">this</span>._SelectedRectangle.Top, <span style="color: #0000ff;">this</span>._SelectedRectangle.Width - <span style="color: #800080;">1</span>, <span style="color: #0000ff;">this</span>._SelectedRectangle.Height - <span style="color: #800080;">1</span><span style="color: #000000;">);
            </span><span style="color: #0000ff;">foreach</span> (Rectangle rect <span style="color: #0000ff;">in</span><span style="color: #000000;"> m_rectDots)
                g.FillRectangle(Brushes.Yellow, rect);
            </span><span style="color: #0000ff;">string</span> str = <span style="color: #0000ff;">string</span>.Format(<span style="color: #800000;">"</span><span style="color: #800000;">X:{0} Y:{1} W:{2} H:{3}</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                </span><span style="color: #0000ff;">this</span>._SelectedRectangle.Left, <span style="color: #0000ff;">this</span>._SelectedRectangle.Top, <span style="color: #0000ff;">this</span>._SelectedRectangle.Width, <span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.Height);
            Size szStr </span>= g.MeasureString(str, <span style="color: #0000ff;">this</span><span style="color: #000000;">.Font).ToSize();
            Point ptStr </span>= <span style="color: #0000ff;">new</span> Point(<span style="color: #0000ff;">this</span>._SelectedRectangle.Left, <span style="color: #0000ff;">this</span>._SelectedRectangle.Top - szStr.Height - <span style="color: #800080;">5</span><span style="color: #000000;">);
            </span><span style="color: #0000ff;">if</span> (ptStr.Y &lt; <span style="color: #800080;">0</span>) ptStr.Y = <span style="color: #0000ff;">this</span>._SelectedRectangle.Top + <span style="color: #800080;">5</span><span style="color: #000000;">;
            </span><span style="color: #0000ff;">if</span> (ptStr.X + szStr.Width &gt; <span style="color: #0000ff;">this</span>.Width) ptStr.X = <span style="color: #0000ff;">this</span>.Width -<span style="color: #000000;"> szStr.Width;
            </span><span style="color: #0000ff;">using</span> (SolidBrush sb = <span style="color: #0000ff;">new</span> SolidBrush(Color.FromArgb(<span style="color: #800080;">125</span>, <span style="color: #800080;">0</span>, <span style="color: #800080;">0</span>, <span style="color: #800080;">0</span><span style="color: #000000;">)))
            {
                g.FillRectangle(sb, </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Rectangle(ptStr, szStr));
                g.DrawString(str, </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Font, Brushes.White, ptStr);
            }
        }

        </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> SaveBT_Click(<span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, EventArgs e)
        {
            SaveFileDialog saveFileDialog </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> SaveFileDialog();
            saveFileDialog.FileName </span>= DateTime.Now.ToString(<span style="color: #800000;">"</span><span style="color: #800000;">yyyyMMddhhmmss</span><span style="color: #800000;">"</span><span style="color: #000000;">);
            saveFileDialog.Filter </span>= <span style="color: #800000;">"</span><span style="color: #800000;">png|*.png|bmp|*.bmp|jpg|*.jpg|gif|*.gif</span><span style="color: #800000;">"</span><span style="color: #000000;">;
            </span><span style="color: #0000ff;">if</span> (saveFileDialog.ShowDialog() !=<span style="color: #000000;"> DialogResult.Cancel)
            {
                System.Drawing.Rectangle cropArea </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> System.Drawing.Rectangle(_SelectedRectangle.X, _SelectedRectangle.Y, _SelectedRectangle.Width, _SelectedRectangle.Height);
                Bitmap bmpImage </span>= <span style="color: #0000ff;">new</span> Bitmap(<span style="color: #0000ff;">this</span><span style="color: #000000;">._Image);
                Bitmap bmpCrop </span>=<span style="color: #000000;"> bmpImage.Clone(cropArea, bmpImage.PixelFormat);
                bmpCrop.Save(saveFileDialog.FileName);
                </span><span style="color: #0000ff;">this</span>.DialogResult =<span style="color: #000000;"> DialogResult.OK;
                </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Close();
            }
            </span><span style="color: #0000ff;">else</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Focus();
            }
        }
       

        </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> CutPic_MouseDoubleClick(<span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, MouseEventArgs e)
        {
            </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span><span style="color: #000000;">._SelectedRectangle.Contains(e.Location))
            {
                </span><span style="color: #008000;">//</span><span style="color: #008000;">复制图片到剪切板</span>
                System.Drawing.Rectangle cropArea = <span style="color: #0000ff;">new</span><span style="color: #000000;"> System.Drawing.Rectangle(_SelectedRectangle.X, _SelectedRectangle.Y, _SelectedRectangle.Width, _SelectedRectangle.Height);
                Bitmap bmpImage </span>= <span style="color: #0000ff;">new</span> Bitmap(<span style="color: #0000ff;">this</span><span style="color: #000000;">._Image);
                Bitmap bmpCrop </span>=<span style="color: #000000;"> bmpImage.Clone(cropArea, bmpImage.PixelFormat);
                Clipboard.SetImage(bmpCrop);
                </span><span style="color: #0000ff;">this</span>.DialogResult =<span style="color: #000000;"> DialogResult.OK;
                </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Close();
            }
        }
//如果按下ESC键退出截图功能
        </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> CutPic_KeyUp(<span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, KeyEventArgs e)
        {
            </span><span style="color: #0000ff;">if</span> (e.KeyValue==<span style="color: #800080;">27</span><span style="color: #000000;">)
            {
                </span><span style="color: #0000ff;">this</span>.DialogResult =<span style="color: #000000;"> DialogResult.OK;
                </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Close();
            }
        }</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-size: 18px;">这样截图功能就已经实现了。</span><span style="font-size: 18px;">源代码下载，请<a href="http://agoodlife.cn/down/" target="_blank">点击</a></span></p>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>