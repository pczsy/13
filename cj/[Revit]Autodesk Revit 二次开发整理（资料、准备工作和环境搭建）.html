<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修[Revit]Autodesk Revit 二次开发整理（资料、准备工作和环境搭建）' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>[Revit]Autodesk Revit 二次开发整理（资料、准备工作和环境搭建）</center></div><div class='banquan'>原文出处:本文由博客园博主青烟绕指柔丶提供。<br/>
原文连接:https://www.cnblogs.com/Murphy-L/p/11252944.html</div><br>
    <h2 id="section">1 前言</h2>
<p>Revit被Autodesk收购之后，整理和开放了一大部分API，供开发者实现自己的功能和程序，总体来说API的功能比较完善，毕竟市面上已经出现了各式各样的插件。</p>
<p>本人也是初学者，在Revit分类中分享一些自己记录的笔记内容。</p>
<hr />
<h2 id="section-1">2 准备工作</h2>
<p>工欲善其事，必先利其器。</p>
<h3 id="section-2">2.1 语言</h3>
<p>首先，定下你自己想使用的编程语言，官方SDK中给出的语言示例包括<code>C#</code>、<code>VB</code>、<code>C++</code>三种，至于选择哪一种来开发，可以根据个人喜好和语言掌握情况。不过一般来说，大家都使用<code>C#</code>，<code>C#</code>出自微软Anders Hejlsberg团队之手，设计优美，配合上宇宙第一IDE和 .NET Framwork，开发起来效率很高。同时对于有UI需求的开发者来说，使用Winform或者WPF也可以让你快速完成UI界面的设计。</p>
<p>当然，如若你觉得<strong>人生苦短</strong>，也可以使用<code>Python</code>进行开发，Github上有一个开源项目叫做<a href="https://github.com/eirannejad/pyRevit">pyRevit</a>，这个插件为Revit提供了一个python脚本的运行环境和一些已有功能，你可以使用各路大神们用Python封装好的方法，实现你自己的业务。在此不多做介绍，有兴趣大家可以搜索相关资料学习。</p>
<h3 id="sdk">2.2 SDK</h3>
<p>选择好了适合你的语言，接下来需要去下载相关开发SDK，官方开发者中心有最新三年的SDK可以下载，如果你要下载再老的版本SDK，就需要你自己去网上搜索了。</p>
<p>我这里有一些老的SDK供大家选择下载：</p>
<ul>
<li><a href="https://download.csdn.net/download/ujsndsc182606/11019662">Revit 2014 SDK</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/11019714">Revit 2015 SDK</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/11019770">Revit 2016 SDK</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/11019784">Revit 2017 SDK</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/11019805">Revit 2018 SDK</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/11500459">Revit 2019 SDK</a></li>
</ul>
<p>SDK很重要，在此不禁让小学生水平的我吟诗一首，啊，SDK，你似那茫茫航洋中的灯塔，照亮我们前进的方向。个人理解，有了SDK你才知道你能做和不能做的界限，如果能做，也要根据SDK去决定该走什么路线、程序该怎么架构和设计等。</p>
<p>除了SDK，官方还提供了案例代码，可以从案例代码里面学习一些API的使用。</p>
<ul>
<li><a href="https://download.csdn.net/download/ujsndsc182606/11019762">Revit 2016 samples</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/11019794">Revit 2017 samples</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/11500834">Revit 2018 samples</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/11500514">Revit 2019 samples</a></li>
</ul>
<h3 id="section-3">2.3 辅助工具</h3>
<p>开发过程中使用一些特定工具，辅助提升你的开发效率还是很有必要的。</p>
<ol>
<li>RevitLookup
RevitLookup可以辅助开发人员在Revit中查看Revit底层数据库中的元素对象、属性、关系等内容，更加直观和方便，免除你去翻SDK一个一个查了；</li>
<li>AddInManager
AddInManager是用来在开发过程中调试你的命令和程序的，如果不使用AddInManager，那你调试起来就只能一遍一遍的重复关闭Revit，安装插件，再打开revit，测试，修改这样一个流程了，那么不出几天，就会变成Revit二次开发：</li>
</ol>
<div class="mermaid">graph LR
入门 --> 放弃
</div>
<p>传送门：</p>
<ul>
<li><a href="https://download.csdn.net/download/ujsndsc182606/10712844">RevitLookup 2015</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/9840688">RevitLookup 2016</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/10712831">RevitLookup 2017</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/11237234">RevitLookup 2018</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/10712885">AddinManager 2014</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/10712925">AddinManager 2015</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/10712943">AddinManager 2016</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/10712824">AddinManager 2017</a></li>
<li><a href="https://download.csdn.net/download/ujsndsc182606/10981455">AddinManager 2018</a></li>
</ul>
<p>安装完成，在Revit附加模块Tab页会出现如图所示工具：
<img src="./images/[Revit]Autodesk Revit 二次开发整理（资料、准备工作和环境搭建）0.png" alt="附加模块tab页" /></p>
<h3 id="ide">2.4 IDE</h3>
<p>如果你选择<code>C#或者C++</code>作为开发语言，那么宇宙第一IDE <code>Visual Studio</code>你值得拥有。当然，你也可以使用<code>Visual Studio Code</code>甚至<code>Notepad</code>。。。</p>
<p>如果你C盘空间还够，推荐大家下载使用<code>Visual Studio Community 2015/2017</code>，具体使用什么版本，还要根据你开发的Revit版本来决定，在安装VS的时候，注意勾选<strong>C#相关组件和高版本的 <code>.Net Framwork</code>开发工具</strong>，如果第一次没安装完全也可以在需要的时候运行安装程序修改安装配置。
<img src="./images/[Revit]Autodesk Revit 二次开发整理（资料、准备工作和环境搭建）1.png" alt="勾选工作负载" /></p>
<p>如果你选择<code>python</code>，可以使用VSC或者<code>PyCharm</code>。</p>
<h3 id="section-4">2.5 资料</h3>
<p>相关参考资料除了有SDK和官方给的参考代码案例外，还有国内外各类论坛里面的相关帖子。</p>
<p>比如叶雄进老师的博客，面市的相关书籍等。</p>
<hr />
<h2 id="section-5">3 开始第一个项目搭建</h2>
<p>这里以VS为例。</p>
<h3 id="section-6">3.1 新建工作项目</h3>
<ol>
<li>打开Visual Studio，点击文件 ---&gt; 新建 ---&gt; 项目；
<img src="./images/[Revit]Autodesk Revit 二次开发整理（资料、准备工作和环境搭建）2.png" alt="" /></li>
<li>项目类型选择，Visual C# ---&gt; 类库(.NET Framwork)，根据要开发revit的插件的版本，选择 .Net framwork版本，自己起一个名称，选择一个存储位置，点击确定；
<img src="./images/[Revit]Autodesk Revit 二次开发整理（资料、准备工作和环境搭建）3.png" alt="" />
VS会默认给你创建如下模板：
<img src="./images/[Revit]Autodesk Revit 二次开发整理（资料、准备工作和环境搭建）4.png" alt="" /></li>
</ol>
<h3 id="section-7">3.2 添加项目引用</h3>
<ol>
<li>添加Revit API引用，从Revit安装目录中找到<code>RevitAPIUI.dll</code>和<code>RevitAPI.dll</code>，这是两个最常用的动态链接库；
在项目解决方案浏览器中右键引用一项，选择添加引用，浏览找到上述两个dll文件，确定；
<img src="./images/[Revit]Autodesk Revit 二次开发整理（资料、准备工作和环境搭建）5.png" alt="" /></li>
</ol>
<p>确定之后，引用一项就会变成如图所示：
<img src="./images/[Revit]Autodesk Revit 二次开发整理（资料、准备工作和环境搭建）6.png" alt="" /></p>
<p>可以选择性的执行，将这两个dll的<code>复制本地</code>属性改为<code>False</code>，改为False，生成项目的时候这两个dll文件就不会复制到生成目录中，根据个人喜好设置~</p>
<ol start="2">
<li>引用Revit命名空间。
<code>Class1.cs</code>文件最上面添加对Revit最常用命名空间的引用：</li>
</ol>
<pre><code><code class="language-csharp">using Autodesk.Revit.DB;
using Autodesk.Revit.UI;
</code></pre>
<p>至此，一个revit最简单的插件环境已经搭建完毕。</p>
<p>接下来，就可以针对具体业务写业务代码了。</p>
<h3 id="section-8">3.3 修改项目属性</h3>
<p>项目默认的平台目标是<code>Any CPU</code>，写完代码直接生成会弹出<code>MSB3270</code>警告，如下：</p>
<pre><code><code>1&gt;------ 已启动全部重新生成: 项目: FirstRevitPlugin, 配置: Debug Any CPU ------
1&gt;E:\Visual Studio 2017\MSBuild\15.0\Bin\Microsoft.Common.CurrentVersion.targets(1987,5): warning MSB3270: 所生成项目的处理器架构“MSIL”与引用“RevitAPI”的处理器架构“AMD64”不匹配。这种不匹配可能会导致运行时失败。请考虑通过配置管理器更改您的项目的目标处理器架构，以使您的项目与引用间的处理器架构保持一致，或者为引用关联一个与您的项目的目标处理器架构相符的处理器架构。
1&gt;E:\Visual Studio 2017\MSBuild\15.0\Bin\Microsoft.Common.CurrentVersion.targets(1987,5): warning MSB3270: 所生成项目的处理器架构“MSIL”与引用“RevitAPIUI”的处理器架构“AMD64”不匹配。这种不匹配可能会导致运行时失败。请考虑通过配置管理器更改您的项目的目标处理器架构，以使您的项目与引用间的处理器架构保持一致，或者为引用关联一个与您的项目的目标处理器架构相符的处理器架构。
</code></pre>
<p>需要在解决方案管理器中，右键项目名称---&gt;属性---&gt;生成，将<code>平台目标</code>改为<code>x64</code>；
再次生成就不会弹出该警告。
生成的dll文件会在该项目文件夹下的bin---&gt;debug目录或者bin---&gt;release目录。
<img src="./images/[Revit]Autodesk Revit 二次开发整理（资料、准备工作和环境搭建）7.png" alt="" /></p>
<blockquote>
<p>注：</p>
<ol>
<li>以上，除了必备的生产工具外，不必全部准备，可以从简单业务入门，带着任务去学习。</li>
<li>现在好像资源分数由系统决定了，之前都是设置0分或者1分，现在自己不可以设定资源分数了~</li>
<li>不能下载的可以找其它资源下载。</li>
</ol>
</blockquote>
<p>暂时就先写这么多吧。</p>
<hr />
<h2 id="section-9">4 结语</h2>
<p>万事开头难，当时刚开始学习写插件码代码的时候也是会踩到各种各样的坑，但好在网上有各种各样的解决方案（比心 ❤️），善用互联网上的优质资源，可以帮助大家快速熟悉整个开发过程，并解决你大部分的问题。</p>
<p>如有错误，恳请指正。</p>
<blockquote>
<center>Murphy.L</center>
<hr />
<center>Perhaps, we’ve just forgotten that we are still <b>pioneers</b>.</center>
</blockquote>

</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>