<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修我的开发助手之时间线控件' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>我的开发助手之时间线控件</center></div><div class='banquan'>原文出处:本文由博客园博主wxdongtt2007提供。<br/>
原文连接:https://www.cnblogs.com/wxdongtt2007/p/11421494.html</div><br>
    <p>&nbsp; &nbsp; 数年前因为某个原因，开始编写的我的开发助手，一路艰辛，一路坚持，目前仍不断完善之中，项目地址：<a href="https://gitee.com/sqlorm/DevelopAssistant" data-cke-saved-href="https://gitee.com/sqlorm/DevelopAssistant">https://gitee.com/sqlorm/DevelopAssistant</a>&nbsp;欢迎大家点赞和支持。</p>
<p>&nbsp; &nbsp; 今天想和大家分享一下其中的时间线控件，这是一个通过GDI绘制和对原有事件重写来实现的用户自定义控件，界面还算美观，操作也很简捷，喜欢的同学不妨收下。</p>
<p>&nbsp; &nbsp; 控件是这样子的：&nbsp; &nbsp;&nbsp;</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_image cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="18"><span class="cke_image_resizer_wrapper"><img style="display: block; margin-left: auto; margin-right: auto;" src="./images/我的开发助手之时间线控件0.png" alt="" width="258" height="120" data-cke-saved-src="./images/我的开发助手之时间线控件0.png" /><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></div>
<div class="cke_widget_wrapper cke_widget_block cke_widget_image cke_widget_selected" style="text-align: center;" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="18"><span class="cke_image_resizer_wrapper"><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">没有内容时界面</span></span><span class="cke_reset cke_widget_drag_handler_container"><img class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="15" height="15" data-cke-widget-drag-handler="1" /></span></div>
<p>&nbsp;</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_image cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="17"><span class="cke_image_resizer_wrapper"><img style="display: block; margin-left: auto; margin-right: auto;" src="./images/我的开发助手之时间线控件2.png" alt="" width="310" height="630" data-cke-saved-src="./images/我的开发助手之时间线控件2.png" /><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></div>
<div class="cke_widget_wrapper cke_widget_block cke_widget_image cke_widget_selected" style="text-align: center;" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="17"><span class="cke_image_resizer_wrapper"><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">管理界面带编辑功能界面</span></span><span class="cke_reset cke_widget_drag_handler_container"><img class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="15" height="15" data-cke-widget-drag-handler="1" /></span></div>
<p>&nbsp; &nbsp; 下面就来介绍一下关于这个控件的开发：</p>
<p>&nbsp; &nbsp; 第一步、我们创建一个类继承&nbsp;UserControl</p>
<p>&nbsp; &nbsp; 控件主要对&nbsp;OnPaint ，OnMouseClick ，OnMouseMove，OnSizeChanged，OnMouseWheel 方法进行重写，其中&nbsp;OnPaint 方法用户界面元素的绘制，并在该方法里面计算控件元素的绘制区域，以便在OnMouseClick 重写方法里实现元素的点击事件，OnMouseClick 方法就是实现控件元素的点击事件，OnMouseMove 主要实体一些鼠标特效，例如滑动鼠标改变背景色，改变控件默认光标形状等，OnSizeChanged 方法主要实现当改变控件大小时控件控件滚动条相关属性的计算和触发控件元素重绘及事件区域范围Rectangle的计算，通过判断鼠标点击的位置属于哪个元素的区域范围来确定触发哪个元素的相关事件，OnMouseWheel&nbsp; 鼠标滚轮滚动时发生。其实winform下自定义控件特别是通过GDI绘制来实现的一类基本上都是实现上述几个事件方法来实现，可以用一张图来概括：</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="16">
<p class="cke_widget_element" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/我的开发助手之时间线控件4.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;center&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image"><span class="cke_image_resizer_wrapper"><img class="has" style="display: block; margin-left: auto; margin-right: auto;" src="./images/我的开发助手之时间线控件4.png" alt="" data-cke-saved-src="./images/我的开发助手之时间线控件4.png" /><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></p>
<span class="cke_reset cke_widget_drag_handler_container"><img class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="15" height="15" data-cke-widget-drag-handler="1" /></span></div>
<p>&nbsp; &nbsp; 第二步、定义控件的内部元素</p>
<p>&nbsp; &nbsp; 控件主要涉及到 月份对象元素： MonthItem ，日期对象元素：DateItem ，时间对象元素：DateTimeItem 他们都继承自公共对象元素：TimelineItem 他们都有公同的属性Id (与数据库表主键做关联)，Name 名称，Tag 其它数据相关绑定的标签。其次MonthItem和&nbsp;DateItem 都有&nbsp;Bound 属于，用户保存该元素在控件中的绘制区域。下面贴出这三个元素实体类的代码：&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>&nbsp; &nbsp; MonthItem：</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="15">
<div class="cnblogs_code" style="text-align: left;">
<pre><code><span style="color: #000000;">    [Serializable]
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> MonthItem : TimelineItem
    {
        </span><span style="color: #0000ff;">public</span> DateTime Date { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> DateLabel { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> List&lt;DateItem&gt; List { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

        </span><span style="color: #0000ff;">internal</span> Size Size { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">internal</span> Rectangle Bound { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
    }</span></pre>
</div>
<p><img class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="15" height="15" data-cke-widget-drag-handler="1" />&nbsp; &nbsp; &nbsp;DateItem：&nbsp; &nbsp;</p>
</div>
<div class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="14">
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">    [Serializable]
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> DateItem : TimelineItem
    {
        </span><span style="color: #0000ff;">public</span> DateTime Date { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }      
        </span><span style="color: #0000ff;">public</span> List&lt;DateTimeItem&gt; List { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

        </span><span style="color: #0000ff;">internal</span> Size Size { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">internal</span> Rectangle Bound { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">internal</span> Rectangle AddRect { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">internal</span> Rectangle ClickRect { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">bool</span> Selected { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

        </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> _tag;
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> Tag
        {
            </span><span style="color: #0000ff;">get</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">string</span><span style="color: #000000;">.IsNullOrEmpty(_tag))
                {
                    _tag </span>= Date.ToString(<span style="color: #800000;">"</span><span style="color: #800000;">yyyyMMdd</span><span style="color: #800000;">"</span><span style="color: #000000;">);
                }
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> _tag;
            }
        }

    }</span></pre>
</div>
<p><img class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="15" height="15" data-cke-widget-drag-handler="1" />&nbsp; &nbsp; DateTimeItem ：&nbsp;&nbsp;</p>
</div>
<div class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="13">
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">    [Serializable]
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> DateTimeItem : TimelineItem
    {       
        </span><span style="color: #0000ff;">public</span> Image Icon { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Title { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; } 
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Summary { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Description { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> ToolTip { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> PersonName { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> DateTime DateTime { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> ImportantLevel Level { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> Timeliness Timeliness { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> ResponsiblePerson { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

        </span><span style="color: #0000ff;">internal</span> Rectangle EditRect { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">internal</span> Rectangle DeleteRect { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 0 :默认 1：修改  2：删除
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #0000ff;">internal</span> <span style="color: #0000ff;">int</span> ButtonState { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> Rectangle ClickRect { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">bool</span> Selected { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

        </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> _tag;
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> Tag
        {
            </span><span style="color: #0000ff;">get</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">string</span><span style="color: #000000;">.IsNullOrEmpty(_tag))
                {
                    _tag </span>= DateTime.ToString(<span style="color: #800000;">"</span><span style="color: #800000;">yyyyMMddHHmmss</span><span style="color: #800000;">"</span><span style="color: #000000;">);
                }
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> _tag;
            }
        }

    }</span></pre>
</div>
<p><img class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="15" height="15" data-cke-widget-drag-handler="1" /></p>
</div>
<p>&nbsp; &nbsp; 第三步、绘制控件内部的元素</p>
<p>&nbsp; &nbsp; 绘制控件内部的元素主要分为绘制&nbsp;TimelineItem 一类（包括 MonthItem ，DateItem 和 DateTimeItem）和 控件的滚动条，一般来讲winform 控件自带的滚动条都由系统绘制，往往和操作系统息息相关，这里我们的时间线控件要适合开发助手相关的主题，所以我们采用在内部自己绘制滚动条，通过主要对OnMouseMove，OnMouseWheel两相事件方法进行重写来实现滚动条的控件。</p>
<p>&nbsp; &nbsp;这里对TimelineItem 一类的元素绘制主要贴出以下代码：&nbsp; &nbsp;</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="12">
<div class="cnblogs_code">
<pre><code><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 计算 TimelineItem 绘制区域 通过对 MonthItem 子元素递规循环计算 整个 MonthItem 元素的绘制区域
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="g"&gt;&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="index"&gt;&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="item"&gt;&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color: #0000ff;">private</span> Rectangle MeasureItemBound(Graphics g, <span style="color: #0000ff;">int</span><span style="color: #000000;"> index, MonthItem item)
        {
            </span><span style="color: #0000ff;">int</span> itemHeight = <span style="color: #800080;">46</span><span style="color: #000000;">;
            </span><span style="color: #0000ff;">if</span> (item.List != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
            {
                </span><span style="color: #0000ff;">foreach</span> (DateItem subItem <span style="color: #0000ff;">in</span><span style="color: #000000;"> item.List)
                {
                    </span><span style="color: #0000ff;">if</span> (subItem.List != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
                    {
                        </span><span style="color: #0000ff;">foreach</span>(DateTimeItem subsubItem <span style="color: #0000ff;">in</span><span style="color: #000000;"> subItem.List)
                        {
                            itemHeight </span>= itemHeight + <span style="color: #800080;">32</span><span style="color: #000000;">;
                            </span><span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">string</span><span style="color: #000000;">.IsNullOrEmpty(subsubItem.Summary))
                            {
                                itemHeight </span>= itemHeight + <span style="color: #800080;">26</span><span style="color: #000000;">;
                            }
                        }
                    }
                    itemHeight </span>= itemHeight + <span style="color: #800080;">32</span><span style="color: #000000;">;
                }               
            }
            Rectangle rect </span>= <span style="color: #0000ff;">new</span> Rectangle(drawPositionOffset.X + padding.Left, drawPositionOffset.Y + position, <span style="color: #0000ff;">this</span>.Width - padding.Left - padding.Right - (scrollerBarVisable ? <span style="color: #800080;">0</span><span style="color: #000000;"> : scrollerBarWidth), itemHeight);
            position </span>= position +<span style="color: #000000;"> itemHeight;
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> rect;
        }</span></pre>
</div>
<p><img class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="15" height="15" data-cke-widget-drag-handler="1" /></p>
</div>
<div class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="11">
<div class="cnblogs_code">
<pre><code><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 绘制 MonthItem 元素，包括下面的  DateItem 和  DateTimeItem 子元素
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="g"&gt;&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="index"&gt;&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="item"&gt;&lt;/param&gt;</span>
        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> DrawTimelineItem(Graphics g, <span style="color: #0000ff;">int</span><span style="color: #000000;"> index, MonthItem item)
        {
            StringFormat sf </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> StringFormat();
            sf.Alignment </span>=<span style="color: #000000;"> StringAlignment.Center;
            sf.LineAlignment </span>=<span style="color: #000000;"> StringAlignment.Center;

            </span><span style="color: #008000;">//</span><span style="color: #008000;"> margin</span>
            Rectangle bound =<span style="color: #000000;"> item.Bound;
            
            </span><span style="color: #008000;">//</span><span style="color: #008000;">g.DrawRectangle(new Pen(SystemColors.ControlDark), bound);</span>
            g.DrawLine(<span style="color: #0000ff;">new</span> Pen(SystemColors.ControlLight) { DashStyle = System.Drawing.Drawing2D.DashStyle.Dot }, <span style="color: #800080;">5</span>, bound.Top + <span style="color: #800080;">23</span>, bound.Width - <span style="color: #800080;">10</span>, bound.Top + <span style="color: #800080;">23</span><span style="color: #000000;">);

            Point start </span>= <span style="color: #0000ff;">new</span> Point(<span style="color: #800080;">5</span> + <span style="color: #800080;">18</span>, bound.Top + (index &gt; <span style="color: #800080;">0</span> ? <span style="color: #800080;">0</span> : <span style="color: #800080;">5</span><span style="color: #000000;">));
            Point end </span>= <span style="color: #0000ff;">new</span> Point(<span style="color: #800080;">5</span> + <span style="color: #800080;">18</span>, bound.Bottom - (index &lt; <span style="color: #0000ff;">this</span>.DataList.Count - <span style="color: #800080;">1</span> ? <span style="color: #800080;">0</span> : <span style="color: #800080;">5</span><span style="color: #000000;">));
            g.DrawLine(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Pen(SystemColors.ControlLight), start, end);

            Rectangle iconRect </span>= <span style="color: #0000ff;">new</span> Rectangle(<span style="color: #800080;">5</span>, bound.Top + <span style="color: #800080;">5</span>, <span style="color: #800080;">36</span>, <span style="color: #800080;">36</span><span style="color: #000000;">);
            g.FillEllipse(Brushes.Orange, iconRect);
            g.DrawString(item.DateLabel, </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Font, Brushes.White, iconRect, sf);

            </span><span style="color: #0000ff;">if</span> (item.List != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
            {
                StringFormat subSf </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> StringFormat();
                subSf.LineAlignment </span>=<span style="color: #000000;"> StringAlignment.Center;
                Font subTitleFont </span>= <span style="color: #0000ff;">new</span> Font(<span style="color: #800000;">"</span><span style="color: #800000;">仿宋</span><span style="color: #800000;">"</span>, <span style="color: #800080;">12</span>, FontStyle.Bold |<span style="color: #000000;"> FontStyle.Italic) { };

                </span><span style="color: #0000ff;">int</span> top = bound.Top + <span style="color: #800080;">15</span><span style="color: #000000;">;
                </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; item.List.Count; i++<span style="color: #000000;">)
                {
                    top </span>= top + <span style="color: #800080;">32</span><span style="color: #000000;">;
                    DateItem subItem </span>=<span style="color: #000000;"> item.List[i];

                    Rectangle subIconRect </span>= <span style="color: #0000ff;">new</span> Rectangle(<span style="color: #800080;">5</span> + <span style="color: #800080;">12</span>, top + <span style="color: #800080;">9</span>, <span style="color: #800080;">12</span>, <span style="color: #800080;">12</span><span style="color: #000000;">);
                    g.FillEllipse(Brushes.Orange, subIconRect);
                    </span><span style="color: #008000;">//</span><span style="color: #008000;">g.DrawEllipse(new Pen(Color.Orange) { Width=2.0f }, subIconRect);
                    </span><span style="color: #008000;">//</span><span style="color: #008000;">g.DrawString((i + 1).ToString(), this.Font, Brushes.White, subIconRect, sf);</span>
                    subIconRect.Inflate(-<span style="color: #800080;">2</span>, -<span style="color: #800080;">2</span><span style="color: #000000;">);
                    g.FillEllipse(Brushes.White, subIconRect);

                    Rectangle subRect </span>= <span style="color: #0000ff;">new</span> Rectangle(<span style="color: #800080;">56</span>, top, bound.Width - <span style="color: #800080;">64</span>, <span style="color: #800080;">32</span><span style="color: #000000;">);
                    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (subItem.Selected)
                    {
                        </span><span style="color: #0000ff;">using</span> (<span style="color: #0000ff;">var</span> roundedRectanglePath = CreateRoundedRectanglePath(subRect, <span style="color: #800080;">2</span><span style="color: #000000;">))
                        {
                            g.FillPath(</span><span style="color: #0000ff;">new</span> SolidBrush(Color.FromArgb(<span style="color: #800080;">240</span>, <span style="color: #800080;">245</span>, <span style="color: #800080;">249</span><span style="color: #000000;">)), roundedRectanglePath);
                        }
                    }

                    Rectangle subTitleRect </span>= <span style="color: #0000ff;">new</span> Rectangle(<span style="color: #800080;">56</span>, top, bound.Width - <span style="color: #800080;">64</span> - <span style="color: #800080;">30</span>, <span style="color: #800080;">32</span><span style="color: #000000;">);
                    </span><span style="color: #008000;">//</span><span style="color: #008000;">g.DrawRectangle(new Pen(Color.Orange), subTitleRect);
                    </span><span style="color: #008000;">//</span><span style="color: #008000;">g.DrawString((i + 1) + "、" + subItem.Title, this.Font, Brushes.Red, subTitleRect, subSf);</span>
<span style="color: #000000;">
                    Brush subTitleBrush </span>=<span style="color: #000000;"> Brushes.Black;                   
                    g.DrawString(subItem.Date.ToString(</span><span style="color: #800000;">"</span><span style="color: #800000;">yyyy-MM-dd</span><span style="color: #800000;">"</span><span style="color: #000000;">), subTitleFont, subTitleBrush, subTitleRect, subSf);
                    </span><span style="color: #008000;">//</span><span style="color: #008000;">g.FillRectangle(Brushes.Red, subTitleRect);</span>
<span style="color: #000000;">
                    Rectangle subOptionRect </span>= <span style="color: #0000ff;">new</span> Rectangle(bound.X + bound.Width - <span style="color: #800080;">34</span> + <span style="color: #800080;">4</span>, top + <span style="color: #800080;">8</span>, <span style="color: #800080;">16</span>, <span style="color: #800080;">16</span><span style="color: #000000;">);
                    </span><span style="color: #008000;">//</span><span style="color: #008000;">g.FillRectangle(Brushes.Yellow, subOptionRect);</span>
                    g.DrawImage(<span style="color: #0000ff;">this</span>.TimeLineIcons.Images[<span style="color: #800080;">2</span><span style="color: #000000;">], subOptionRect);
                    subItem.AddRect </span>=<span style="color: #000000;"> subOptionRect;
                    subItem.ClickRect </span>=<span style="color: #000000;"> subRect;

                    </span><span style="color: #0000ff;">if</span> (subItem.List != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
                    {
                        </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> j = <span style="color: #800080;">0</span>; j &lt; subItem.List.Count; j++<span style="color: #000000;">)
                        {
                            top </span>= top + <span style="color: #800080;">32</span><span style="color: #000000;">;
                            DateTimeItem subsubItem </span>=<span style="color: #000000;"> subItem.List[j];

                            </span><span style="color: #008000;">//</span><span style="color: #008000;">Rectangle subsubIconRect = new Rectangle(5 + 14, top + 10, 8, 8);
                            </span><span style="color: #008000;">//</span><span style="color: #008000;">g.FillEllipse(Brushes.Orange, subsubIconRect);
                            </span><span style="color: #008000;">//</span><span style="color: #008000;">subsubIconRect.Inflate(-2, -2);
                            </span><span style="color: #008000;">//</span><span style="color: #008000;">g.FillEllipse(Brushes.White, subsubIconRect);</span>
<span style="color: #000000;">
                            Rectangle DateTimeItemClickRect </span>= <span style="color: #0000ff;">new</span> Rectangle(<span style="color: #800080;">56</span>, top + <span style="color: #800080;">2</span>, bound.Width - <span style="color: #800080;">64</span>, <span style="color: #800080;">28</span><span style="color: #000000;">);

                            </span><span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">string</span><span style="color: #000000;">.IsNullOrEmpty(subsubItem.Summary))
                                DateTimeItemClickRect </span>= <span style="color: #0000ff;">new</span> Rectangle(DateTimeItemClickRect.X, DateTimeItemClickRect.Y, DateTimeItemClickRect.Width, DateTimeItemClickRect.Height + <span style="color: #800080;">32</span><span style="color: #000000;">);

                            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (subsubItem.Selected)
                            {
                                </span><span style="color: #0000ff;">using</span> (<span style="color: #0000ff;">var</span> roundedRectanglePath = CreateRoundedRectanglePath(DateTimeItemClickRect, <span style="color: #800080;">2</span><span style="color: #000000;">))
                                {
                                    g.FillPath(</span><span style="color: #0000ff;">new</span> SolidBrush(Color.FromArgb(<span style="color: #800080;">240</span>, <span style="color: #800080;">245</span>, <span style="color: #800080;">249</span><span style="color: #000000;">)), roundedRectanglePath);
                                }
                            }

                            Brush drawTitleBrush </span>=<span style="color: #000000;"> Brushes.Black;
                            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (subsubItem.Selected)
                                drawTitleBrush </span>=<span style="color: #000000;"> Brushes.Blue;

                            Color drawTitleColor </span>=<span style="color: #000000;"> Color.Black;
                            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (subsubItem.Selected)
                                drawTitleColor </span>=<span style="color: #000000;"> Color.Blue;

                            </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">subsubItem.Selected)
                            {
                                </span><span style="color: #0000ff;">switch</span><span style="color: #000000;"> (subsubItem.Level)
                                {
                                    </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> ImportantLevel.Important:
                                        drawTitleColor </span>=<span style="color: #000000;"> Color.Orange;
                                        </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                                    </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> ImportantLevel.MoreImportant:
                                        drawTitleColor </span>=<span style="color: #000000;"> Color.Brown;
                                        </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                                    </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> ImportantLevel.MostImportant:
                                        drawTitleColor </span>=<span style="color: #000000;"> Color.Red;
                                        </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                                }
                            }

                            </span><span style="color: #008000;">//</span><span style="color: #008000;">Rectangle subsubImgRect = new Rectangle(56 + 0, top + 7, 16, 16);</span>
                            <span style="color: #808080;">///</span><span style="color: #008000;">/g.FillEllipse(Brushes.Red, subsubImgRect);</span>
                            <span style="color: #008000;">//</span><span style="color: #008000;">g.DrawImage(this.TimeLineIcons.Images[2], subsubImgRect);</span>
<span style="color: #000000;">
                            Brush itemIconBrush </span>=<span style="color: #000000;"> Brushes.Red;
                            </span><span style="color: #0000ff;">switch</span><span style="color: #000000;"> (subsubItem.Timeliness)
                            {
                                </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> Timeliness.Normal:
                                    itemIconBrush </span>=<span style="color: #000000;"> Brushes.Green;
                                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                                </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> Timeliness.Yellow:
                                    itemIconBrush </span>=<span style="color: #000000;"> Brushes.Yellow;
                                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                                </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> Timeliness.Orange:
                                    itemIconBrush </span>=<span style="color: #000000;"> Brushes.Orange;
                                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                                </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> Timeliness.Red:
                                    itemIconBrush </span>=<span style="color: #000000;"> Brushes.Red;
                                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                                </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> Timeliness.Dark:
                                    itemIconBrush </span>=<span style="color: #000000;"> Brushes.Gray;
                                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                                </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> Timeliness.Black:
                                    itemIconBrush </span>=<span style="color: #000000;"> Brushes.Black;
                                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                            }

                            </span><span style="color: #0000ff;">int</span> m = <span style="color: #800080;">20</span><span style="color: #000000;">;
                            Rectangle subsubImgRect </span>=<span style="color: #000000;"> Rectangle.Empty;
                            </span><span style="color: #0000ff;">if</span> (subsubItem.Icon != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
                            {
                                </span><span style="color: #0000ff;">if</span> (subsubItem.Icon.Height == <span style="color: #800080;">16</span><span style="color: #000000;">)
                                {
                                    m </span>= <span style="color: #800080;">20</span><span style="color: #000000;">;
                                    subsubImgRect </span>= <span style="color: #0000ff;">new</span> Rectangle(<span style="color: #800080;">56</span> + <span style="color: #800080;">0</span>, top + <span style="color: #800080;">3</span>, <span style="color: #800080;">16</span>, <span style="color: #800080;">16</span><span style="color: #000000;">);
                                }
                                </span><span style="color: #0000ff;">if</span> (subsubItem.Icon.Height == <span style="color: #800080;">24</span><span style="color: #000000;">)
                                {
                                    m </span>= <span style="color: #800080;">28</span><span style="color: #000000;">;
                                    subsubImgRect </span>= <span style="color: #0000ff;">new</span> Rectangle(<span style="color: #800080;">56</span> + <span style="color: #800080;">0</span>, top + <span style="color: #800080;">3</span>, <span style="color: #800080;">24</span>, <span style="color: #800080;">24</span><span style="color: #000000;">);
                                } 
                                </span><span style="color: #0000ff;">else</span><span style="color: #000000;">
                                {
                                    </span><span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> Exception(<span style="color: #800000;">"</span><span style="color: #800000;">只支持16*16、24*24大小的图标</span><span style="color: #800000;">"</span><span style="color: #000000;">);
                                }
                                g.DrawImage(subsubItem.Icon, subsubImgRect);
                            }
                            </span><span style="color: #0000ff;">else</span><span style="color: #000000;">
                            {
                                </span><span style="color: #0000ff;">if</span>(!<span style="color: #0000ff;">string</span><span style="color: #000000;">.IsNullOrEmpty(subsubItem.PersonName))
                                {
                                    m </span>= <span style="color: #800080;">28</span><span style="color: #000000;">;
                                    subsubImgRect </span>= <span style="color: #0000ff;">new</span> Rectangle(<span style="color: #800080;">56</span> + <span style="color: #800080;">0</span>, top + <span style="color: #800080;">3</span>, <span style="color: #800080;">24</span>, <span style="color: #800080;">24</span><span style="color: #000000;">);
                                }
                                </span><span style="color: #0000ff;">else</span><span style="color: #000000;">
                                {
                                    m </span>= <span style="color: #800080;">20</span><span style="color: #000000;">;
                                    subsubImgRect </span>= <span style="color: #0000ff;">new</span> Rectangle(<span style="color: #800080;">56</span> + <span style="color: #800080;">0</span>, top + <span style="color: #800080;">7</span>, <span style="color: #800080;">16</span>, <span style="color: #800080;">16</span><span style="color: #000000;">);
                                }                               
                                g.FillEllipse(itemIconBrush, subsubImgRect);

                                </span><span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">string</span><span style="color: #000000;">.IsNullOrEmpty(subsubItem.PersonName))
                                {
                                    Brush showNameBrush </span>=<span style="color: #000000;"> Brushes.White;
                                    Font showNameFont </span>= <span style="color: #0000ff;">new</span> Font(<span style="color: #800000;">"</span><span style="color: #800000;">微软雅黑</span><span style="color: #800000;">"</span>, <span style="color: #800080;">8</span><span style="color: #000000;">, FontStyle.Bold);

                                    </span><span style="color: #0000ff;">if</span> (itemIconBrush == Brushes.Red ||<span style="color: #000000;">
                                        itemIconBrush </span>==<span style="color: #000000;"> Brushes.Yellow)
                                    {
                                        showNameBrush </span>=<span style="color: #000000;"> Brushes.Black;
                                    }

                                    g.DrawString(subsubItem.PersonName, showNameFont, showNameBrush, subsubImgRect, sf);
                                }

                            }

                            </span><span style="color: #008000;">//</span><span style="color: #008000;">Rectangle subsubTitleRect = new Rectangle(56 + 20, top, bound.Width - 84 - 60, 32);</span>
                            Rectangle subsubTitleRect = <span style="color: #0000ff;">new</span> Rectangle(<span style="color: #800080;">56</span> + m, top, bound.Width - <span style="color: #800080;">84</span> - <span style="color: #800080;">60</span>, <span style="color: #800080;">32</span><span style="color: #000000;">);
                            </span><span style="color: #008000;">//</span><span style="color: #008000;">g.DrawRectangle(new Pen(Color.Orange), subsubTitleRect);
                            </span><span style="color: #008000;">//</span><span style="color: #008000;">g.DrawString((i + 1) + "、" + subItem.Title, this.Font, Brushes.Red, subTitleRect, subSf);
                            </span><span style="color: #008000;">//</span><span style="color: #008000;">g.DrawString(subsubItem.Title, this.Font, drawTitleBrush, subsubTitleRect, subSf);</span>
                            TextRenderer.DrawText(g, subsubItem.Title, <span style="color: #0000ff;">this</span>.Font, subsubTitleRect, drawTitleColor, TextFormatFlags.Left | TextFormatFlags.WordEllipsis |<span style="color: #000000;"> TextFormatFlags.VerticalCenter);

                            </span><span style="color: #0000ff;">if</span> (_isEditModel &amp;&amp;<span style="color: #000000;"> subsubItem.Selected)
                            {
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">绘制删除按扭</span>
                                Size subsubTitleSize = TextRenderer.MeasureText(g, subsubItem.Title, <span style="color: #0000ff;">this</span><span style="color: #000000;">.Font);
                                subsubItem.EditRect </span>= <span style="color: #0000ff;">new</span> Rectangle(subsubTitleRect.X + subsubTitleSize.Width + <span style="color: #800080;">2</span>, top + <span style="color: #800080;">8</span>, <span style="color: #800080;">16</span>, <span style="color: #800080;">16</span><span style="color: #000000;">);
                                subsubItem.DeleteRect </span>= <span style="color: #0000ff;">new</span> Rectangle(subsubTitleRect.X + subsubTitleSize.Width + <span style="color: #800080;">2</span> + <span style="color: #800080;">16</span> + <span style="color: #800080;">4</span>, top + <span style="color: #800080;">8</span>, <span style="color: #800080;">16</span>, <span style="color: #800080;">16</span><span style="color: #000000;">);
                            }

                            Rectangle subsubTimeRect </span>= <span style="color: #0000ff;">new</span> Rectangle(bound.Width - <span style="color: #800080;">64</span>, top, <span style="color: #800080;">56</span>, <span style="color: #800080;">32</span><span style="color: #000000;">);
                            </span><span style="color: #008000;">//</span><span style="color: #008000;">g.FillRectangle(Brushes.Green, subsubTimeRect);
                            </span><span style="color: #008000;">//</span><span style="color: #008000;">g.DrawString((i + 1) + "、" + subItem.Title, this.Font, Brushes.Red, subTitleRect, subSf);</span>
                            g.DrawString(subsubItem.DateTime.ToString(<span style="color: #800000;">"</span><span style="color: #800000;">HH:mm:ss</span><span style="color: #800000;">"</span>), <span style="color: #0000ff;">this</span><span style="color: #000000;">.Font, drawTitleBrush, subsubTimeRect, subSf);

                            </span><span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">string</span><span style="color: #000000;">.IsNullOrEmpty(subsubItem.Summary))
                            {
                                Font drawSummaryFont </span>= <span style="color: #0000ff;">this</span><span style="color: #000000;">.Font;
                                Brush drawSummaryBrush </span>=<span style="color: #000000;"> Brushes.Gray;
                                Color drawSummaryColor </span>=<span style="color: #000000;"> Color.Gray;

                                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (subsubItem.Selected)
                                {
                                    drawSummaryBrush </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> SolidBrush(SystemColors.ControlDark);
                                    </span><span style="color: #008000;">//</span><span style="color: #008000;">drawSummaryFont = new Font(this.Font, FontStyle.Italic);</span>
                                    drawSummaryColor =<span style="color: #000000;"> SystemColors.ControlDark;
                                }

                                top </span>= top + <span style="color: #800080;">32</span><span style="color: #000000;">;
                                Rectangle subsubSummaryRect </span>= <span style="color: #0000ff;">new</span> Rectangle(<span style="color: #800080;">56</span>, top, bound.Width - <span style="color: #800080;">64</span>, <span style="color: #800080;">26</span><span style="color: #000000;">);
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">g.DrawRectangle(Pens.Red, subsubSummaryRect);
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">g.DrawString(subsubItem.Summary, drawSummaryFont, drawSummaryBrush, subsubSummaryRect, subSf);</span>
                                TextRenderer.DrawText(g, subsubItem.Summary, drawSummaryFont, subsubSummaryRect, drawSummaryColor, TextFormatFlags.Left | TextFormatFlags.WordEllipsis |<span style="color: #000000;"> TextFormatFlags.VerticalCenter);

                            }

                            subsubItem.ClickRect </span>=<span style="color: #000000;"> DateTimeItemClickRect;

                            g.DrawLine(</span><span style="color: #0000ff;">new</span> Pen(SystemColors.ControlLight) { DashStyle = System.Drawing.Drawing2D.DashStyle.Dot }, <span style="color: #800080;">56</span>, top + <span style="color: #800080;">32</span>, bound.Width - <span style="color: #800080;">10</span>, top + <span style="color: #800080;">32</span><span style="color: #000000;">);

                            </span><span style="color: #0000ff;">if</span> (_isEditModel &amp;&amp;<span style="color: #000000;"> subsubItem.Selected)
                            {
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">switch (subsubItem.ButtonState)
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">{
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">    case 1:
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">        g.FillRectangle(new SolidBrush(Color.Orange), subsubItem.EditRect);
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">        g.FillRectangle(new SolidBrush(Color.FromArgb(240, 245, 249)), subsubItem.DeleteRect);
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">        break;
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">    case 2:
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">        g.FillRectangle(new SolidBrush(Color.FromArgb(240, 245, 249)), subsubItem.EditRect);
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">        g.FillRectangle(new SolidBrush(Color.Orange), subsubItem.DeleteRect);
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">        break;
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">    default:
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">        g.FillRectangle(new SolidBrush(Color.FromArgb(240, 245, 249)), subsubItem.EditRect);
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">        g.FillRectangle(new SolidBrush(Color.FromArgb(240, 245, 249)), subsubItem.DeleteRect);
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">        break;
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">}</span>
<span style="color: #000000;">
                                g.FillRectangle(</span><span style="color: #0000ff;">new</span> SolidBrush(Color.FromArgb(<span style="color: #800080;">240</span>, <span style="color: #800080;">245</span>, <span style="color: #800080;">249</span><span style="color: #000000;">)), subsubItem.EditRect);
                                g.FillRectangle(</span><span style="color: #0000ff;">new</span> SolidBrush(Color.FromArgb(<span style="color: #800080;">240</span>, <span style="color: #800080;">245</span>, <span style="color: #800080;">249</span><span style="color: #000000;">)), subsubItem.DeleteRect);

                                </span><span style="color: #008000;">//</span><span style="color: #008000;">绘制编辑按扭</span>
                                g.DrawImage(<span style="color: #0000ff;">this</span>.TimeLineIcons.Images[<span style="color: #800080;">0</span><span style="color: #000000;">], subsubItem.EditRect);
                                </span><span style="color: #008000;">//</span><span style="color: #008000;">绘制删除按扭</span>
                                g.DrawImage(<span style="color: #0000ff;">this</span>.TimeLineIcons.Images[<span style="color: #800080;">1</span><span style="color: #000000;">], subsubItem.DeleteRect);
                            }                            

                        }
                    }                   

                }

            }

            StringFormat sf2 </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> StringFormat();
            sf2.LineAlignment </span>=<span style="color: #000000;"> StringAlignment.Center;
            Rectangle itemTitleRect </span>= <span style="color: #0000ff;">new</span> Rectangle(<span style="color: #800080;">56</span>, bound.Top + <span style="color: #800080;">5</span>, bound.Width - <span style="color: #800080;">64</span>, <span style="color: #800080;">36</span><span style="color: #000000;">);
            </span><span style="color: #008000;">//</span><span style="color: #008000;">g.DrawRectangle(new Pen(Color.Orange), itemTitleRect);
            </span><span style="color: #008000;">//</span><span style="color: #008000;">g.DrawString("共计 " + (item.List == null ? 0 : item.List.Count()) + " 个事项", this.Font, Brushes.Black, itemTitleRect, sf2);</span>
<span style="color: #000000;">
        }</span></pre>
</div>
<p><img class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="15" height="15" data-cke-widget-drag-handler="1" /></p>
</div>
<p>&nbsp; 绘制滚动条这里先贴一张不带上下箭头的滚动条截图&nbsp;&nbsp;</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="10">
<p class="cke_widget_element" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/我的开发助手之时间线控件11.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;center&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image"><span class="cke_image_resizer_wrapper"><img class="has" style="display: block; margin-left: auto; margin-right: auto;" src="./images/我的开发助手之时间线控件11.png" alt="" data-cke-saved-src="./images/我的开发助手之时间线控件11.png" /><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></p>
<span class="cke_reset cke_widget_drag_handler_container"><img class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="15" height="15" data-cke-widget-drag-handler="1" /></span></div>
<p>&nbsp;主要涉及到的计算如下：&nbsp;</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="9">
<div class="cnblogs_code">
<pre><code> <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 计算 Thumb 的高
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> GetThumbHeight()
        {
            </span><span style="color: #0000ff;">int</span> disHeight = <span style="color: #0000ff;">this</span>.BorderStyle == NBorderStyle.None ? <span style="color: #0000ff;">this</span>.Height : <span style="color: #0000ff;">this</span>.Height - <span style="color: #800080;">2</span><span style="color: #000000;">;
            </span><span style="color: #0000ff;">if</span> (MaxnumHeight == <span style="color: #800080;">0</span> || MaxnumHeight &lt;= disHeight) <span style="color: #0000ff;">return</span><span style="color: #000000;"> disHeight;
            </span><span style="color: #0000ff;">int</span> thumbHeight = (<span style="color: #0000ff;">int</span>)(disHeight * <span style="color: #800080;">1.0d</span> / MaxnumHeight *<span style="color: #000000;"> disHeight);
            </span><span style="color: #0000ff;">if</span> (thumbHeight &lt; <span style="color: #800080;">20</span>) thumbHeight = <span style="color: #800080;">20</span><span style="color: #000000;">;
            largeChange </span>= DisplayRectangle.Height -<span style="color: #000000;"> thumbHeight;
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> thumbHeight;
        }

        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 绘制 Thumb 及计算 Thumb 的位置
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="g"&gt;&lt;/param&gt;</span>
        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> DrawScrollThumb(Graphics g)
        {
            </span><span style="color: #0000ff;">int</span> thumbOffsetY = (<span style="color: #0000ff;">int</span>)(scrollerBarValue * <span style="color: #800080;">1.0</span> / scrollerBarMaxnum * (scrollerRect.Height -<span style="color: #000000;"> thumbRect.Height));
            thumbRect </span>= <span style="color: #0000ff;">new</span> Rectangle(scrollerRect.X, scrollerRect.Y +<span style="color: #000000;"> thumbOffsetY, scrollerRect.Width, scrollerThumbHeight);
            g.FillRectangle(Brushes.Gray, thumbRect);
        }

        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 计算所以元素 累加起来总的高度(包话不可见部分)
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> MaxnumHeight
        {
            </span><span style="color: #0000ff;">get</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">int</span> maxnum = <span style="color: #800080;">0</span><span style="color: #000000;">;
                Graphics g </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
                </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span>.DataList != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
                {
                    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; <span style="color: #0000ff;">this</span>.DataList.Count; i++<span style="color: #000000;">)
                    {
                        </span><span style="color: #0000ff;">var</span> item = <span style="color: #0000ff;">this</span><span style="color: #000000;">.DataList[i];
                        maxnum </span>+=<span style="color: #000000;"> MeasureItemBound(g, i, item).Height;
                    }
                }
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> maxnum;
            }
        }</span></pre>
</div>
<img class="cke_reset cke_widget_drag_handler" style="font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px;" title="点击并拖拽以移动" src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="15" height="15" data-cke-widget-drag-handler="1" /></div>
<p>&nbsp; 第四步、处理控件中的事件</p>
<p>&nbsp; 首先我们重写一个Click事件对外开放，usercontrol 自控件本身就有一个click事件，这里我们在定义事件的属性前面添加 new 关键字表达用新的事件属性来替换掉原有的click事件。代码如下：&nbsp;&nbsp;</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="6">
<div class="cnblogs_code">
<pre><code> <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">readonly</span> <span style="color: #0000ff;">object</span> itemEventObject = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">object</span><span style="color: #000000;">();      
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 重写一个Click事件对外开放
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">event</span> EventHandler&lt;TimeLineEventArgs&gt;<span style="color: #000000;"> Click
        {
            add { Events.AddHandler(itemEventObject, value); }
            remove { Events.RemoveHandler(itemEventObject, value); }
        }</span></pre>
</div>
<p><img class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="15" height="15" data-cke-widget-drag-handler="1" /></p>
</div>
<p>&nbsp; 这里可以看到我们定义了一个&nbsp;TimeLineEventArgs 实体类，里面主要有&nbsp;Command 命令&nbsp;Data 数据两个属性，在控件内类我们通过判断点击鼠标的位置来判断触发哪个元素，哪种操作类型的事件，控件在编辑模式下有 添加，编辑，删除三种事件类型通过 Command 传递给外部调用，实现代码如下：</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="5">
<div class="cnblogs_code">
<pre><code> <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> OnMouseClick(MouseEventArgs e)
        {
            </span><span style="color: #0000ff;">base</span><span style="color: #000000;">.OnMouseClick(e);

            </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">newItemModel)
            {
                </span><span style="color: #008000;">//</span><span style="color: #008000;">是否继续 当选择项为 DateItem 时 就跳过 DateTimeItem 循环</span>
                <span style="color: #0000ff;">bool</span> isChidrenContinueForeach = <span style="color: #0000ff;">true</span><span style="color: #000000;">;

                </span><span style="color: #0000ff;">foreach</span>(MonthItem monthItem <span style="color: #0000ff;">in</span><span style="color: #000000;"> DataList)
                {
                    </span><span style="color: #0000ff;">foreach</span> (DateItem dateItem <span style="color: #0000ff;">in</span><span style="color: #000000;"> monthItem.List)
                    {
                        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (dateItem.ClickRect.Contains(e.Location))
                        {
                            </span><span style="color: #0000ff;">var</span> eventArg = <span style="color: #0000ff;">new</span><span style="color: #000000;"> TimeLineEventArgs(dateItem);
                            </span><span style="color: #0000ff;">if</span> (_isEditModel &amp;&amp; dateItem.AddRect != Rectangle.Empty &amp;&amp;<span style="color: #000000;"> dateItem.AddRect.Contains(e.Location))
                            {
                                eventArg.Command </span>= <span style="color: #800000;">"</span><span style="color: #800000;">new</span><span style="color: #800000;">"</span><span style="color: #000000;">;
                            }
                            DoItemClick(eventArg);
                            isChidrenContinueForeach </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
                        }
                        </span><span style="color: #0000ff;">foreach</span> (DateTimeItem dateTimeItem <span style="color: #0000ff;">in</span><span style="color: #000000;"> dateItem.List)
                        {
                            </span><span style="color: #0000ff;">if</span> (isChidrenContinueForeach &amp;&amp;<span style="color: #000000;">
                                dateTimeItem.ClickRect.Contains(e.Location))
                            {
                                </span><span style="color: #0000ff;">var</span> eventArg = <span style="color: #0000ff;">new</span><span style="color: #000000;"> TimeLineEventArgs(dateTimeItem);
                                eventArg.Command </span>= <span style="color: #800000;">"</span><span style="color: #800000;">detail</span><span style="color: #800000;">"</span><span style="color: #000000;">;
                                </span><span style="color: #0000ff;">if</span> (_isEditModel &amp;&amp; dateTimeItem.EditRect != Rectangle.Empty &amp;&amp;<span style="color: #000000;"> dateTimeItem.EditRect.Contains(e.Location))
                                {
                                    eventArg.Command </span>= <span style="color: #800000;">"</span><span style="color: #800000;">edit</span><span style="color: #800000;">"</span><span style="color: #000000;">;
                                }
                                </span><span style="color: #0000ff;">if</span> (_isEditModel &amp;&amp; dateTimeItem.DeleteRect != Rectangle.Empty &amp;&amp;<span style="color: #000000;"> dateTimeItem.DeleteRect.Contains(e.Location))
                                {
                                    eventArg.Command </span>= <span style="color: #800000;">"</span><span style="color: #800000;">delete</span><span style="color: #800000;">"</span><span style="color: #000000;">;
                                }
                                DoItemClick(eventArg);
                                isChidrenContinueForeach </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
                            }

                            </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">isChidrenContinueForeach)
                                </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                        }

                        </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">isChidrenContinueForeach)
                            </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;

                    }
                }
                               
            }
            </span><span style="color: #0000ff;">else</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (newItemRect.Contains(e.Location))
                {
                    </span><span style="color: #0000ff;">var</span> eventArg = <span style="color: #0000ff;">new</span> TimeLineEventArgs(<span style="color: #0000ff;">null</span><span style="color: #000000;">);
                    eventArg.Command </span>= <span style="color: #800000;">"</span><span style="color: #800000;">new</span><span style="color: #800000;">"</span><span style="color: #000000;">;
                    DoItemClick(eventArg);
                }
            }
        }</span></pre>
</div>
<p><img class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="15" height="15" data-cke-widget-drag-handler="1" /></p>
</div>
<p>&nbsp; 控件中处理滚动条事件代码如下：</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="4">
<div class="cnblogs_code">
<pre><code><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 滑动滚动条时  由 OnMouseMove 触发
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="e"&gt;&lt;/param&gt;</span>
        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> DoMouseScrolling(MouseEventArgs e)
        {
            </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">scrollerBarVisable)
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;

            </span><span style="color: #0000ff;">int</span> d = mouseDownOffset.Y + e.Location.Y -<span style="color: #000000;"> mouseDownPos.Y;
            scrollerBarValue </span>= (<span style="color: #0000ff;">int</span>)(d * <span style="color: #800080;">1.0</span> / (scrollerRect.Height - thumbRect.Height) *<span style="color: #000000;"> scrollerBarMaxnum);

            </span><span style="color: #0000ff;">if</span> (scrollerBarValue &lt; <span style="color: #800080;">0</span><span style="color: #000000;">)
            {
                scrollerBarValue </span>= <span style="color: #800080;">0</span><span style="color: #000000;">;                
            }
            </span><span style="color: #0000ff;">if</span> (scrollerBarValue &gt; <span style="color: #800080;">100</span><span style="color: #000000;">)
            {
                scrollerBarValue </span>= <span style="color: #800080;">100</span><span style="color: #000000;">;                
            }

            </span><span style="color: #0000ff;">int</span> drawOffsetY = (<span style="color: #0000ff;">int</span>)(-scrollerBarValue * <span style="color: #800080;">1.0</span> / scrollerBarMaxnum * (MaxnumHeight + smallChange - <span style="color: #0000ff;">this</span><span style="color: #000000;">.Height));
            drawPositionOffset </span>= <span style="color: #0000ff;">new</span> Point(<span style="color: #800080;">0</span><span style="color: #000000;">, drawOffsetY);

            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Invalidate();

        }

        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 处理鼠标滚轮事件 由 OnMouseWheel 触发
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="e"&gt;&lt;/param&gt;</span>
        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> DoMouseWheel(MouseEventArgs e)
        {
            </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">scrollerBarVisable)
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;

            </span><span style="color: #0000ff;">int</span> olePositionOffsetY =<span style="color: #000000;"> drawPositionOffset.Y;

            </span><span style="color: #0000ff;">int</span> mouseWheelScrollLines = e.Delta /<span style="color: #000000;"> NativeMethods.WHEEL_DELTA;

            </span><span style="color: #0000ff;">int</span> newPositionOffsetY = drawPositionOffset.Y + mouseWheelScrollLines *<span style="color: #000000;"> smallChange;

            </span><span style="color: #0000ff;">int</span> d = newPositionOffsetY -<span style="color: #000000;"> olePositionOffsetY;
            scrollerBarValue </span>+= (<span style="color: #0000ff;">int</span>)(-d * <span style="color: #800080;">1.0</span> / (MaxnumHeight + smallChange - <span style="color: #0000ff;">this</span>.Height) *<span style="color: #000000;"> scrollerBarMaxnum);

            </span><span style="color: #0000ff;">if</span> (scrollerBarValue &lt; <span style="color: #800080;">0</span><span style="color: #000000;">)
            {
                scrollerBarValue </span>= <span style="color: #800080;">0</span><span style="color: #000000;">;               
            }
            </span><span style="color: #0000ff;">if</span> (scrollerBarValue &gt; <span style="color: #800080;">100</span><span style="color: #000000;">)
            {
                scrollerBarValue </span>= <span style="color: #800080;">100</span><span style="color: #000000;">;                
            }

            </span><span style="color: #0000ff;">int</span> drawOffsetY = (<span style="color: #0000ff;">int</span>)(-scrollerBarValue * <span style="color: #800080;">1.0</span> / scrollerBarMaxnum * (MaxnumHeight + smallChange - <span style="color: #0000ff;">this</span><span style="color: #000000;">.Height));
            drawPositionOffset </span>= <span style="color: #0000ff;">new</span> Point(<span style="color: #800080;">0</span><span style="color: #000000;">, drawOffsetY);

            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Invalidate();
        }</span></pre>
</div>
<pre class="has cke_widget_element" data-cke-widget-data="{&amp;quot;lang&amp;quot;:&amp;quot;cs&amp;quot;,&amp;quot;code&amp;quot;:&amp;quot;        /// &amp;lt;summary&amp;gt;\n        /// 滑动滚动条时  由 OnMouseMove 触发\n        /// &amp;lt;/summary&amp;gt;\n        /// &amp;lt;param name=\&amp;quot;e\&amp;quot;&amp;gt;&amp;lt;/param&amp;gt;\n        private void DoMouseScrolling(MouseEventArgs e)\n        {\n            if (!scrollerBarVisable)\n                return;\n\n            int d = mouseDownOffset.Y + e.Location.Y - mouseDownPos.Y;\n            scrollerBarValue = (int)(d * 1.0 / (scrollerRect.Height - thumbRect.Height) * scrollerBarMaxnum);\n\n            if (scrollerBarValue &amp;lt; 0)\n            {\n                scrollerBarValue = 0;                \n            }\n            if (scrollerBarValue &amp;gt; 100)\n            {\n                scrollerBarValue = 100;                \n            }\n\n            int drawOffsetY = (int)(-scrollerBarValue * 1.0 / scrollerBarMaxnum * (MaxnumHeight + smallChange - this.Height));\n            drawPositionOffset = new Point(0, drawOffsetY);\n\n            this.Invalidate();\n\n        }&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="codeSnippet"></pre>
</div>
<p>&nbsp; &nbsp; &nbsp;第五步、控件性能优化</p>
<p>&nbsp; &nbsp; &nbsp;关于控件性能的优化主要体现在判断元素是否处于可视区域，如果不在可视区域则不绘制该元素及其子元素，特别是针对控件拥有上百上千甚至上万元素时，绘制所以元素系统开销很大（内存占用和CPU计算），往往一个控件在可视区域能展现出来的元素个数是有限的。&nbsp; &nbsp;&nbsp;</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="2">
<div class="cnblogs_code">
<pre><code> <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 判断是否在可视区域的方法
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="bound"&gt;&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">bool</span><span style="color: #000000;"> IsRectangleVisible(Rectangle bound)
        {
            </span><span style="color: #0000ff;">bool</span> isItemDrawModel = <span style="color: #0000ff;">true</span><span style="color: #000000;">;
            </span><span style="color: #0000ff;">if</span> (bound.Bottom &lt; <span style="color: #0000ff;">this</span>.DisplayRectangle.Top ||<span style="color: #000000;">
                        bound.Top </span>&gt; <span style="color: #0000ff;">this</span><span style="color: #000000;">.DisplayRectangle.Bottom)
            {
                isItemDrawModel </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
            }
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> isItemDrawModel;
        }

 

        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 在绘制元素添加判断，不在可视范围内跳过不进行绘制  
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="g"&gt;&lt;/param&gt;</span>
        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> DrawTimelineItems(Graphics g)
        {
            position </span>= <span style="color: #800080;">0</span><span style="color: #000000;">;                       
            g.SmoothingMode </span>=<span style="color: #000000;"> System.Drawing.Drawing2D.SmoothingMode.HighQuality;

            </span><span style="color: #0000ff;">if</span> (DataList != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
            {
                </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> index = <span style="color: #800080;">0</span>; index &lt; DataList.Count; index++<span style="color: #000000;">)
                {
                    MonthItem item </span>=<span style="color: #000000;"> DataList[index];
                    item.Bound </span>=<span style="color: #000000;"> MeasureItemBound(g, index, item);
                    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (IsRectangleVisible(item.Bound))
                    {
                        DrawTimelineItem(g, index, item);
                    }
                }
            }         

            g.SmoothingMode </span>=<span style="color: #000000;"> System.Drawing.Drawing2D.SmoothingMode.Default;
        }</span></pre>
</div>
<img class="cke_reset cke_widget_drag_handler" style="font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px;" title="点击并拖拽以移动" src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="15" height="15" data-cke-widget-drag-handler="1" /></div>
<p>&nbsp; 以上就是时间控件的开发过程，其中界面设计参照了一下开源中国码云的个人主页动态：</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="0">
<p class="cke_widget_element" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/我的开发助手之时间线控件17.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;center&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image"><span class="cke_image_resizer_wrapper"><img class="has" style="display: block; margin-left: auto; margin-right: auto;" src="./images/我的开发助手之时间线控件17.png" alt="" data-cke-saved-src="./images/我的开发助手之时间线控件17.png" /><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></p>
<span class="cke_reset cke_widget_drag_handler_container"><img class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="" width="15" height="15" data-cke-widget-drag-handler="1" /></span></div>
<p>&nbsp; &nbsp; &nbsp;完整代码可以点击上面的地址进入链接后下载，觉得不错希望可以给个赞，谢谢！</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>