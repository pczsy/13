<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修关于ManualResetEvent的实例分析' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>关于ManualResetEvent的实例分析</center></div><div class='banquan'>原文出处:本文由博客园博主清风绿茶提供。<br/>
原文连接:https://www.cnblogs.com/TechnologyDictionary/p/10972394.html</div><br>
    <p>最近用WPF开发时使用多个定时器处理时需要实例化N多个DispatcherTimer，而且全部暴露在程序外部，显得很冗杂，例如下面的例子：用到的两个定时器就要实例化两个DispatcherTimer，不知道各位看的想不想吐，但是我i是觉得这样很恶心，下面就是两个实例化的定时器。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //定时器1</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.Windows.Threading.DispatcherTimer readDataTimer = new System.Windows.Threading.DispatcherTimer();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readDataTimer.Tick += new EventHandler(TimeCycle);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readDataTimer.Interval = new TimeSpan(0,0,10,0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readDataTimer.Start();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //定时器2</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; System.Windows.Threading.DispatcherTimer readDataTimer_TW = new System.Windows.Threading.DispatcherTimer();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readDataTimer_TW.Tick += new EventHandler(TimeCycle_TW);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readDataTimer_TW.Interval = new TimeSpan(0, 0, 120, 0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readDataTimer_TW.Start();</p>
<p>&nbsp; OK,引导的部分结束，下面我们就来谈谈ManualResetEvent是个什么东西，能够带给我们什么便利之处。</p>
<p>&nbsp;&nbsp; 说白了ManualResetEvent就是一个实现线程之间的相互通信的东东，其中很重要的几个角色给大家列举一下：</p>
<p>&nbsp;&nbsp;&nbsp; 1.<span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."> <span class="input">ManualResetEvent&nbsp;的初始状态，如果初始状态处于终止状态，为&nbsp;<span class="input">true；否则非终止状态为&nbsp;<span class="input">false</span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">&nbsp;&nbsp;&nbsp; 2.Waitone() ; ManualResetEvent 处于非终止状态WaitOne会阻塞线程，<span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">ManualResetEvent </span></span></span></span>处于终止状态Waitone()无作用，线程会一直执行。</span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">&nbsp;&nbsp;&nbsp; 3.Set() ;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">ManualResetEvent 处于非终止状态WaitOne会阻塞线程的话，</span></span></span></span> <span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">当调用 Set()方法会允许线程继续执行下去。</span></span></span></span></span></span></span></span>&nbsp; </span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">&nbsp;&nbsp;&nbsp; 4.<span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">Reset()</span></span></span></span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 线程继续后，<span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">当调用 Reset()方法 </span></span></span></span></span></span></span></span>ManualResetEvent处于非终止状态WaitOne会阻塞线程直到再调用Set()方法,</span></span></span></span></p>
<p>&nbsp;</p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">&nbsp; OK,介绍到这里，基本的知识应该掌握了吧，下面我们回归到开篇提到的案例，我们来封装一个定时器类；用到的知识点就是刚介绍的。</span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">&nbsp; 首先我们新建一个类吧，就叫它MyThreadTimer，好不好；</span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">&nbsp;&nbsp; 首先在MyThreadTimer定义几个字段分别定义定时器，线程，及回调</span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">&nbsp; &nbsp; &nbsp; &nbsp; private Thread timerThread;&nbsp;&nbsp; //线程<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private System.Timers.Timer timer;&nbsp;&nbsp; //定时器<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private System.Threading.ManualResetEvent timerEvent;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public event CallBackEventHandle&lt;object, object&gt; callBackEvent;&nbsp; //回调</span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">&nbsp; 好，准备就绪，我们来创建一个构造函数包括的参数有3个分别如下</span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">&nbsp;&nbsp;&nbsp;&nbsp; public MyThreadTimer(int TimerCount ,CallBackEventHandle&lt;object, object&gt; eventFunc, bool startSign)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.timerEvent = new ManualResetEvent(false);&nbsp; //处于非终止状态&nbsp;&nbsp; 初始阻塞<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //定时器一直运行<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.timer = new System.Timers.Timer();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.timer.Interval = TimerCount;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.timer.Elapsed += timer_Elapsed;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //创建线程<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.timerThread = new Thread(timerThreadFunc);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.timerThread.IsBackground = true;</span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; callBackEvent += eventFunc; //订阅响应方法<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (startSign)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.timer.Start();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.timerThread.Start();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">看到构造函数大家也就差不多看的八九不离十了吧，构造函数中实例了一个定时器，一个线程，还有一个就是订阅了定时器的响应函数，下面慢慢给大家介绍这几个方法的作用。</span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">首先给大家介绍的定时器的作用，先把定时器的执行方法给出。</span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void timer_Elapsed(object sender, EventArgs e)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timerEvent.Set(); //调用 Set()方法 ManualResetEvent 处于非终止状态WaitOne不会阻塞线程会一直运行下去<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;//自己怎么喜欢怎么记异常<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">大家看到就一条语句<span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">timerEvent.Set()</span></span></span></span>，这个就是<span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">调用 Set()方法 ManualResetEvent 处于非终止状态WaitOne不会阻塞线程会一直运行下去（可以看成这个方法把ManualResetEvent弄成了终止状态了）</span></span></span></span></span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">大家先记住就好了（基本的作用要牢记）；</span></span></span></span></span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">再来说说线程执行的方法，还是先把方法给出后再来分析</span></span></span></span></span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">&nbsp; private void timerThreadFunc()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (true)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timerEvent.WaitOne();//如果处于终止状态就不会阻塞，处于非终止状态就阻塞<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timerEvent.Reset();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (this.callBackEvent != null)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.callBackEvent(this, EventArgs.Empty);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch(Exception ex)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></span></span></span></span></span></span></span></p>
<p><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">&nbsp; 这里可以看到，线程执行机会进入一个while循环，因为<span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">ManualResetEvent初始化的状态为Fasle（非终止状态），遇到<span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">WaitOne</span></span></span></span></span></span></span></span>就阻塞了，但是还记得上面的定时器吗，<span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">timerEvent.Set()</span></span></span></span>就会打破这个僵局，线程就会继续的执行下去了。继续向下看程序<span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">&nbsp; timerEvent.Reset();</span></span></span></span></span></span></span></span>这时<span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">ManualResetEvent</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>又被<span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input"><span class="sentence" data-guid="87baedb5428e63e7369d71c4001193d4" data-source="You can control the initial state of a &lt;span class=&quot;input&quot;&gt;ManualResetEvent by passing a Boolean value to the constructor, &lt;span class=&quot;input&quot;&gt;true if the initial state is signaled and &lt;span class=&quot;input&quot;&gt;false otherwise."><span class="input"><span class="input"><span class="input">Reset()</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>设置成遇到Waitone()会阻塞了。说到这里想向大家应该知道这个是啥意思了吧。好了，我封的定时类贴出来吧，分享一下（大神绕道，哈哈）；</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<div class="cnblogs_Highlighter">
<pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Threading;
using System.Windows;

namespace Common
{
   public class MyThreadTimer
    {
        /*
         ManualResetEvent可以通知一个或多个正在等待的线程已发生事件，允许线程通过发信号互相通信，来控制线程是否可心访问资源
         当一个线程开始一个活动（此活动必须完成后，其他线程才能开始）时，它调用 Reset 以将 ManualResetEvent 置于非终止状态。
        此线程可被视为控制 ManualResetEvent。调用 ManualResetEvent 上的WaitOne 的线程将阻止，并等待信号。当控制线程完成活动时，它调用 Set 以发出等待线程可以继续进行的信号。并释放所有等待线程。
        一旦它被终止，ManualResetEvent 将保持终止状态，直到它被手动重置。即对 WaitOne 的调用将立即返回。
        */
        //成员变量
        private Thread timerThread;   //线程
        private System.Timers.Timer timer;   //定时器
        private System.Threading.ManualResetEvent timerEvent;    
        public event CallBackEventHandle&lt;object, object&gt; callBackEvent;  //回调
        public MyThreadTimer(int TimerCount ,CallBackEventHandle&lt;object, object&gt; eventFunc, bool startSign)
        {

          this.timerEvent = new ManualResetEvent(false);  //处于非终止状态   初始阻塞

            //定时器一直运行
            this.timer = new System.Timers.Timer();
            this.timer.Interval = TimerCount;
            this.timer.Elapsed += timer_Elapsed;

            //创建线程
            this.timerThread = new Thread(timerThreadFunc);
            this.timerThread.IsBackground = true;

             callBackEvent += eventFunc; //订阅响应方法

            if (startSign)
            {
                this.timer.Start();
                this.timerThread.Start();
            }
        }
        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name="sender"&gt;&lt;/param&gt;
        /// &lt;param name="e"&gt;&lt;/param&gt;
        private void timer_Elapsed(object sender, EventArgs e)
        {
            try
            {
                timerEvent.Set(); //调用 Set()方法 ManualResetEvent 处于终止状态WaitOne不会阻塞线程会一直运行下去
            }
            catch
            {
                ;
            }
        }

        /// &lt;summary&gt;
        /// 当调用 Set()方法 ManualResetEvent 处于终止状态WaitOne不会阻塞线程会一直运行下去
        /// 当调用 Reset()方法ManualResetEvent处于非终止状态WaitOne会阻塞线程直到再调用Set()方法
        /// &lt;/summary&gt;
        private void timerThreadFunc()
        {
            try
            {
                while (true)
                {
                    timerEvent.WaitOne();//如果处于终止状态就不会阻塞，处于非终止状态就阻塞
                    timerEvent.Reset();
                    if (this.callBackEvent != null)
                    {
                        this.callBackEvent(this, EventArgs.Empty);
                    }
                }
            }
            catch(Exception ex)
            {

            }
        }

    }
}
</pre>
</div>
<p>&nbsp;调用就很简单了</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp; MyThreadTimer myth = new MyThreadTimer(1000, f, true);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int i = 0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private void f(object sender, object args)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i++;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp; 虽然还是需要实例化N个定时类，但是起码显得整洁多了，顺便也介绍下ManualResetEvent，挺好。</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>