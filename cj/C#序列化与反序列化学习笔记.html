<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修C#序列化与反序列化学习笔记' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>C#序列化与反序列化学习笔记</center></div><div class='banquan'>原文出处:本文由博客园博主缥缈的尘埃提供。<br/>
原文连接:https://www.cnblogs.com/atomy/p/12120617.html</div><br>
    <p>&nbsp; &nbsp;&nbsp;本笔记摘抄自：<a href="https://www.cnblogs.com/maitian-lf/p/3670570.html">https://www.cnblogs.com/maitian-lf/p/3670570.html</a>，记录一下学习过程以备后续查用。</p>
<p>&nbsp; &nbsp; 序列化是把一个内存中的对象的信息转化成一个可以持久化保存的形式，以便于保存或传输。序列化的主要作用是不同平台之间进行通信，常用的序</p>
<p>列化有json、xml、文件等，下面就逐个讲下这三种序列化的方法。</p>
<p><strong>&nbsp; &nbsp; 一、序列化为json</strong></p>
<p>&nbsp; &nbsp; C#中用于对象和json相互转换的原生类有两个：DataContractJsonSerializer和JavaScriptSerializer，其中JavaScriptSerializer主要用于web浏览器和服</p>
<p>务器之间的通信。这里主要讲DataContractJsonSerializer的使用，要使用DataContractJsonSerializer，先要在项目中引用System.Runtime.Serialization。</p>
<p>&nbsp; &nbsp; 首先准备一个测试的类Book：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('8fc773a1-f21b-4f23-8bc7-4ba2833e4609')"><img id="code_img_closed_8fc773a1-f21b-4f23-8bc7-4ba2833e4609" class="code_img_closed" src="./images/C#序列化与反序列化学习笔记0.png" alt="" /><img id="code_img_opened_8fc773a1-f21b-4f23-8bc7-4ba2833e4609" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('8fc773a1-f21b-4f23-8bc7-4ba2833e4609',event)" src="./images/C#序列化与反序列化学习笔记1.png" alt="" />
<div id="cnblogs_code_open_8fc773a1-f21b-4f23-8bc7-4ba2833e4609" class="cnblogs_code_hide">
<pre><code>    <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> Book类
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
<span style="color: #000000;">        [DataContract]
        </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Book
        {
            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> ID { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">float</span> Price { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        }

        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp; &nbsp; <strong>[DataContract]</strong>指定该类型要定义或实现一个数据协定，并可由序列化程序（如System.Runtime.Serialization.DataContractSerializer）进行序列化。</p>
<p>&nbsp; &nbsp; <strong>[DataMember]</strong>当应用于类型的成员时，指定该成员是数据协定的一部分并可由System.Runtime.Serialization.DataContractSerializer进行序列化。</p>
<p>&nbsp; &nbsp; 首先创建一个Book对象，然后实例化一个DataContractJsonSerializer实例，最后用该实例的WriteObject()方法将对象写到流中，代码如下：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('2b700768-e720-4db3-926b-ec5c82d12cea')"><img id="code_img_closed_2b700768-e720-4db3-926b-ec5c82d12cea" class="code_img_closed" src="./images/C#序列化与反序列化学习笔记0.png" alt="" /><img id="code_img_opened_2b700768-e720-4db3-926b-ec5c82d12cea" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('2b700768-e720-4db3-926b-ec5c82d12cea',event)" src="./images/C#序列化与反序列化学习笔记1.png" alt="" />
<div id="cnblogs_code_open_2b700768-e720-4db3-926b-ec5c82d12cea" class="cnblogs_code_hide">
<pre><code>    <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> Book类
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
<span style="color: #000000;">        [DataContract]
        </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Book
        {
            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Id { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">float</span> Price { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        }

        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
            </span><span style="color: #0000ff;">#region</span> 对象序列化为json<span style="color: #000000;">
            Book book </span>= <span style="color: #0000ff;">new</span> Book() { Id = <span style="color: #800080;">101</span>, Name = <span style="color: #800000;">"</span><span style="color: #800000;">C#程序设计</span><span style="color: #800000;">"</span>, Price = <span style="color: #800080;">79.5f</span><span style="color: #000000;"> };

            </span><span style="color: #008000;">//</span><span style="color: #008000;">序列化为json</span>
            DataContractJsonSerializer jsonSerializer = <span style="color: #0000ff;">new</span> DataContractJsonSerializer(<span style="color: #0000ff;">typeof</span><span style="color: #000000;">(Book));
            </span><span style="color: #0000ff;">using</span> (MemoryStream stream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MemoryStream())
            {
                jsonSerializer.WriteObject(stream, book);
                </span><span style="color: #0000ff;">string</span> result =<span style="color: #000000;"> Encoding.UTF8.GetString(stream.ToArray());
                Console.WriteLine(result);
            }
            Console.Read();
            </span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;">
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp; &nbsp; 运行结果如下：</p>
<p><img src="./images/C#序列化与反序列化学习笔记4.png" alt="" /></p>
<p>&nbsp; &nbsp; 将一个json格式的字符串反序列化为对象是用DataContractJsonSerializer实例的ReadObject()方法，代码如下：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('6ef9bd29-1e58-4eab-9cdd-cccafbcdb51d')"><img id="code_img_closed_6ef9bd29-1e58-4eab-9cdd-cccafbcdb51d" class="code_img_closed" src="./images/C#序列化与反序列化学习笔记0.png" alt="" /><img id="code_img_opened_6ef9bd29-1e58-4eab-9cdd-cccafbcdb51d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('6ef9bd29-1e58-4eab-9cdd-cccafbcdb51d',event)" src="./images/C#序列化与反序列化学习笔记1.png" alt="" />
<div id="cnblogs_code_open_6ef9bd29-1e58-4eab-9cdd-cccafbcdb51d" class="cnblogs_code_hide">
<pre><code>    <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> Book类
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
<span style="color: #000000;">        [DataContract]
        </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Book
        {
            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Id { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">float</span> Price { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        }

        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
            </span><span style="color: #0000ff;">#region</span> json反序列化为对象<span style="color: #000000;">
            Book book </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> Book();
            </span><span style="color: #008000;">//</span><span style="color: #008000;">json反序列化为对象</span>
            <span style="color: #0000ff;">string</span> oriStr = <span style="color: #800000;">"</span><span style="color: #800000;">{\"Id\":101,\"Name\":\"C#程序设计\",\"Price\":79.5}</span><span style="color: #800000;">"</span><span style="color: #000000;">;
            DataContractJsonSerializer jsonSerializer </span>= <span style="color: #0000ff;">new</span> DataContractJsonSerializer(<span style="color: #0000ff;">typeof</span><span style="color: #000000;">(Book));
            </span><span style="color: #0000ff;">using</span> (MemoryStream stream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MemoryStream(Encoding.UTF8.GetBytes(oriStr)))
            {
                Book outBook </span>= jsonSerializer.ReadObject(stream) <span style="color: #0000ff;">as</span><span style="color: #000000;"> Book;
                Console.WriteLine($</span><span style="color: #800000;">"</span><span style="color: #800000;">{outBook.Id} {outBook.Name} {outBook.Price}</span><span style="color: #800000;">"</span><span style="color: #000000;">);
            }
            Console.Read();
            </span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;">
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp; &nbsp; 运行结果如下：</p>
<p><img src="./images/C#序列化与反序列化学习笔记7.png" alt="" /></p>
<p>&nbsp; &nbsp; 我们也可以把上面的json序列化与反序列为封装成泛型方法，这样可以公用，全部代码如下：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('0b6e73e9-a00b-4115-bafb-7fde276dd28d')"><img id="code_img_closed_0b6e73e9-a00b-4115-bafb-7fde276dd28d" class="code_img_closed" src="./images/C#序列化与反序列化学习笔记0.png" alt="" /><img id="code_img_opened_0b6e73e9-a00b-4115-bafb-7fde276dd28d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('0b6e73e9-a00b-4115-bafb-7fde276dd28d',event)" src="./images/C#序列化与反序列化学习笔记1.png" alt="" />
<div id="cnblogs_code_open_0b6e73e9-a00b-4115-bafb-7fde276dd28d" class="cnblogs_code_hide">
<pre><code>    <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> Book类
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
<span style="color: #000000;">        [DataContract]
        </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Book
        {
            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Id { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">float</span> Price { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        }

        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> SerializerHelper
        {
            </span><span style="color: #808080;">///</span><span style="color: #008000;"> 将对象序列化为json文件
            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;typeparam name="T"&gt;</span><span style="color: #008000;">类型</span><span style="color: #808080;">&lt;/typeparam&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="t"&gt;</span><span style="color: #008000;">实例</span><span style="color: #808080;">&lt;/param&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="path"&gt;</span><span style="color: #008000;">存放路径</span><span style="color: #808080;">&lt;/param&gt;</span>
            <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> ObjectToJson&lt;T&gt;(T t, <span style="color: #0000ff;">string</span> path) <span style="color: #0000ff;">where</span> T : <span style="color: #0000ff;">class</span><span style="color: #000000;">
            {
                DataContractJsonSerializer formatter </span>= <span style="color: #0000ff;">new</span> DataContractJsonSerializer(<span style="color: #0000ff;">typeof</span><span style="color: #000000;">(T));
                </span><span style="color: #0000ff;">using</span> (FileStream stream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileStream(path, FileMode.OpenOrCreate))
                {
                    formatter.WriteObject(stream, t);
                }
            }

            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
            <span style="color: #808080;">///</span><span style="color: #008000;"> 将对象序列化为json字符串
            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;typeparam name="T"&gt;</span><span style="color: #008000;">类型</span><span style="color: #808080;">&lt;/typeparam&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="t"&gt;</span><span style="color: #008000;">实例</span><span style="color: #808080;">&lt;/param&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">json字符串</span><span style="color: #808080;">&lt;/returns&gt;</span>
            <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">string</span> ObjectToJson&lt;T&gt;(T t) <span style="color: #0000ff;">where</span> T : <span style="color: #0000ff;">class</span><span style="color: #000000;">
            {
                DataContractJsonSerializer formatter </span>= <span style="color: #0000ff;">new</span> DataContractJsonSerializer(<span style="color: #0000ff;">typeof</span><span style="color: #000000;">(T));
                </span><span style="color: #0000ff;">using</span> (MemoryStream stream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MemoryStream())
                {
                    formatter.WriteObject(stream, t);
                    </span><span style="color: #0000ff;">string</span> result =<span style="color: #000000;"> Encoding.UTF8.GetString(stream.ToArray());
                    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
                }
            }

            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
            <span style="color: #808080;">///</span><span style="color: #008000;"> 将json字符串反序列化为对象
            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;typeparam name="T"&gt;</span><span style="color: #008000;">类型</span><span style="color: #808080;">&lt;/typeparam&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="json"&gt;</span><span style="color: #008000;">json格式字符串</span><span style="color: #808080;">&lt;/param&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">对象</span><span style="color: #808080;">&lt;/returns&gt;</span>
            <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> T JsonToObject&lt;T&gt;(<span style="color: #0000ff;">string</span> json) <span style="color: #0000ff;">where</span> T : <span style="color: #0000ff;">class</span><span style="color: #000000;">
            {
                DataContractJsonSerializer formatter </span>= <span style="color: #0000ff;">new</span> DataContractJsonSerializer(<span style="color: #0000ff;">typeof</span><span style="color: #000000;">(T));
                </span><span style="color: #0000ff;">using</span> (MemoryStream stream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MemoryStream(Encoding.UTF8.GetBytes(json)))
                {
                    T result </span>= formatter.ReadObject(stream) <span style="color: #0000ff;">as</span><span style="color: #000000;"> T;
                    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
                }
            }
        }

        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
            </span><span style="color: #0000ff;">#region</span> json序列化与反序列化泛型方法<span style="color: #000000;">
            Book book </span>= <span style="color: #0000ff;">new</span> Book() { Id = <span style="color: #800080;">101</span>, Name = <span style="color: #800000;">"</span><span style="color: #800000;">C#程序设计</span><span style="color: #800000;">"</span>, Price = <span style="color: #800080;">79.5f</span><span style="color: #000000;"> };

            </span><span style="color: #008000;">//</span><span style="color: #008000;">对象序列化为json</span>
            <span style="color: #0000ff;">string</span> result =<span style="color: #000000;"> SerializerHelper.ObjectToJson(book);
            Console.WriteLine(result);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">json反序列化为对象</span>
            <span style="color: #0000ff;">string</span> oriStr = <span style="color: #800000;">"</span><span style="color: #800000;">{\"Id\":101,\"Name\":\"C#程序设计\",\"Price\":79.5}</span><span style="color: #800000;">"</span><span style="color: #000000;">;
            Book outBook </span>= SerializerHelper.JsonToObject&lt;Book&gt;<span style="color: #000000;">(oriStr);
            Console.WriteLine($</span><span style="color: #800000;">"</span><span style="color: #800000;">{outBook.Id} {outBook.Name} {outBook.Price}</span><span style="color: #800000;">"</span><span style="color: #000000;">);

            Console.Read();
            </span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;">
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp; &nbsp; 运行结果如下：</p>
<p><img src="./images/C#序列化与反序列化学习笔记10.png" alt="" /></p>
<p>&nbsp; &nbsp;&nbsp;<strong>二、序列化为xml</strong></p>
<p>&nbsp; &nbsp; C#中将对象序列化和反序列化为xml的类是XmlSerializer，要引用System.Xml.Serialization。</p>
<p>&nbsp; &nbsp; 首先创建一个XmlSerializer对象实例，然后用实例的Serialize方法将对象写入到文件流中，代码如下：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('f0fdda60-19a7-44e0-a419-c0a26c4eddc1')"><img id="code_img_closed_f0fdda60-19a7-44e0-a419-c0a26c4eddc1" class="code_img_closed" src="./images/C#序列化与反序列化学习笔记0.png" alt="" /><img id="code_img_opened_f0fdda60-19a7-44e0-a419-c0a26c4eddc1" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('f0fdda60-19a7-44e0-a419-c0a26c4eddc1',event)" src="./images/C#序列化与反序列化学习笔记1.png" alt="" />
<div id="cnblogs_code_open_f0fdda60-19a7-44e0-a419-c0a26c4eddc1" class="cnblogs_code_hide">
<pre><code>    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> Book类
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
<span style="color: #000000;">        [DataContract]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Book
        {
            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Id { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">float</span> Price { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        }

        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
            </span><span style="color: #0000ff;">#region</span> 对象序列化为xml(文件流)<span style="color: #000000;">
            Book book </span>= <span style="color: #0000ff;">new</span> Book() { Id = <span style="color: #800080;">101</span>, Name = <span style="color: #800000;">"</span><span style="color: #800000;">C#程序设计</span><span style="color: #800000;">"</span>, Price = <span style="color: #800080;">79.5f</span><span style="color: #000000;"> };

            XmlSerializer xmlSerializer </span>= <span style="color: #0000ff;">new</span> XmlSerializer(<span style="color: #0000ff;">typeof</span><span style="color: #000000;">(Book));
            </span><span style="color: #0000ff;">using</span> (FileStream stream = <span style="color: #0000ff;">new</span> FileStream(<span style="color: #800000;">@"</span><span style="color: #800000;">E:\book.xml</span><span style="color: #800000;">"</span><span style="color: #000000;">, FileMode.OpenOrCreate))
            {
                xmlSerializer.Serialize(stream, book);
            }
            Console.Read();
            </span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;">
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp; &nbsp;&nbsp;程序运行后会在c盘产生一个book.xml文件，内容如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Book </span><span style="color: #ff0000;">xmlns:xsi</span><span style="color: #0000ff;">="http://www.w3.org/2001/XMLSchema-instance"</span><span style="color: #ff0000;"> xmlns:xsd</span><span style="color: #0000ff;">="http://www.w3.org/2001/XMLSchema"</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Id</span><span style="color: #0000ff;">&gt;</span>101<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Id</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Name</span><span style="color: #0000ff;">&gt;</span>C#程序设计<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Name</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Price</span><span style="color: #0000ff;">&gt;</span>79.5<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Price</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Book</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp; &nbsp;&nbsp;当然也可以将对象转换成对象流，然后转换成xml格式的字符串，代码如下：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('68d74ee8-49e2-49de-b736-839c795c69cb')"><img id="code_img_closed_68d74ee8-49e2-49de-b736-839c795c69cb" class="code_img_closed" src="./images/C#序列化与反序列化学习笔记0.png" alt="" /><img id="code_img_opened_68d74ee8-49e2-49de-b736-839c795c69cb" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('68d74ee8-49e2-49de-b736-839c795c69cb',event)" src="./images/C#序列化与反序列化学习笔记1.png" alt="" />
<div id="cnblogs_code_open_68d74ee8-49e2-49de-b736-839c795c69cb" class="cnblogs_code_hide">
<pre><code>    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> Book类
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
<span style="color: #000000;">        [DataContract]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Book
        {
            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Id { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">float</span> Price { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        }

        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
            </span><span style="color: #0000ff;">#region</span> 对象序列化为xml(对象流)<span style="color: #000000;">
            Book book </span>= <span style="color: #0000ff;">new</span> Book() { Id = <span style="color: #800080;">101</span>, Name = <span style="color: #800000;">"</span><span style="color: #800000;">C#程序设计</span><span style="color: #800000;">"</span>, Price = <span style="color: #800080;">79.5f</span><span style="color: #000000;"> };

            XmlSerializer xmlSerializer </span>= <span style="color: #0000ff;">new</span> XmlSerializer(<span style="color: #0000ff;">typeof</span><span style="color: #000000;">(Book));
            </span><span style="color: #0000ff;">using</span> (MemoryStream stream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MemoryStream())
            {
                xmlSerializer.Serialize(stream, book);
                </span><span style="color: #0000ff;">string</span> result = Encoding.UTF8.GetString(stream.ToArray());  <span style="color: #008000;">//</span><span style="color: #008000;">转换成xml字符串</span>
<span style="color: #000000;">                Console.WriteLine(result);
            }
            Console.Read();
            </span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;">
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp; &nbsp; 运行结果如下：</p>
<p><img src="./images/C#序列化与反序列化学习笔记15.png" alt="" /></p>
<p>&nbsp; &nbsp;&nbsp;将xml文件反序列化的方法是用XmlSerializer实例的Deserialize()方法，代码如下：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('42263f6f-534d-447d-b383-e1ca9c391259')"><img id="code_img_closed_42263f6f-534d-447d-b383-e1ca9c391259" class="code_img_closed" src="./images/C#序列化与反序列化学习笔记0.png" alt="" /><img id="code_img_opened_42263f6f-534d-447d-b383-e1ca9c391259" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('42263f6f-534d-447d-b383-e1ca9c391259',event)" src="./images/C#序列化与反序列化学习笔记1.png" alt="" />
<div id="cnblogs_code_open_42263f6f-534d-447d-b383-e1ca9c391259" class="cnblogs_code_hide">
<pre><code>    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> Book类
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
<span style="color: #000000;">        [DataContract]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Book
        {
            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Id { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">float</span> Price { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        }

        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
            </span><span style="color: #0000ff;">#region</span> xml文件反序列化为对象<span style="color: #000000;">
            Book book </span>= <span style="color: #0000ff;">new</span> Book() { Id = <span style="color: #800080;">101</span>, Name = <span style="color: #800000;">"</span><span style="color: #800000;">C#程序设计</span><span style="color: #800000;">"</span>, Price = <span style="color: #800080;">79.5f</span><span style="color: #000000;"> };

            XmlSerializer xmlSerializer </span>= <span style="color: #0000ff;">new</span> XmlSerializer(<span style="color: #0000ff;">typeof</span><span style="color: #000000;">(Book));
            </span><span style="color: #0000ff;">using</span> (FileStream stream = <span style="color: #0000ff;">new</span> FileStream(<span style="color: #800000;">@"</span><span style="color: #800000;">E:\book.xml</span><span style="color: #800000;">"</span><span style="color: #000000;">, FileMode.OpenOrCreate))
            {
                XmlReader xmlReader </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> XmlTextReader(stream);
                Book outBook </span>= xmlSerializer.Deserialize(xmlReader) <span style="color: #0000ff;">as</span> Book;<span style="color: #008000;">//</span><span style="color: #008000;">反序列化</span>
                Console.WriteLine($<span style="color: #800000;">"</span><span style="color: #800000;">{outBook.Id} {outBook.Name} {outBook.Price}</span><span style="color: #800000;">"</span><span style="color: #000000;">);
            }
            Console.Read();
            </span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;">
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp; &nbsp; 运行结果如下：</p>
<p><img src="./images/C#序列化与反序列化学习笔记18.png" alt="" /></p>
<p>&nbsp; &nbsp;&nbsp;我们同样也可以把上面的xml序列化与反序列为封装成泛型方法，这样可以公用，全部代码如下：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('6c51154a-0e1c-4d90-9ea6-8329a22d0c7a')"><img id="code_img_closed_6c51154a-0e1c-4d90-9ea6-8329a22d0c7a" class="code_img_closed" src="./images/C#序列化与反序列化学习笔记0.png" alt="" /><img id="code_img_opened_6c51154a-0e1c-4d90-9ea6-8329a22d0c7a" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('6c51154a-0e1c-4d90-9ea6-8329a22d0c7a',event)" src="./images/C#序列化与反序列化学习笔记1.png" alt="" />
<div id="cnblogs_code_open_6c51154a-0e1c-4d90-9ea6-8329a22d0c7a" class="cnblogs_code_hide">
<pre><code>    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> Book类
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
<span style="color: #000000;">        [DataContract]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Book
        {
            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Id { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">float</span> Price { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        }

        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 序列化反序列化帮助类
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> SerializerHelper
        {
            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
            <span style="color: #808080;">///</span><span style="color: #008000;"> 将对象序列化为xml文件
            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;typeparam name="T"&gt;</span><span style="color: #008000;">类型</span><span style="color: #808080;">&lt;/typeparam&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="t"&gt;</span><span style="color: #008000;">对象</span><span style="color: #808080;">&lt;/param&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="path"&gt;</span><span style="color: #008000;">xml存放路径</span><span style="color: #808080;">&lt;/param&gt;</span>
            <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> ObjectToXml&lt;T&gt;(T t, <span style="color: #0000ff;">string</span> path) <span style="color: #0000ff;">where</span> T : <span style="color: #0000ff;">class</span><span style="color: #000000;">
            {
                XmlSerializer formatter </span>= <span style="color: #0000ff;">new</span> XmlSerializer(<span style="color: #0000ff;">typeof</span><span style="color: #000000;">(T));
                </span><span style="color: #0000ff;">using</span> (FileStream stream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileStream(path, FileMode.OpenOrCreate))
                {
                    formatter.Serialize(stream, t);
                }
            }

            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
            <span style="color: #808080;">///</span><span style="color: #008000;"> 将对象序列化为xml字符串
            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;typeparam name="T"&gt;</span><span style="color: #008000;">类型</span><span style="color: #808080;">&lt;/typeparam&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="t"&gt;</span><span style="color: #008000;">对象</span><span style="color: #808080;">&lt;/param&gt;</span>
            <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">string</span> ObjectToXml&lt;T&gt;(T t) <span style="color: #0000ff;">where</span> T : <span style="color: #0000ff;">class</span><span style="color: #000000;">
            {
                XmlSerializer formatter </span>= <span style="color: #0000ff;">new</span> XmlSerializer(<span style="color: #0000ff;">typeof</span><span style="color: #000000;">(T));
                </span><span style="color: #0000ff;">using</span> (MemoryStream stream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MemoryStream())
                {
                    formatter.Serialize(stream, t);
                    </span><span style="color: #0000ff;">string</span> result =<span style="color: #000000;"> Encoding.UTF8.GetString(stream.ToArray());
                    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
                }
            }

            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
            <span style="color: #808080;">///</span><span style="color: #008000;"> 将xml文件反序列化为对象
            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;typeparam name="T"&gt;</span><span style="color: #008000;">类型</span><span style="color: #808080;">&lt;/typeparam&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="t"&gt;</span><span style="color: #008000;">对象</span><span style="color: #808080;">&lt;/param&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="path"&gt;</span><span style="color: #008000;">xml路径</span><span style="color: #808080;">&lt;/param&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">对象</span><span style="color: #808080;">&lt;/returns&gt;</span>
            <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> T XmlToObject&lt;T&gt;(T t, <span style="color: #0000ff;">string</span> path) <span style="color: #0000ff;">where</span> T : <span style="color: #0000ff;">class</span><span style="color: #000000;">
            {
                XmlSerializer formatter </span>= <span style="color: #0000ff;">new</span> XmlSerializer(<span style="color: #0000ff;">typeof</span><span style="color: #000000;">(T));
                </span><span style="color: #0000ff;">using</span> (FileStream stream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileStream(path, FileMode.OpenOrCreate))
                {
                    XmlReader xmlReader </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> XmlTextReader(stream);
                    T result </span>= formatter.Deserialize(xmlReader) <span style="color: #0000ff;">as</span><span style="color: #000000;"> T;
                    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
                }
            }
        }

        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
            </span><span style="color: #0000ff;">#region</span> xml序列化与反序列化泛型方法<span style="color: #000000;">
            Book book </span>= <span style="color: #0000ff;">new</span> Book() { Id = <span style="color: #800080;">101</span>, Name = <span style="color: #800000;">"</span><span style="color: #800000;">C#程序设计</span><span style="color: #800000;">"</span>, Price = <span style="color: #800080;">79.5f</span><span style="color: #000000;"> };

            </span><span style="color: #008000;">//</span><span style="color: #008000;">对象序列化为xml</span>
            SerializerHelper.ObjectToXml(book, <span style="color: #800000;">@"</span><span style="color: #800000;">E:\book.xml</span><span style="color: #800000;">"</span><span style="color: #000000;">);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">xml反序列化为对象</span>
            Book outBook = SerializerHelper.XmlToObject(book, <span style="color: #800000;">@"</span><span style="color: #800000;">E:\book.xml</span><span style="color: #800000;">"</span><span style="color: #000000;">);
            Console.WriteLine($</span><span style="color: #800000;">"</span><span style="color: #800000;">{outBook.Id} {outBook.Name} {outBook.Price}</span><span style="color: #800000;">"</span><span style="color: #000000;">);

            Console.Read();
            </span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;">
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp; &nbsp; <strong>三、序列化为二进制文件</strong></p>
<p>&nbsp; &nbsp; C#中将对象序列化和反序列化为二进制文件的类是BinaryFormatter，要引用System.Runtime.Serialization.Formatters.Binary，另外Book类头要加</p>
<p><strong>[Serializable]</strong>属性。</p>
<p>&nbsp; &nbsp; 先创建一个BinaryFormatter对象实例，然后用实例的Serialize的方法将对象写入到文件流中，代码如下：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('048551c5-8a27-46dc-8f10-90b3a8a5a9fb')"><img id="code_img_closed_048551c5-8a27-46dc-8f10-90b3a8a5a9fb" class="code_img_closed" src="./images/C#序列化与反序列化学习笔记0.png" alt="" /><img id="code_img_opened_048551c5-8a27-46dc-8f10-90b3a8a5a9fb" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('048551c5-8a27-46dc-8f10-90b3a8a5a9fb',event)" src="./images/C#序列化与反序列化学习笔记1.png" alt="" />
<div id="cnblogs_code_open_048551c5-8a27-46dc-8f10-90b3a8a5a9fb" class="cnblogs_code_hide">
<pre><code>    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> Book类
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
<span style="color: #000000;">        [DataContract]
        [Serializable]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Book
        {
            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Id { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">float</span> Price { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        }

        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
            </span><span style="color: #0000ff;">#region</span> 对象序列化为二进制文件<span style="color: #000000;">
            Book book </span>= <span style="color: #0000ff;">new</span> Book() { Id = <span style="color: #800080;">101</span>, Name = <span style="color: #800000;">"</span><span style="color: #800000;">C#程序设计</span><span style="color: #800000;">"</span>, Price = <span style="color: #800080;">79.5f</span><span style="color: #000000;"> };

            </span><span style="color: #008000;">//</span><span style="color: #008000;">对象序列化为二进制文件</span>
            BinaryFormatter formatter = <span style="color: #0000ff;">new</span><span style="color: #000000;"> BinaryFormatter();
            </span><span style="color: #0000ff;">using</span> (FileStream stream = <span style="color: #0000ff;">new</span> FileStream(<span style="color: #800000;">@"</span><span style="color: #800000;">E:\book.txt</span><span style="color: #800000;">"</span><span style="color: #000000;">, FileMode.OpenOrCreate))
            {
                formatter.Serialize(stream, book);
            }
            Console.Read();
            </span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;">
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp; &nbsp;&nbsp;可以通过BinaryFormatter类型实例的Deserialize()方法把二进制文本反序列化为对象，代码如下：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('77bffbda-7290-4a0e-9297-42e8cfade60b')"><img id="code_img_closed_77bffbda-7290-4a0e-9297-42e8cfade60b" class="code_img_closed" src="./images/C#序列化与反序列化学习笔记0.png" alt="" /><img id="code_img_opened_77bffbda-7290-4a0e-9297-42e8cfade60b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('77bffbda-7290-4a0e-9297-42e8cfade60b',event)" src="./images/C#序列化与反序列化学习笔记1.png" alt="" />
<div id="cnblogs_code_open_77bffbda-7290-4a0e-9297-42e8cfade60b" class="cnblogs_code_hide">
<pre><code>    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> Book类
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
<span style="color: #000000;">        [DataContract]
        [Serializable]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Book
        {
            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Id { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">float</span> Price { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        }

        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
            </span><span style="color: #0000ff;">#region</span> 将二进制文件反序列化为对象<span style="color: #000000;">
            Book book </span>= <span style="color: #0000ff;">new</span> Book() { Id = <span style="color: #800080;">101</span>, Name = <span style="color: #800000;">"</span><span style="color: #800000;">C#程序设计</span><span style="color: #800000;">"</span>, Price = <span style="color: #800080;">79.5f</span><span style="color: #000000;"> };

            </span><span style="color: #008000;">//</span><span style="color: #008000;">序列化文件</span>
            BinaryFormatter formatter = <span style="color: #0000ff;">new</span><span style="color: #000000;"> BinaryFormatter();
            </span><span style="color: #0000ff;">using</span> (FileStream stream = <span style="color: #0000ff;">new</span> FileStream(<span style="color: #800000;">@"</span><span style="color: #800000;">E:\book.txt</span><span style="color: #800000;">"</span><span style="color: #000000;">, FileMode.OpenOrCreate))
            {
                Book outBook </span>= formatter.Deserialize(stream) <span style="color: #0000ff;">as</span><span style="color: #000000;"> Book;
                Console.WriteLine($</span><span style="color: #800000;">"</span><span style="color: #800000;">{outBook.Id} {outBook.Name} {outBook.Price}</span><span style="color: #800000;">"</span><span style="color: #000000;">);
            }
            Console.Read();
            </span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;">
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp; &nbsp; 运行结果如下：</p>
<p><img src="./images/C#序列化与反序列化学习笔记25.png" alt="" /></p>
<p>&nbsp; &nbsp;&nbsp;我们同样也可以把序列化和把序列化为二进制文件的方法封装成泛型方法，全部代码如下：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('467f9f54-85c4-4a08-acb4-f3b5fbd91950')"><img id="code_img_closed_467f9f54-85c4-4a08-acb4-f3b5fbd91950" class="code_img_closed" src="./images/C#序列化与反序列化学习笔记0.png" alt="" /><img id="code_img_opened_467f9f54-85c4-4a08-acb4-f3b5fbd91950" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('467f9f54-85c4-4a08-acb4-f3b5fbd91950',event)" src="./images/C#序列化与反序列化学习笔记1.png" alt="" />
<div id="cnblogs_code_open_467f9f54-85c4-4a08-acb4-f3b5fbd91950" class="cnblogs_code_hide">
<pre><code>    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> Book类
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
<span style="color: #000000;">        [DataContract]
        [Serializable]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Book
        {
            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Id { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

            [DataMember]
            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">float</span> Price { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
        }

        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 序列化反序列化帮助类
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> SerializerHelper
        {
            </span><span style="color: #0000ff;">#region</span> 二进制文件序列化反序列化
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
            <span style="color: #808080;">///</span><span style="color: #008000;"> 将对象序列化为字符串
            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;typeparam name="T"&gt;</span><span style="color: #008000;">类型</span><span style="color: #808080;">&lt;/typeparam&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="t"&gt;</span><span style="color: #008000;">实例</span><span style="color: #808080;">&lt;/param&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">字符串</span><span style="color: #808080;">&lt;/returns&gt;</span>
            <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">string</span> ObjectToString&lt;T&gt;<span style="color: #000000;">(T t)
            {
                BinaryFormatter formatter </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> BinaryFormatter();
                </span><span style="color: #0000ff;">using</span> (MemoryStream stream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MemoryStream())
                {
                    formatter.Serialize(stream, t);
                    </span><span style="color: #0000ff;">string</span> result =<span style="color: #000000;"> Encoding.UTF8.GetString(stream.ToArray());
                    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
                }
            }

            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
            <span style="color: #808080;">///</span><span style="color: #008000;"> 将对象序列化为二进制文件
            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;typeparam name="T"&gt;</span><span style="color: #008000;">类型</span><span style="color: #808080;">&lt;/typeparam&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="t"&gt;</span><span style="color: #008000;">实例</span><span style="color: #808080;">&lt;/param&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="path"&gt;</span><span style="color: #008000;">存放路径</span><span style="color: #808080;">&lt;/param&gt;</span>
            <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> ObjectToBinaryFile&lt;T&gt;(T t, <span style="color: #0000ff;">string</span><span style="color: #000000;"> path)
            {
                BinaryFormatter formatter </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> BinaryFormatter();
                </span><span style="color: #0000ff;">using</span> (FileStream stream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileStream(path, FileMode.OpenOrCreate))
                {
                    formatter.Serialize(stream, t);
                    stream.Flush();
                }
            }

            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
            <span style="color: #808080;">///</span><span style="color: #008000;"> 将字符串反序列为对象
            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;typeparam name="T"&gt;</span><span style="color: #008000;">类型</span><span style="color: #808080;">&lt;/typeparam&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="s"&gt;</span><span style="color: #008000;">字符串</span><span style="color: #808080;">&lt;/param&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">对象</span><span style="color: #808080;">&lt;/returns&gt;</span>
            <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> T StringToObject&lt;T&gt;(<span style="color: #0000ff;">string</span> s) <span style="color: #0000ff;">where</span> T : <span style="color: #0000ff;">class</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">byte</span>[] buffer =<span style="color: #000000;"> Encoding.UTF8.GetBytes(s);
                BinaryFormatter formatter </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> BinaryFormatter();
                </span><span style="color: #0000ff;">using</span> (MemoryStream stream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MemoryStream(buffer))
                {
                    T result </span>= formatter.Deserialize(stream) <span style="color: #0000ff;">as</span><span style="color: #000000;"> T;
                    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
                }
            }

            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
            <span style="color: #808080;">///</span><span style="color: #008000;"> 将二进制文件反序列化为对象
            </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;typeparam name="T"&gt;</span><span style="color: #008000;">类型</span><span style="color: #808080;">&lt;/typeparam&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="path"&gt;</span><span style="color: #008000;">路径</span><span style="color: #808080;">&lt;/param&gt;</span>
            <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">对象</span><span style="color: #808080;">&lt;/returns&gt;</span>
            <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> T BinaryFileToObject&lt;T&gt;(<span style="color: #0000ff;">string</span> path) <span style="color: #0000ff;">where</span> T : <span style="color: #0000ff;">class</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">using</span> (FileStream stream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileStream(path, FileMode.Open))
                {
                    BinaryFormatter formatter </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> BinaryFormatter();
                    T result </span>= formatter.Deserialize(stream) <span style="color: #0000ff;">as</span><span style="color: #000000;"> T;
                    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
                }
            }
            </span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;">
        }

        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
            </span><span style="color: #0000ff;">#region</span> 二进制文件序列化反序列化泛型方法<span style="color: #000000;">
            Book book </span>= <span style="color: #0000ff;">new</span> Book() { Id = <span style="color: #800080;">101</span>, Name = <span style="color: #800000;">"</span><span style="color: #800000;">C#程序设计</span><span style="color: #800000;">"</span>, Price = <span style="color: #800080;">79.5f</span><span style="color: #000000;"> };
            </span><span style="color: #008000;">//</span><span style="color: #008000;">对象序列化为二进制文件</span>
            SerializerHelper.ObjectToBinaryFile(book, <span style="color: #800000;">@"</span><span style="color: #800000;">E:\book.txt</span><span style="color: #800000;">"</span><span style="color: #000000;">);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">二进制文件反序列化为对象</span>
            Book outBook = SerializerHelper.BinaryFileToObject&lt;Book&gt;(<span style="color: #800000;">@"</span><span style="color: #800000;">E:\book.txt</span><span style="color: #800000;">"</span>) <span style="color: #0000ff;">as</span><span style="color: #000000;"> Book;
            Console.WriteLine($</span><span style="color: #800000;">"</span><span style="color: #800000;">{outBook.Id} {outBook.Name} {outBook.Price}</span><span style="color: #800000;">"</span><span style="color: #000000;">);

            Console.Read();
            </span><span style="color: #0000ff;">#endregion</span><span style="color: #000000;">
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp; &nbsp; 运行结果如下：</p>
<p><img src="./images/C#序列化与反序列化学习笔记28.png" alt="" /></p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>