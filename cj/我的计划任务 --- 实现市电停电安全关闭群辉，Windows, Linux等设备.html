<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修我的计划任务 --- 实现市电停电安全关闭群辉，Windows, Linux等设备' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>我的计划任务 --- 实现市电停电安全关闭群辉，Windows, Linux等设备</center></div><div class='banquan'>原文出处:本文由博客园博主GavinLuo提供。<br/>
原文连接:https://www.cnblogs.com/gavinluo/p/11942027.html</div><br>
    <p>有一次突然停电，我的群辉DS218+ 的一块硬盘出现故障了，让我担心我的数据安全，其实我是有UPS， 不是在线式的，然后就想如何实现停电自动关机呢？ 经过半天的了解，其实群辉支持telnet协议，于是用.net开发了一个计划任务的服务，它可以检查一个ip不通后自动实现一些动作。</p>
<p>实现思想已搞通，把我的<span style="text-decoration: underline; background-color: #ffff00;">路由器不通过UPS直接接市电</span>，我的<span style="background-color: #ffff00;">电脑和群辉DS218+，和它们连接的交换机接在UPS上</span>，&nbsp; 当市电停电后我的电脑自然ping不通我的路由器ip，然后通过telnet访问群辉，发出shutdown -h now 指令，然后再对我的电脑运行shutdown -s -f -t 30 ，这样我的存储和电脑都实现了安全关机，不能要在线式的UPS也可以。</p>
<p>TIPS:</p>
<p>这里有一个坑，telnet 访问群辉要使用shutdows指令必须要用root权限，所以还要通过你当前管理员权限是启用和设置root账户密码。方法如下:</p>
<p>1,首先要启用telnet.&nbsp; &nbsp;</p>
<p><img src="./images/我的计划任务 --- 实现市电停电安全关闭群辉，Windows, Linux等设备0.png" alt="" width="578" height="365" /></p>
<p>&nbsp;</p>
<p>2,使用admin访问</p>
<p><img src="./images/我的计划任务 --- 实现市电停电安全关闭群辉，Windows, Linux等设备1.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>3，输入sudo su -</p>
<p><img src="./images/我的计划任务 --- 实现市电停电安全关闭群辉，Windows, Linux等设备2.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>4， 再次输入admin密码</p>
<p>5，输入synouser --setpw root 密码&nbsp; 设置和启用root密码</p>
<p><img src="./images/我的计划任务 --- 实现市电停电安全关闭群辉，Windows, Linux等设备3.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>软件说明：是使用.net开发的NT服务，所以要使用下面命令安装</p>
<p>%windir%\Microsoft.NET\Framework\v4.0.30319\installutil TaskSchedulerService.exe&nbsp;</p>
<p>然后进行配置，软件包里有例子， tasklist.xml是任务配置信息，配置要检查的ip，&nbsp; qunhui_config.ini 是配置telnet访问群辉的信息，第一次密码用[] 符号括起来，运行服务后系统会自动对它加密，很贴心吧。</p>
<p><img src="./images/我的计划任务 --- 实现市电停电安全关闭群辉，Windows, Linux等设备4.png" alt="" /></p>
<p>下载地址：<a href="https://files.cnblogs.com/files/gavinluo/TaskSchedulerService.zip" target="_blank">下载</a></p>
<p>欢迎大家反馈意见，把它用在运维上还是挺有价值的。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>