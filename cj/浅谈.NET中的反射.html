<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修浅谈.NET中的反射' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>浅谈.NET中的反射</center></div><div class='banquan'>原文出处:本文由博客园博主萌萌丶小魔王提供。<br/>
原文连接:https://www.cnblogs.com/xiaomowang/p/11948998.html</div><br>
    <p><span style="font-size: 16px;"><strong>一、概述&nbsp;</strong></span></p>
<p><span style="font-size: 16px;">1、通过反射可以提供类型信息，从而使得我们开发人员在运行时能够利用这些信息构造和使用对象</span></p>
<p><span style="font-size: 16px;">2、反射机制允许程序在执行过程中动态地添加各种功能</span></p>
<p><span style="font-size: 16px;"><strong>二、运行时类型标识</strong></span></p>
<p><span style="font-size: 16px;">1、运行时类型标志（RTTI），可以在程序执行期间判断对象类型。例如使用他能够确切的知道基类引用指向了什么类型对象。</span></p>
<p><span style="font-size: 16px;">2、运行时类型标识，能预先测试某个强制类型转换操作，能否成功，从而避免无效的强制类型转换异常。</span></p>
<p><span style="font-size: 16px;">3、在C#中有三个支持RTTI的关键字：is、as、typeof。下面一次介绍他们</span></p>
<p><strong><span style="font-size: 16px;">is运算符：</span></strong></p>
<p><span style="font-size: 16px;">通过is运算符，能够判断对象类型是否为特定类型，如果两种类型时相同类型，或者两者之间存在引用，装箱拆箱转换，则表明两种类型时兼容的。代码如下：</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #008080;"> 1</span>         <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> Main()
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 3</span>             A a = <span style="color: #0000ff;">new</span><span style="color: #000000;"> A();
</span><span style="color: #008080;"> 4</span>             B b = <span style="color: #0000ff;">new</span><span style="color: #000000;"> B();
</span><span style="color: #008080;"> 5</span>             <span style="color: #0000ff;">if</span> (a <span style="color: #0000ff;">is</span><span style="color: #000000;"> A)
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">            {
</span><span style="color: #008080;"> 7</span>                 Console.WriteLine(<span style="color: #800000;">"</span><span style="color: #800000;">a is an A</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span>             <span style="color: #0000ff;">if</span> (b <span style="color: #0000ff;">is</span><span style="color: #000000;"> A)
</span><span style="color: #008080;">11</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">12</span>                 Console.WriteLine(<span style="color: #800000;">"</span><span style="color: #800000;">b is an A because it is derived from</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">13</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span>             <span style="color: #0000ff;">if</span> (a <span style="color: #0000ff;">is</span><span style="color: #000000;"> B)
</span><span style="color: #008080;">16</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">17</span>                 Console.WriteLine(<span style="color: #800000;">"</span><span style="color: #800000;">This won't display,because a not derived from B</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">18</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">19</span> 
<span style="color: #008080;">20</span>             <span style="color: #0000ff;">if</span> (a <span style="color: #0000ff;">is</span> <span style="color: #0000ff;">object</span><span style="color: #000000;">)
</span><span style="color: #008080;">21</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">22</span>                 Console.WriteLine(<span style="color: #800000;">"</span><span style="color: #800000;">a is an object</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">23</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">24</span> <span style="color: #000000;">            Console.ReadKey();
</span><span style="color: #008080;">25</span>         }</span></pre>
</div>
<p><strong><span style="font-size: 16px;">结果：</span></strong></p>
<p><span style="font-size: 16px;"><img src="./images/浅谈.NET中的反射0.png" alt="" /></span></p>
<p><span style="font-size: 16px;">&nbsp;</span></p>
<p><strong><span style="font-size: 16px;">&nbsp;as运算符：</span></strong></p>
<p><span style="font-size: 16px;">在运行期间执行类型转换，并且能够是的类型转换失败不抛出异常，而返回一个null值，其实as也可以看作一个is运算符的简化备选方式，如下：</span></p>
<p><span style="font-size: 16px;">&nbsp;</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #008080;"> 1</span>         <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> Main()
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 3</span>             A a = <span style="color: #0000ff;">new</span><span style="color: #000000;"> A();
</span><span style="color: #008080;"> 4</span>             B b = <span style="color: #0000ff;">new</span><span style="color: #000000;"> B();
</span><span style="color: #008080;"> 5</span>             <span style="color: #0000ff;">if</span> (a <span style="color: #0000ff;">is</span><span style="color: #000000;"> B)
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">            {
</span><span style="color: #008080;"> 7</span>                 b = (B) a;<span style="color: #008000;">//</span><span style="color: #008000;">由于a变量不是B类型，因此这里将a变量转换为B类型时无效的</span>
<span style="color: #008080;"> 8</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 9</span>             <span style="color: #0000ff;">else</span>
<span style="color: #008080;">10</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">11</span>                 b = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">12</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span>             <span style="color: #0000ff;">if</span> (b==<span style="color: #0000ff;">null</span><span style="color: #000000;">)
</span><span style="color: #008080;">15</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">16</span>                 Console.WriteLine(<span style="color: #800000;">"</span><span style="color: #800000;">The cast in b=(B)a is not allowed</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">17</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">18</span>             <span style="color: #008000;">//</span><span style="color: #008000;">上面使用as运算符，能够把两部分合二为一</span>
<span style="color: #008080;">19</span>             b = a <span style="color: #0000ff;">as</span> B;<span style="color: #008000;">//</span><span style="color: #008000;">as运算符先检查将之转换类型的有效性，如果有效，则执行强类型转换过程，这些都在这一句话完成</span>
<span style="color: #008080;">20</span>             <span style="color: #0000ff;">if</span> (b==<span style="color: #0000ff;">null</span><span style="color: #000000;">)
</span><span style="color: #008080;">21</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">22</span>                 Console.WriteLine(<span style="color: #800000;">"</span><span style="color: #800000;">The cast in b=(B)a is not allowed</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">23</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">24</span> <span style="color: #000000;">            Console.ReadKey();
</span><span style="color: #008080;">25</span>         }</span></pre>
</div>
<p><span style="font-size: 16px;">结果：</span></p>
<p><span style="font-size: 16px;"><img src="./images/浅谈.NET中的反射1.png" alt="" /></span></p>
<p><span style="font-size: 16px;">&nbsp;</span></p>
<p><strong><span style="font-size: 16px;">&nbsp;typeof运算符：</span></strong></p>
<p><span style="font-size: 16px;">as、is 能够测试两种类型的兼容性，但大多数情况下，还需要获得某个类型的具体信息。这就用到了typeof，他可以返回与具体类型相关的System.Type对象，通过System.Type对象可以去定此类型的特征。一旦获得给定类型的Type对象，就可以通过使用对象定义的各自属性、字段、方法来获取类型的具体信息。Type类包含了很多成元，在接下来的反射中再详细讨论。下面简单的演示Type对象，调用它的三个属性。</span></p>
<p><span style="font-size: 16px;">&nbsp;</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #008080;"> 1</span>         <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> Main()
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 3</span>             Type t = <span style="color: #0000ff;">typeof</span><span style="color: #000000;">(StringBuilder);
</span><span style="color: #008080;"> 4</span>             Console.WriteLine(t.FullName);<span style="color: #008000;">//</span><span style="color: #008000;">FullName属性返回类型的全称</span>
<span style="color: #008080;"> 5</span>             <span style="color: #0000ff;">if</span><span style="color: #000000;"> (t.IsClass)
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">            {
</span><span style="color: #008080;"> 7</span>                 Console.WriteLine(<span style="color: #800000;">"</span><span style="color: #800000;">is a Class</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span>             <span style="color: #0000ff;">if</span><span style="color: #000000;"> (t.IsSealed)
</span><span style="color: #008080;">11</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">12</span>                 Console.WriteLine(<span style="color: #800000;">"</span><span style="color: #800000;">is Sealed</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">13</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">14</span> <span style="color: #000000;">            Console.ReadKey();
</span><span style="color: #008080;">15</span>         }</span></pre>
</div>
<p><strong><span style="font-size: 16px;">结果：</span></strong></p>
<p><span style="font-size: 16px;"><img src="./images/浅谈.NET中的反射2.png" alt="" /></span></p>
<p><span style="font-size: 16px;">&nbsp;</span></p>
<p><span style="font-size: 16px;">&nbsp;</span></p>
<p><strong><span style="font-size: 16px;">三、反射的核心类型：System.Type类</span></strong></p>
<p><span style="font-size: 16px;">1、许多支持反射的类型都位于System.Reflection命名空间中，他们是.net Reflection API的一部分，所以再使用的反射的程序中一般都是要使用System.Reflection的命名空间。</span></p>
<p><span style="font-size: 16px;">2、System.Type类包装了类型，因此是整个反射子系统的核心，这个类中包含了很多属性和方法，使用这些属性和方法可以再运行时得到类型的信息。</span></p>
<p><span style="font-size: 16px;">3、Type类派生于System.Reflection.MemberInfo抽象类</span></p>
<table border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td colspan="2" valign="top" width="568">
<p align="center"><span style="font-size: 16px;">MemberInfo类中的只读属性</span></p>
</td>
</tr>
<tr>
<td valign="top" width="284">
<p align="center"><span style="font-size: 16px;">属性</span></p>
</td>
<td valign="top" width="284">
<p align="center"><span style="font-size: 16px;">描述</span></p>
</td>
</tr>
<tr>
<td valign="top" width="284">
<p><span style="font-size: 16px;">Type&nbsp;DeclaringType</span></p>
</td>
<td valign="top" width="284">
<p><span style="font-size: 16px;">获取声明该成员的类或接口的类型</span></p>
</td>
</tr>
<tr>
<td valign="top" width="284">
<p><span style="font-size: 16px;">MemberTypes&nbsp;&nbsp;MemberType</span></p>
</td>
<td valign="top" width="284">
<p><span style="font-size: 16px;">获取成员的类型，这个值用于指示该成员是字段、方法、属性、事件、或构造函数</span></p>
</td>
</tr>
<tr>
<td valign="top" width="284">
<p><span style="font-size: 16px;">Int&nbsp;MetadataToken</span></p>
</td>
<td valign="top" width="284">
<p><span style="font-size: 16px;">获取与特定元数据相关的值</span></p>
</td>
</tr>
<tr>
<td valign="top" width="284">
<p><span style="font-size: 16px;">Module&nbsp;Module</span></p>
</td>
<td valign="top" width="284">
<p><span style="font-size: 16px;">获取一个代表反射类型所在模块（可执行文件）的Module对象</span></p>
</td>
</tr>
<tr>
<td valign="top" width="284">
<p><span style="font-size: 16px;">String&nbsp;&nbsp;Name</span></p>
</td>
<td valign="top" width="284">
<p><span style="font-size: 16px;">成员的名称</span></p>
</td>
</tr>
<tr>
<td valign="top" width="284">
<p><span style="font-size: 16px;">Type&nbsp;&nbsp;ReflectedType</span></p>
</td>
<td valign="top" width="284">
<p><span style="font-size: 16px;">反射的对象类型</span></p>
</td>
</tr>
</tbody>
</table>
<p><strong><span style="font-size: 16px;">请注意：</span></strong></p>
<p><span style="font-size: 16px;">1、MemberType属性的返回类型为MemberTypes，这是一个枚举，它定义了用于表示不同成元的信息值，这些包括：MemberTypes.Constructor、MemeberTypes.Method、MemberTypes.Event、MemberTypes.Property。因此可以通过检查MemberType属性来确定成元的类型，例如在MenberType属性的值为MemberTypes.Method时，该成员为方法</span></p>
<p><span style="font-size: 16px;">2、MemberInfo类还包含两个与特性相关的抽象方法：</span></p>
<p><span style="font-size: 16px;">（1）GetCustomAttributes()：获得与主调对象相关的自定义特性列表。</span></p>
<p><span style="font-size: 16px;">（2）IsDefined()：确定是否为主调对象定义了相应的特性。</span></p>
<p><span style="font-size: 16px;">（3）GetCustomeAttributesData()：返回有关自定义特性的信息（特性稍后便会提到）</span></p>
<p><span style="font-size: 16px;">当然除了MemberInfo类定义的方法和属性外，Type类自己也添加了许多属性和方法：如下表（只列出一些常用的，太多二零，自己可以转定义Type类看一下）</span></p>
<table border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td colspan="2" width="568">
<p align="center"><span style="font-size: 16px;">Type类定义的方法</span></p>
</td>
</tr>
<tr>
<td valign="top" width="284">
<p align="center"><span style="font-size: 16px;">方法</span></p>
</td>
<td valign="top" width="284">
<p align="center"><span style="font-size: 16px;">功能</span></p>
</td>
</tr>
<tr>
<td valign="top" width="284">
<p align="left"><span style="font-size: 16px;">ConstructorInfo[]&nbsp; GetConstructors()</span></p>
</td>
<td valign="top" width="284">
<p align="left"><span style="font-size: 16px;">获取指定类型的构造函数列表</span></p>
</td>
</tr>
<tr>
<td valign="top" width="284">
<p align="left"><span style="font-size: 16px;">EventInfo[]&nbsp; &nbsp;GetEvents();</span></p>
</td>
<td valign="top" width="284">
<p align="left"><span style="font-size: 16px;">获取指定类型的时间列</span></p>
</td>
</tr>
<tr>
<td valign="top" width="284">
<p align="left"><span style="font-size: 16px;">FieldInfo[]&nbsp; &nbsp;GetFields();</span></p>
</td>
<td valign="top" width="284">
<p align="left"><span style="font-size: 16px;">获取指定类型的字段列</span></p>
</td>
</tr>
<tr>
<td width="284">
<p><span style="font-size: 16px;">Type[]&nbsp; &nbsp;GetGenericArguments();</span></p>
</td>
<td valign="top" width="284">
<p align="left"><span style="font-size: 16px;">获取与已构造的泛型类型绑定的类型参数列表，如果指定类型的泛型类型定义，则获得类型形参。对于正早构造的类型，该列表就可能同时包含类型实参和类型形参</span></p>
</td>
</tr>
<tr>
<td valign="top" width="284">
<p align="left"><span style="font-size: 16px;">MemberInfo[]&nbsp;&nbsp; GetMembers();</span></p>
</td>
<td valign="top" width="284">
<p align="left"><span style="font-size: 16px;">获取指定类型的成员列表</span></p>
</td>
</tr>
<tr>
<td valign="top" width="284">
<p align="left"><span style="font-size: 16px;">MethodInfo[]&nbsp; &nbsp;GetMethods();</span></p>
</td>
<td valign="top" width="284">
<p align="left"><span style="font-size: 16px;">获取指定类型的方法列表</span></p>
</td>
</tr>
<tr>
<td valign="top" width="284">
<p align="left"><span style="font-size: 16px;">PropertyInfo[]&nbsp; &nbsp;GetProperties();</span></p>
</td>
<td valign="top" width="284">
<p align="left"><span style="font-size: 16px;">获取指定类型的属性列表</span></p>
</td>
</tr>
</tbody>
</table>
<p><span style="font-size: 16px;">下面列出Type类型定义的常用只读属性</span></p>
<table border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td colspan="2" valign="top" width="588">
<p align="center"><span style="font-size: 16px;">Type类定义的属性</span></p>
</td>
</tr>
<tr>
<td valign="top" width="294">
<p align="center"><span style="font-size: 16px;">属性</span></p>
</td>
<td valign="top" width="294">
<p align="center"><span style="font-size: 16px;">功能</span></p>
</td>
</tr>
<tr>
<td valign="top" width="294">
<p><span style="font-size: 16px;">&nbsp;Assembly&nbsp; &nbsp;Assembly&nbsp;</span></p>
</td>
<td valign="top" width="294">
<p><span style="font-size: 16px;">获取指定类型的程序集</span></p>
</td>
</tr>
<tr>
<td valign="top" width="294">
<p><span style="font-size: 16px;">TypeAttributes &nbsp; Attributes</span></p>
</td>
<td valign="top" width="294">
<p><span style="font-size: 16px;">获取制定类型的特性</span></p>
</td>
</tr>
<tr>
<td valign="top" width="294">
<p><span style="font-size: 16px;">Type &nbsp;&nbsp;BaseType</span></p>
</td>
<td valign="top" width="294">
<p><span style="font-size: 16px;">获取指定类型的直接基类型</span></p>
</td>
</tr>
<tr>
<td valign="top" width="294">
<p><span style="font-size: 16px;">String &nbsp;FullName</span></p>
</td>
<td valign="top" width="294">
<p><span style="font-size: 16px;">获取指定类型的全名</span></p>
</td>
</tr>
<tr>
<td valign="top" width="294">
<p><span style="font-size: 16px;">bool&nbsp;&nbsp; IsAbstract</span></p>
</td>
<td valign="top" width="294">
<p><span style="font-size: 16px;">如果指定类型是抽象类型，返回true</span></p>
</td>
</tr>
<tr>
<td valign="top" width="294">
<p><span style="font-size: 16px;">bool&nbsp;&nbsp; IsClass</span></p>
</td>
<td valign="top" width="294">
<p><span style="font-size: 16px;">如果指定类型是类，返回true</span></p>
</td>
</tr>
<tr>
<td valign="top" width="294">
<p><span style="font-size: 16px;">string&nbsp;&nbsp; Namespace</span></p>
</td>
<td valign="top" width="294">
<p><span style="font-size: 16px;">获取指定类型的命名空间</span></p>
</td>
</tr>
</tbody>
</table>
<p><strong><span style="font-size: 16px;">四、使用反射</span></strong></p>
<p><span style="font-size: 16px;">上面将的这些，都是为了使用反射做铺垫的。</span></p>
<p><span style="font-size: 16px;">通过使用Type类定义的方法和属性，我们能够在运行时获得类型的各种具体信息。这是一个非常强大的功能，我们一旦得到类型信息，就可以调用其构造函数、方法、属性，可见，反射是允许使用编译时不可用的代码的。</span></p>
<p><span style="font-size: 16px;">由于Feflection API非常多，这里不可能完整的介绍他们（这里如果完整的介绍，据说要一本书，厚书）。但是Reflection API是按照一定逻辑设计的，因此，只要知道部分接口的使用方法，就可以举一反三的使用剩余的接口。</span></p>
<p><span style="font-size: 16px;">这里我列出四种关键的反射技术：</span></p>
<p><span style="font-size: 16px;">1、获取方法的信息</span></p>
<p><span style="font-size: 16px;">2、调用方法</span></p>
<p><span style="font-size: 16px;">3、构造对象</span></p>
<p><span style="font-size: 16px;">4、从程序集中加载类型</span></p>
<p><strong><span style="font-size: 16px;">五、获取方法的相关信息</span></strong></p>
<p><span style="font-size: 16px;">一旦有了Type对象就可以使用GetMethodInfo()方法获取此类型支持的所有方法列表。该方法返回一个MethodInfo对象数组，MethodInfo对象表述了主调类型所支持的方法，它位于System.Reflection命名空间中。MethodInfo类派生于MethodBase抽象类，而MethodBase类继承了MemberInfo类，因此，我们能够使用这三各类定义的属性和方法。例如，使用Name属性的到方法名，这里有两个重要的成员：</span></p>
<p><span style="font-size: 16px;">1、ReturnType属性：为Type类型的对象，能够提供方法的返回类型信息。</span></p>
<p><span style="font-size: 16px;">2、GetParameters()方法：返回参数列表，参数信息以数组的形式保存在PatameterInfo对象中。PatameterInfo类定义了大量表述参数信息的属性和方法，这里也累出两个常用的属性：Name（包含参数名称信息的字符串），ParameterType（参数类型的信息）。</span></p>
<p><span style="font-size: 16px;">下面代码我将使用反射获得类中的所支持的方法，还有方法的信息：</span></p>
<p><span style="font-size: 16px;">&nbsp;</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> Main()
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 5</span>             <span style="color: #008000;">//</span><span style="color: #008000;">获取描述MyClass类型的Type对象</span>
<span style="color: #008080;"> 6</span>             Type t = <span style="color: #0000ff;">typeof</span><span style="color: #000000;">(MyClass);
</span><span style="color: #008080;"> 7</span>             Console.WriteLine($<span style="color: #800000;">"</span><span style="color: #800000;">Analyzing methods in {t.Name}</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 8</span>             <span style="color: #008000;">//</span><span style="color: #008000;">MethodInfo对象在System.Reflection命名空间下</span>
<span style="color: #008080;"> 9</span>             MethodInfo[] mi =<span style="color: #000000;"> t.GetMethods();
</span><span style="color: #008080;">10</span>             <span style="color: #0000ff;">foreach</span> (<span style="color: #0000ff;">var</span> methodInfo <span style="color: #0000ff;">in</span><span style="color: #000000;"> mi)
</span><span style="color: #008080;">11</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">12</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">返回方法的返回类型</span>
<span style="color: #008080;">13</span> <span style="color: #000000;">                Console.Write(methodInfo.ReturnType.Name);
</span><span style="color: #008080;">14</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">返回方法的名称</span>
<span style="color: #008080;">15</span>                 Console.Write($<span style="color: #800000;">"</span><span style="color: #800000;"> {methodInfo.Name} (</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">16</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">获取方法阐述列表并保存在ParameterInfo对象组中</span>
<span style="color: #008080;">17</span>                 ParameterInfo[] pi =<span style="color: #000000;"> methodInfo.GetParameters();
</span><span style="color: #008080;">18</span>                 <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; pi.Length; i++<span style="color: #000000;">)
</span><span style="color: #008080;">19</span> <span style="color: #000000;">                {
</span><span style="color: #008080;">20</span>                     <span style="color: #008000;">//</span><span style="color: #008000;">方法的参数类型名称</span>
<span style="color: #008080;">21</span> <span style="color: #000000;">                    Console.Write(pi[i].ParameterType.Name);
</span><span style="color: #008080;">22</span>                     <span style="color: #008000;">//</span><span style="color: #008000;">方法的参数名</span>
<span style="color: #008080;">23</span>                     Console.Write($<span style="color: #800000;">"</span><span style="color: #800000;"> {pi[i].Name}</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">24</span>                     <span style="color: #0000ff;">if</span> (i+<span style="color: #800080;">1</span>&lt;<span style="color: #000000;">pi.Length)
</span><span style="color: #008080;">25</span> <span style="color: #000000;">                    {
</span><span style="color: #008080;">26</span>                         Console.Write(<span style="color: #800000;">"</span><span style="color: #800000;">, </span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">27</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;">28</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">29</span> 
<span style="color: #008080;">30</span>                 Console.Write(<span style="color: #800000;">"</span><span style="color: #800000;">)</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">31</span>                 Console.Write(<span style="color: #800000;">"</span><span style="color: #800000;">\r\n</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">32</span>                 Console.WriteLine(<span style="color: #800000;">"</span><span style="color: #800000;">--------------------------</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">33</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">34</span> <span style="color: #000000;">            Console.ReadKey();
</span><span style="color: #008080;">35</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">36</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">37</span> 
<span style="color: #008080;">38</span>     <span style="color: #0000ff;">class</span><span style="color: #000000;"> MyClass
</span><span style="color: #008080;">39</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">40</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> x;
</span><span style="color: #008080;">41</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> y;
</span><span style="color: #008080;">42</span> 
<span style="color: #008080;">43</span>         <span style="color: #0000ff;">public</span><span style="color: #000000;"> MyClass()
</span><span style="color: #008080;">44</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">45</span>             x = <span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;">46</span>             y = <span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;">47</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">48</span> 
<span style="color: #008080;">49</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> Sum()
</span><span style="color: #008080;">50</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">51</span>             <span style="color: #0000ff;">return</span> x +<span style="color: #000000;"> y;
</span><span style="color: #008080;">52</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">53</span> 
<span style="color: #008080;">54</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">bool</span> IsBetween(<span style="color: #0000ff;">int</span><span style="color: #000000;"> i)
</span><span style="color: #008080;">55</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">56</span>             <span style="color: #0000ff;">if</span> (x &lt; i &amp;&amp; i &lt;<span style="color: #000000;"> y)
</span><span style="color: #008080;">57</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">58</span>                 <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">59</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">60</span> 
<span style="color: #008080;">61</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">62</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">63</span> 
<span style="color: #008080;">64</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> Set(<span style="color: #0000ff;">int</span> a, <span style="color: #0000ff;">int</span><span style="color: #000000;"> b)
</span><span style="color: #008080;">65</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">66</span>             x =<span style="color: #000000;"> a;
</span><span style="color: #008080;">67</span>             y =<span style="color: #000000;"> b;
</span><span style="color: #008080;">68</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">69</span> 
<span style="color: #008080;">70</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> Set(<span style="color: #0000ff;">double</span> a, <span style="color: #0000ff;">double</span><span style="color: #000000;"> b)
</span><span style="color: #008080;">71</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">72</span>             x = (<span style="color: #0000ff;">int</span><span style="color: #000000;">)a;
</span><span style="color: #008080;">73</span>             y = (<span style="color: #0000ff;">int</span><span style="color: #000000;">)b;
</span><span style="color: #008080;">74</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">75</span> 
<span style="color: #008080;">76</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> Show()
</span><span style="color: #008080;">77</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">78</span>             System.Console.WriteLine($<span style="color: #800000;">"</span><span style="color: #800000;">x:{x},y:{y}</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">79</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">80</span>     }</span></pre>
</div>
<p><span style="font-size: 16px;">输出结果：</span></p>
<p><span style="font-size: 16px;"><img src="./images/浅谈.NET中的反射3.png" alt="" /></span></p>
<p><span style="font-size: 16px;">&nbsp;</span></p>
<p><span style="font-size: 16px;">&nbsp;注意：这里输出的除了MyClass类定义的所有方法外，也会显示object类定义的共有非静态方法。这是因为C#中的所有类型都继承于Object类。另外，这些信息是在程序运行时动态获得的，并不需要知道MyClass类的定义</span></p>
<p><span style="font-size: 16px;">GetMethods()方法的另一种形式</span></p>
<p><span style="font-size: 16px;">这种形式可以指定各种标记，已筛选想要获取的方法，他的通用形式为：MethodInfo[] GetMethods(BindingFlags bindingAttr)</span></p>
<p><span style="font-size: 16px;">BindingFlags是一个枚举，枚举值有（很多，这里只列出5个常用的吧）</span></p>
<p><span style="font-size: 16px;">（1）DeclareOnly：仅获取指定类定义的方法，而不获取所继承的方法</span></p>
<p><span style="font-size: 16px;">（2）Instance：获取实例方法</span></p>
<p><span style="font-size: 16px;">（3）NonPublic：获取非公有方法</span></p>
<p><span style="font-size: 16px;">（4）Public：获取共有方法</span></p>
<p><span style="font-size: 16px;">（5）Static：获取静态方法</span></p>
<p><span style="font-size: 16px;">GetMethods(BindingFlags bindingAttr)这个方法，参数可以使用 or 把两个或更多标记连接在一起，实际上至少要有Instance（或 Static）与Public（或 NonPublic）标记，否则将不会获取任何方法。下我们就写一个示例来演示一下。</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> Main()
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 5</span>             <span style="color: #008000;">//</span><span style="color: #008000;">获取描述MyClass类型的Type对象</span>
<span style="color: #008080;"> 6</span>             Type t = <span style="color: #0000ff;">typeof</span><span style="color: #000000;">(MyClass);
</span><span style="color: #008080;"> 7</span>             Console.WriteLine($<span style="color: #800000;">"</span><span style="color: #800000;">Analyzing methods in {t.Name}</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 8</span>             <span style="color: #008000;">//</span><span style="color: #008000;">MethodInfo对象在System.Reflection命名空间下
</span><span style="color: #008080;"> 9</span>             <span style="color: #008000;">//</span><span style="color: #008000;">不获取继承方法，为实例方法，&middot;为公用的</span>
<span style="color: #008080;">10</span>             MethodInfo[] mi = t.GetMethods(BindingFlags.DeclaredOnly|BindingFlags.Instance|<span style="color: #000000;">BindingFlags.Public);
</span><span style="color: #008080;">11</span>             <span style="color: #0000ff;">foreach</span> (<span style="color: #0000ff;">var</span> methodInfo <span style="color: #0000ff;">in</span><span style="color: #000000;"> mi)
</span><span style="color: #008080;">12</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">13</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">返回方法的返回类型</span>
<span style="color: #008080;">14</span> <span style="color: #000000;">                Console.Write(methodInfo.ReturnType.Name);
</span><span style="color: #008080;">15</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">返回方法的名称</span>
<span style="color: #008080;">16</span>                 Console.Write($<span style="color: #800000;">"</span><span style="color: #800000;"> {methodInfo.Name} (</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">17</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">获取方法阐述列表并保存在ParameterInfo对象组中</span>
<span style="color: #008080;">18</span>                 ParameterInfo[] pi =<span style="color: #000000;"> methodInfo.GetParameters();
</span><span style="color: #008080;">19</span>                 <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; pi.Length; i++<span style="color: #000000;">)
</span><span style="color: #008080;">20</span> <span style="color: #000000;">                {
</span><span style="color: #008080;">21</span>                     <span style="color: #008000;">//</span><span style="color: #008000;">方法的参数类型名称</span>
<span style="color: #008080;">22</span> <span style="color: #000000;">                    Console.Write(pi[i].ParameterType.Name);
</span><span style="color: #008080;">23</span>                     <span style="color: #008000;">//</span><span style="color: #008000;">方法的参数名</span>
<span style="color: #008080;">24</span>                     Console.Write($<span style="color: #800000;">"</span><span style="color: #800000;"> {pi[i].Name}</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">25</span>                     <span style="color: #0000ff;">if</span> (i+<span style="color: #800080;">1</span>&lt;<span style="color: #000000;">pi.Length)
</span><span style="color: #008080;">26</span> <span style="color: #000000;">                    {
</span><span style="color: #008080;">27</span>                         Console.Write(<span style="color: #800000;">"</span><span style="color: #800000;">, </span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">28</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;">29</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">30</span> 
<span style="color: #008080;">31</span>                 Console.Write(<span style="color: #800000;">"</span><span style="color: #800000;">)</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">32</span>                 Console.Write(<span style="color: #800000;">"</span><span style="color: #800000;">\r\n</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">33</span>                 Console.WriteLine(<span style="color: #800000;">"</span><span style="color: #800000;">--------------------------</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">34</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">35</span> <span style="color: #000000;">            Console.ReadKey();
</span><span style="color: #008080;">36</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">37</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">38</span> 
<span style="color: #008080;">39</span>     <span style="color: #0000ff;">class</span><span style="color: #000000;"> MyClass
</span><span style="color: #008080;">40</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">41</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> x;
</span><span style="color: #008080;">42</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> y;
</span><span style="color: #008080;">43</span> 
<span style="color: #008080;">44</span>         <span style="color: #0000ff;">public</span><span style="color: #000000;"> MyClass()
</span><span style="color: #008080;">45</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">46</span>             x = <span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;">47</span>             y = <span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;">48</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">49</span> 
<span style="color: #008080;">50</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> Sum()
</span><span style="color: #008080;">51</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">52</span>             <span style="color: #0000ff;">return</span> x +<span style="color: #000000;"> y;
</span><span style="color: #008080;">53</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">54</span> 
<span style="color: #008080;">55</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">bool</span> IsBetween(<span style="color: #0000ff;">int</span><span style="color: #000000;"> i)
</span><span style="color: #008080;">56</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">57</span>             <span style="color: #0000ff;">if</span> (x &lt; i &amp;&amp; i &lt;<span style="color: #000000;"> y)
</span><span style="color: #008080;">58</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">59</span>                 <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">60</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">61</span> 
<span style="color: #008080;">62</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">63</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">64</span> 
<span style="color: #008080;">65</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> Set(<span style="color: #0000ff;">int</span> a, <span style="color: #0000ff;">int</span><span style="color: #000000;"> b)
</span><span style="color: #008080;">66</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">67</span>             x =<span style="color: #000000;"> a;
</span><span style="color: #008080;">68</span>             y =<span style="color: #000000;"> b;
</span><span style="color: #008080;">69</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">70</span> 
<span style="color: #008080;">71</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> Set(<span style="color: #0000ff;">double</span> a, <span style="color: #0000ff;">double</span><span style="color: #000000;"> b)
</span><span style="color: #008080;">72</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">73</span>             x = (<span style="color: #0000ff;">int</span><span style="color: #000000;">)a;
</span><span style="color: #008080;">74</span>             y = (<span style="color: #0000ff;">int</span><span style="color: #000000;">)b;
</span><span style="color: #008080;">75</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">76</span> 
<span style="color: #008080;">77</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> Show()
</span><span style="color: #008080;">78</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">79</span>             System.Console.WriteLine($<span style="color: #800000;">"</span><span style="color: #800000;">x:{x},y:{y}</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">80</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">81</span>     }</span></pre>
</div>
<p><span style="font-size: 16px;">输出结果：</span></p>
<p><span style="font-size: 16px;"><img src="./images/浅谈.NET中的反射4.png" alt="" /></span></p>
<p><span style="font-size: 16px;">&nbsp;</span></p>
<p><span style="font-size: 16px;">上面例子可以看出，只显示了MyClass类显示定义的方法，private int Sum() 也不显示了&nbsp;</span></p>
<p><strong><span style="font-size: 16px;">六、使用反射调用方法</span></strong></p>
<p><span style="font-size: 16px;">上面我们通过反射获取到了类中的所有信息，下面我们就再使用反射调用反射获取到的方法。要调用反射获取到的方法，则需要在MethodInfo实例上调用Invoke()方法，Invoke()的使用，在下面例子中演示说明：</span></p>
<p><span style="font-size: 16px;">下面例子是先通过反射获取到要调用的方法，然后使用Invoke()方法，调用获取到的指定方法：</span></p>
<p><span style="font-size: 16px;">&nbsp;</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> Main()
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 5</span>             <span style="color: #008000;">//</span><span style="color: #008000;">获取描述MyClass类型的Type对象</span>
<span style="color: #008080;"> 6</span>             Type t = <span style="color: #0000ff;">typeof</span><span style="color: #000000;">(MyClass);
</span><span style="color: #008080;"> 7</span>             MyClass reflectObj = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MyClass();
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">            reflectObj.Show();
</span><span style="color: #008080;"> 9</span>             <span style="color: #008000;">//</span><span style="color: #008000;">不获取继承方法，为实例方法，&middot;为公用的</span>
<span style="color: #008080;">10</span>             MethodInfo[] mi = t.GetMethods(BindingFlags.DeclaredOnly | BindingFlags.Instance |<span style="color: #000000;"> BindingFlags.Public);
</span><span style="color: #008080;">11</span>             <span style="color: #0000ff;">foreach</span> (<span style="color: #0000ff;">var</span> methodInfo <span style="color: #0000ff;">in</span><span style="color: #000000;"> mi)
</span><span style="color: #008080;">12</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">获取方法阐述列表并保存在ParameterInfo对象组中</span>
<span style="color: #008080;">15</span>                 ParameterInfo[] pi =<span style="color: #000000;"> methodInfo.GetParameters();
</span><span style="color: #008080;">16</span>                 <span style="color: #0000ff;">if</span> (methodInfo.Name.Equals(<span style="color: #800000;">"</span><span style="color: #800000;">Set</span><span style="color: #800000;">"</span>, StringComparison.Ordinal) &amp;&amp; pi[<span style="color: #800080;">0</span>].ParameterType == <span style="color: #0000ff;">typeof</span>(<span style="color: #0000ff;">int</span><span style="color: #000000;">))
</span><span style="color: #008080;">17</span> <span style="color: #000000;">                {
</span><span style="color: #008080;">18</span>                     <span style="color: #0000ff;">object</span>[] args = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">object</span>[<span style="color: #800080;">2</span><span style="color: #000000;">];
</span><span style="color: #008080;">19</span>                     args[<span style="color: #800080;">0</span>] = <span style="color: #800080;">9</span><span style="color: #000000;">;
</span><span style="color: #008080;">20</span>                     args[<span style="color: #800080;">1</span>] = <span style="color: #800080;">10</span><span style="color: #000000;">;
</span><span style="color: #008080;">21</span> <span style="color: #000000;">                    methodInfo.Invoke(reflectObj,args);
</span><span style="color: #008080;">22</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">23</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">24</span> <span style="color: #000000;">            Console.ReadKey();
</span><span style="color: #008080;">25</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">26</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">27</span> 
<span style="color: #008080;">28</span>     <span style="color: #0000ff;">class</span><span style="color: #000000;"> MyClass
</span><span style="color: #008080;">29</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">30</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> x;
</span><span style="color: #008080;">31</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> y;
</span><span style="color: #008080;">32</span> 
<span style="color: #008080;">33</span>         <span style="color: #0000ff;">public</span><span style="color: #000000;"> MyClass()
</span><span style="color: #008080;">34</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">35</span>             x = <span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;">36</span>             y = <span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;">37</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">38</span> 
<span style="color: #008080;">39</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> Sum()
</span><span style="color: #008080;">40</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">41</span>             <span style="color: #0000ff;">return</span> x +<span style="color: #000000;"> y;
</span><span style="color: #008080;">42</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">43</span> 
<span style="color: #008080;">44</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">bool</span> IsBetween(<span style="color: #0000ff;">int</span><span style="color: #000000;"> i)
</span><span style="color: #008080;">45</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">46</span>             <span style="color: #0000ff;">if</span> (x &lt; i &amp;&amp; i &lt;<span style="color: #000000;"> y)
</span><span style="color: #008080;">47</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">48</span>                 <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">49</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">50</span> 
<span style="color: #008080;">51</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">52</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">53</span> 
<span style="color: #008080;">54</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> Set(<span style="color: #0000ff;">int</span> a, <span style="color: #0000ff;">int</span><span style="color: #000000;"> b)
</span><span style="color: #008080;">55</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">56</span>             x =<span style="color: #000000;"> a;
</span><span style="color: #008080;">57</span>             y =<span style="color: #000000;"> b;
</span><span style="color: #008080;">58</span> <span style="color: #000000;">            Show();
</span><span style="color: #008080;">59</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">60</span> 
<span style="color: #008080;">61</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> Set(<span style="color: #0000ff;">double</span> a, <span style="color: #0000ff;">double</span><span style="color: #000000;"> b)
</span><span style="color: #008080;">62</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">63</span>             x = (<span style="color: #0000ff;">int</span><span style="color: #000000;">)a;
</span><span style="color: #008080;">64</span>             y = (<span style="color: #0000ff;">int</span><span style="color: #000000;">)b;
</span><span style="color: #008080;">65</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">66</span> 
<span style="color: #008080;">67</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> Show()
</span><span style="color: #008080;">68</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">69</span>             System.Console.WriteLine($<span style="color: #800000;">"</span><span style="color: #800000;">x:{x},y:{y}</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">70</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">71</span>     }</span></pre>
</div>
<p><span style="font-size: 16px;">获取Type对象的构造函数</span></p>
<p><span style="font-size: 16px;">这个之前的阐述中，由于MyClass类型的对象都是显示创建的，因此使用反射技术调用MyClass类中的方法是没有任何优势的，还不如以普通方式调用方便简单呢，但是，如果对象是在运行时动态创建的，反射功能的优势就会显现出来。在这种情况下，要先获取一个构造函数列表，然后调用列表中的某个构造函数，创建一个该类型的实例，通过这种机制，可以在运行时实例化任意类型的对象，而不必在声明语句中指定类型。</span></p>
<p><span style="font-size: 16px;">示例代码如下：</span></p>
<p><span style="font-size: 16px;">&nbsp;</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> Main()
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 5</span>             <span style="color: #008000;">//</span><span style="color: #008000;">获取描述MyClass类型的Type对象</span>
<span style="color: #008080;"> 6</span>             Type t = <span style="color: #0000ff;">typeof</span><span style="color: #000000;">(MyClass);
</span><span style="color: #008080;"> 7</span>             <span style="color: #0000ff;">int</span><span style="color: #000000;"> val;
</span><span style="color: #008080;"> 8</span>             <span style="color: #008000;">//</span><span style="color: #008000;">使用这个方法获取构造函数列表</span>
<span style="color: #008080;"> 9</span>             ConstructorInfo[] ci =<span style="color: #000000;"> t.GetConstructors();
</span><span style="color: #008080;">10</span>             <span style="color: #0000ff;">int</span><span style="color: #000000;"> x;
</span><span style="color: #008080;">11</span>             <span style="color: #0000ff;">for</span> (x = <span style="color: #800080;">0</span>; x &lt; ci.Length; x++<span style="color: #000000;">)
</span><span style="color: #008080;">12</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">13</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">获取当构造参数列表</span>
<span style="color: #008080;">14</span>                 ParameterInfo[] pi =<span style="color: #000000;"> ci[x].GetParameters();
</span><span style="color: #008080;">15</span>                 <span style="color: #0000ff;">if</span> (pi.Length == <span style="color: #800080;">2</span><span style="color: #000000;">)
</span><span style="color: #008080;">16</span> <span style="color: #000000;">                {
</span><span style="color: #008080;">17</span>                     <span style="color: #008000;">//</span><span style="color: #008000;">如果当前构造函数有2个参数，则跳出循环</span>
<span style="color: #008080;">18</span>                     <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">19</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">20</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">21</span> 
<span style="color: #008080;">22</span>             <span style="color: #0000ff;">if</span> (x ==<span style="color: #000000;"> ci.Length)
</span><span style="color: #008080;">23</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">24</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">25</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">26</span>             <span style="color: #0000ff;">object</span>[] consArgs = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">object</span>[<span style="color: #800080;">2</span><span style="color: #000000;">];
</span><span style="color: #008080;">27</span>             consArgs[<span style="color: #800080;">0</span>] = <span style="color: #800080;">10</span><span style="color: #000000;">;
</span><span style="color: #008080;">28</span>             consArgs[<span style="color: #800080;">1</span>] = <span style="color: #800080;">20</span><span style="color: #000000;">;
</span><span style="color: #008080;">29</span>             <span style="color: #008000;">//</span><span style="color: #008000;">实例化一个这个构造函数有连个参数的类型对象，如果参数为空，则为null</span>
<span style="color: #008080;">30</span> 
<span style="color: #008080;">31</span>             <span style="color: #0000ff;">object</span> reflectOb =<span style="color: #000000;"> ci[x].Invoke(consArgs);
</span><span style="color: #008080;">32</span> 
<span style="color: #008080;">33</span>             MethodInfo[] mi = t.GetMethods(BindingFlags.DeclaredOnly | BindingFlags.Instance |<span style="color: #000000;"> BindingFlags.Public);
</span><span style="color: #008080;">34</span>             <span style="color: #0000ff;">foreach</span> (<span style="color: #0000ff;">var</span> methodInfo <span style="color: #0000ff;">in</span><span style="color: #000000;"> mi)
</span><span style="color: #008080;">35</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">36</span>                 <span style="color: #0000ff;">if</span> (methodInfo.Name.Equals(<span style="color: #800000;">"</span><span style="color: #800000;">Sum</span><span style="color: #800000;">"</span><span style="color: #000000;">, StringComparison.Ordinal))
</span><span style="color: #008080;">37</span> <span style="color: #000000;">                {
</span><span style="color: #008080;">38</span>                     val = (<span style="color: #0000ff;">int</span>)methodInfo.Invoke(reflectOb, <span style="color: #0000ff;">null</span><span style="color: #000000;">);
</span><span style="color: #008080;">39</span>                     Console.WriteLine($<span style="color: #800000;">"</span><span style="color: #800000;">Sum is {val}</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">40</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">41</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">42</span> <span style="color: #000000;">            Console.ReadKey();
</span><span style="color: #008080;">43</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">44</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">45</span> 
<span style="color: #008080;">46</span>     <span style="color: #0000ff;">class</span><span style="color: #000000;"> MyClass
</span><span style="color: #008080;">47</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">48</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> x;
</span><span style="color: #008080;">49</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> y;
</span><span style="color: #008080;">50</span> 
<span style="color: #008080;">51</span>         <span style="color: #0000ff;">public</span> MyClass(<span style="color: #0000ff;">int</span><span style="color: #000000;"> i)
</span><span style="color: #008080;">52</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">53</span>             x = y +<span style="color: #000000;"> i;
</span><span style="color: #008080;">54</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">55</span> 
<span style="color: #008080;">56</span>         <span style="color: #0000ff;">public</span> MyClass(<span style="color: #0000ff;">int</span> i, <span style="color: #0000ff;">int</span><span style="color: #000000;"> j)
</span><span style="color: #008080;">57</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">58</span>             x =<span style="color: #000000;"> i;
</span><span style="color: #008080;">59</span>             y =<span style="color: #000000;"> j;
</span><span style="color: #008080;">60</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">61</span> 
<span style="color: #008080;">62</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> Sum()
</span><span style="color: #008080;">63</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">64</span>             <span style="color: #0000ff;">return</span> x +<span style="color: #000000;"> y;
</span><span style="color: #008080;">65</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">66</span>     }</span></pre>
</div>
<p><span style="font-size: 16px;">输出结果：</span></p>
<p><span style="font-size: 16px;"><img src="./images/浅谈.NET中的反射5.png" alt="" /></span></p>
<p><span style="font-size: 16px;">&nbsp;</span></p>
<p><strong><span style="font-size: 16px;">&nbsp;七、从程序集获得类型</span></strong></p>
<p><span style="font-size: 16px;">在这之前的阐述中可以看出一个类型的所有信息都能够通过反射得到，但是MyClass类型本身，我们却没有做到获取，虽然前面的阐述实例，可以动态确定MyClass类的信息，但是他们都是基于以下事实：预先知道类型名称，并且在typeof与剧中使用它获得Type对象。尽管这种方式可能在很多情况下都管用，但是要发挥反射的全部功能，我们还需要分析反射程序集的内容来动态确定程序的可用类型。</span></p>
<p><span style="font-size: 16px;">借助Reflection API，可以加载程序集，获取它的相关信息并创建其公共可用类型的实例，通过这种机制，程序能够搜索其环境，利用潜在的功能，而无需再编译期间显示的定义他们，这是一个非常有效且令人兴奋的概念。为了说明如何获取程序集中的类型，我创建了两个文件，第一个文件定义一组类，第二个文件则反射各个类型的信息。代码效果如下：</span></p>
<p><strong><span style="font-size: 16px;">1、这下面代码编译生成MyTest2_C.exe文件</span></strong></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 5</span>             Console.WriteLine(<span style="color: #800000;">"</span><span style="color: #800000;">Hello word !</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">            Console.ReadKey();
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span>     <span style="color: #0000ff;">class</span><span style="color: #000000;"> MyClass
</span><span style="color: #008080;">11</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">12</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> x;
</span><span style="color: #008080;">13</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> y;
</span><span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span>         <span style="color: #0000ff;">public</span> MyClass(<span style="color: #0000ff;">int</span><span style="color: #000000;"> i)
</span><span style="color: #008080;">16</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">17</span>             x = y +<span style="color: #000000;"> i;
</span><span style="color: #008080;">18</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">19</span> 
<span style="color: #008080;">20</span>         <span style="color: #0000ff;">public</span> MyClass(<span style="color: #0000ff;">int</span> i, <span style="color: #0000ff;">int</span><span style="color: #000000;"> j)
</span><span style="color: #008080;">21</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">22</span>             x =<span style="color: #000000;"> i;
</span><span style="color: #008080;">23</span>             y =<span style="color: #000000;"> j;
</span><span style="color: #008080;">24</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">25</span> 
<span style="color: #008080;">26</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> Sum()
</span><span style="color: #008080;">27</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">28</span>             <span style="color: #0000ff;">return</span> x +<span style="color: #000000;"> y;
</span><span style="color: #008080;">29</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">30</span>     }</span></pre>
</div>
<p><strong><span style="font-size: 16px;">2、这下面的代码时获取上面生成程序集的</span></strong></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> Main()
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 5</span>             <span style="color: #008000;">//</span><span style="color: #008000;">加载指定的程序集</span>
<span style="color: #008080;"> 6</span>             Assembly asm = Assembly.LoadFrom(<span style="color: #800000;">@"</span><span style="color: #800000;">E:\自己的\MyTest\MyTest2_C\bin\Debug\MyTest2_C.exe</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 7</span>             <span style="color: #008000;">//</span><span style="color: #008000;">获取程序集中的所有类型列表</span>
<span style="color: #008080;"> 8</span>             Type[] allType =<span style="color: #000000;"> asm.GetTypes();
</span><span style="color: #008080;"> 9</span>             <span style="color: #0000ff;">foreach</span> (<span style="color: #0000ff;">var</span> type <span style="color: #0000ff;">in</span><span style="color: #000000;"> allType)
</span><span style="color: #008080;">10</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">11</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">打印出类型名称</span>
<span style="color: #008080;">12</span> <span style="color: #000000;">                Console.WriteLine(type.Name);
</span><span style="color: #008080;">13</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span> <span style="color: #000000;">            Console.ReadKey();
</span><span style="color: #008080;">16</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">17</span>     }</span></pre>
</div>
<p><span style="font-size: 16px;">输出结果：</span></p>
<p><span style="font-size: 16px;"><img src="./images/浅谈.NET中的反射6.png" alt="" /></span></p>
<p><span style="font-size: 16px;">&nbsp;</span></p>
<p><span style="font-size: 16px;">&nbsp;上面获取到了程序集中的类型，如果像操作程序集类型中的方法，则跟前面我们表述的方法一样操作即可。</span></p>
<p><span style="font-size: 16px;">好了，.Net反射我们就介绍到这里啦~</span></p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>