<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修winfrom 集成krpano  项目 添加折线' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>winfrom 集成krpano  项目 添加折线</center></div><div class='banquan'>原文出处:本文由博客园博主hucoke提供。<br/>
原文连接:https://www.cnblogs.com/hucoke/p/11322450.html</div><br>
    <p>&nbsp; C#.NET WinFrom开发之嵌入Google浏览器 （CefSharp）&nbsp;</p>
<p>&nbsp;</p>
<p><img src="./images/winfrom 集成krpano  项目 添加折线0.png" alt="" /></p>
<p>&nbsp;</p>
<p><img src="./images/winfrom 集成krpano  项目 添加折线1.png" alt="" /></p>
<p>&nbsp;</p>
<p>引入静态页面</p>
<p>&nbsp;CefWebBrowser = new ChromiumWebBrowser("http://" + Register.Host + ":" + Register.Port + "/Template/html/index.html");//浏览网址</p>
<p>效果图</p>
<p><img src="./images/winfrom 集成krpano  项目 添加折线2.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;全景绘制折线</p>
<p><img src="./images/winfrom 集成krpano  项目 添加折线3.png" alt="" /></p>
<p> var pointname = "";<br />            $("#" + pano).unbind("mousedown").bind("mousedown", function (event) {<br />                var parameter = XyYyKrp.Line.getHV();<br />                if (xmlData.Linename == "") {<br />                    xmlData.Linename = krpano.get("xml.scene") + "_" + XyYyKrp.Line.Hotspot_Code();<br />                    krpano.call("do_add_polyline('" + xmlData.Linename + "','dbxzxhotspot','折线'," + parameter.at_h + "," + parameter.at_v + ");");<br />                    pointname = krpano.get("hotspot[" + xmlData.Linename + "].point[0].name");</p>
<p>                    $("#" + pano).unbind("mousemove").bind("mousemove", function (e) {<br />                        parameter = XyYyKrp.Line.getHV();<br />                        krpano.call("do_removepoint('" + xmlData.Linename + "','" + pointname + "');");<br />                        krpano.call("do_add_polylinepoint('" + xmlData.Linename + "'," + parameter.at_h + "," + parameter.at_v + ");");<br />                        e.stopPropagation();<br />                    });</p>
<p>                } else {<br />                    krpano.call("do_add_polylinepoint('" + xmlData.Linename + "'," + parameter.at_h + "," + parameter.at_v + ");");<br />                    var tem = krpano.get("hotspot[" + xmlData.Linename + "].point.count");<br />                    pointname = krpano.get("hotspot[" + xmlData.Linename + "].point[" + (tem-1) + "].name");<br />                }</p>
<p><br />                event.stopPropagation();<br />            });</p>
<p>&nbsp;</p>
<p>&lt;krpano&gt;</p>
<p><br />  &lt;!--添加热点--&gt;<br />  &lt;action name="do_add_polyline" &gt;<br />    set(schp_name,%1);<br />    addhotspot(get(schp_name));<br />    hotspot[get(schp_name)].loadstyle(%2);<br />    set(hotspot[get(schp_name)].hotspottitle,%3);<br />    set(hotspot[get(schp_name)].alpha,"0.5");<br />    set(hotspot[get(schp_name)].autoalpha,"false");<br />    &lt;!--set(hotspot[get(schp_name)].fillcolor,"0xFFB6C1");--&gt;<br />    &lt;!--set(hotspot[get(schp_name)].fillcolorhover,"0xDC143C");--&gt;<br />    &lt;!--set(hotspot[get(schp_name)].fillalpha,"1");--&gt;<br />    set(hotspot[get(schp_name)].visible,"true");<br />    set(hotspot[get(schp_name)].hotspotstype,'polyline');<br />    set(hotspot[get(schp_name)].fillalphahover,"0.1");<br />    set(hotspot[get(schp_name)].borderwidth,"5");<br />    set(hotspot[get(schp_name)].borderwidthhover,"4.0");<br />    set(hotspot[get(schp_name)].bordercolor,"0x008000");<br />    set(hotspot[get(schp_name)].bdcolor,"0x008000");<br />    set(hotspot[get(schp_name)].bordercolorhover,"0x223322");<br />    set(hotspot[get(schp_name)].borderalpha,"0.5");<br />    set(hotspot[get(schp_name)].polyline,"true");<br />    set(hotspot[get(schp_name)].borderalphahover,"0.8");<br />    set(hotspot[get(schp_name)].point[0].ath,%4);<br />    set(hotspot[get(schp_name)].point[0].atv,%5);<br />    set(hotspot[get(schp_name)].onclick,"do_onclick_polyline();");<br />    set(hotspot[get(schp_name)].remark,"");<br />    hotspot[get(schp_name).updatepos();<br />  &lt;/action&gt;</p>
<p>  &lt;!--添加点位坐标--&gt;<br />  &lt;action name="do_add_polylinepoint" &gt;<br />    set(index,get(hotspot[%1].point.count));<br />    &lt;!--js(homeClass.saveSceneblend(get(index),'000'));--&gt;<br />    set(hotspot[%1].point[get(index)].ath,%2);<br />    set(hotspot[%1].point[get(index)].atv,%3);<br />    hotspot[%1].updatepos();<br />  &lt;/action&gt;</p>
<p>  &lt;!--移出点--&gt;<br />  &lt;action name="do_removepoint"&gt;<br />    if(%1!='' AND hotspot[%1].point !=null,<br />    set(count,calc(hotspot[%1].point.count-1));</p>
<p>    if(hotspot[%1].point[get(count)].name !=%2,<br />       hotspot[%1].point.removearrayitem(get(count));<br />    &lt;!--js(homeClass.saveSceneblend(get(hotspot[%1].point[get(count)].name),'000'));--&gt;<br />    );</p>
<p>    hotspot[%1].updatepos();<br />    &lt;!--hotspot[%1].point.removearrayitem(get(count));<br />    if(count LE 0,removehotspot(%1););<br />    hotspot[%1].updatepos();--&gt;<br />    );<br />  &lt;/action&gt;<br />  <br />  </p>
<p>  &lt;!--选中多线--&gt;<br />  &lt;action name="do_onclick_polyline"&gt;<br />    jsget(modify,"xmlData.modify");<br />    &lt;!--js(homeClass.saveSceneblend(get(modify),'000'));--&gt;<br />    if(modify=='normal',<br />    for(set(i,0), i LT hotspot.count, inc(i),<br />    if(hotspot[get(i)].visible==true AND hotspot[get(i)].hotspotstype=='polyline',<br />    set(hotspot[get(i)].bordercolor,get(hotspot[get(i)].bdcolor)); );<br />    );<br />    js(XyYyKrp.Line.Xml_clickselected(get(name)));<br />    set(hotspot[get(name)].bordercolor,"0x9370DB");<br />    );<br />  &lt;/action&gt;</p>
<p><br />  &lt;layer name="polyline_container" keep="true" type="container" width="400" height.normal="410" height.mobile="180" align="center"  bgcolor="0xFFFFFF"<br />     bgalpha="0.9" bgborder="get:skin_settings.design_bgborder" bgroundedge="get:skin_settings.design_bgroundedge"<br />     bgshadow="get:skin_settings.design_bgshadow" bgcapture="true" x="0" y="0"  ondown="draglayer();"  css="background: #fff;" visible="false"&gt;<br />    &lt;layer name="polyline_title" style="h3" html="折线编辑" align="lefttop" x="0" y="0" width="100%" background="false" enabled="false"   /&gt;<br />    &lt;layer name="polyline_container_close" style="btn_close"  align="lefttop" x="360" y="15" width="16" height="16" background="false" enabled="true" alpha="0.75"<br />        onhover="tween(alpha,1.0);"  onout="tween(alpha,0.75);" onclick="do_cancel('polyline_container','XyYyKrp.Line.Xml_Cancel','false');"  /&gt;</p>
<p>    &lt;layer name="polyline_scroller_container" type="container" align="lefttop" y="40" width="100%" height="-80" bgborder="1 0x00ACED 0.8" &gt;<br />      &lt;!--&lt;layer name="textlink_logo_scroller" style="scrollarea" direction="v" width="100%" height="100" align="top" y="0"  zorder="1"  onloaded="setcenter(0,0);"/&gt;--&gt;</p>
<p>      &lt;layer name="edit_polyline_name" style="wordstext" html="名称" align="lefttop" y="11" x="25" background="false" enabled="false" zorder="0"  /&gt;<br />      &lt;layer name="edit_polyline_name_val" style="texttitle"  align="lefttop" y="8" x="65" background="false"  onloaded="delayedcall(0,add_textbox('', 230, 30,'edit_polyline_name_val','polyline_name'));" value="" zorder="0" /&gt;<br />      &lt;plugin name="LineSwitchButton" devices="html5" keep="true"  url="%SWFPATH%/plugins/switchbutton.js" x="300" y="10"  width="43" height="23" value="true" onloaded="copy(lineswitchbutton, plugin[LineSwitchButton]);" zorder="0" /&gt;</p>
<p>      &lt;layer name="edit_polyline_width"  style="wordstext" html="线宽"   align="lefttop" x="25" y="50" background="false" enabled="false" zorder="0" /&gt;<br />      &lt;!--&lt;plugin name="SliderLineWidth" devices="html5" keep="true"  url="%SWFPATH%/plugins/slider.js" align="lefttop" x="65" y="45" onloaded="copy(sliderlinewidth, plugin[SliderLineWidth]);" zorder="0" /&gt;--&gt;<br />      &lt;layer  name="polyline_lwidth" style="texttitle" align="lefttop"  x="65"  y="50" onloaded="delayedcall(0,add_textbox('', 150, 30,'polyline_lwidth','polylinelwidth'));" value="" /&gt;<br />      <br />      &lt;layer name="edit_polyline_lincolor"  style="wordstext" html="线颜色"   align="lefttop" x="240" y="50" background="false" enabled="false" zorder="0" /&gt;<br />      <br />      &lt;layer name="edit_polyline_linclview"  type="container" align="lefttop" width="30" height="25" bgalpha="1.0" x="305"   y="50" background="true"  bgcolor="0x008000"  enabled="true"   value="0x008000" zorder="3" &gt;<br />        &lt;layer name="edit_polyline_lincliamge" type="iamge" parent="edit_polyline_linclview" url="%SWFPATH%/plugins/tool/current_color.png" align="lefttop" width="30" height="25" onclick="do_linecliamge();" &gt;&lt;/layer&gt;<br />      &lt;/layer&gt;</p>
<p>      &lt;layer name="edit_polyline_lin_cy"  style="wordstext" html="线透明度"   align="lefttop" x="2" y="90" background="false" enabled="false" zorder="0" /&gt;<br />      &lt;!--&lt;plugin name="PLSliderLinecy" devices="html5" keep="true"  url="%SWFPATH%/plugins/slider.js"  onloaded="copy(plsliderlinecy, plugin[PLSliderLinecy]);" zorder="0" /&gt;--&gt;<br />      <br />      &lt;layer  name="polyline_lcy" style="texttitle" align="lefttop"  x="65"  y="90" onloaded="delayedcall(0,add_textbox('', 150, 30,'polyline_lcy','polylinelcy'));" value="" /&gt;<br />      <br />      &lt;layer name="edit_polyline_remark" style="wordstext" html="备注" align="lefttop" y="135" x="25" background="false" enabled="false"  zorder="0" /&gt;<br />      &lt;layer name="edit_polyline_remark_val" style="texttitle"  align="lefttop" y="135" x="65" background="false"  onloaded="delayedcall(0,add_textarea('', 280, 150,'edit_polyline_remark_val','polyline_remark'));" value=""  zorder="0" /&gt;<br />      <br />      <br />    &lt;/layer&gt;<br />    &lt;layer name="polyline_apply" parent="polyline_container" style="label-primary"  html="应 用" align="lefttop"  x="105" y="372" onclick="do_polyline_apply('false');" /&gt;<br />    &lt;layer name="polyline_ok" parent="polyline_container" style="label-success"  html="确 定" align="lefttop"  x="170" y="372" onclick="do_polyline_ok();" /&gt;<br />    &lt;layer name="polyline_cancel" parent="polyline_container" style="label-info"  html="取 消" align="lefttop"  x="235" y="372" enabled="true"  onclick="do_cancel('polyline_container','XyYyKrp.Line.Xml_Cancel','false');" /&gt;<br />  &lt;/layer&gt;</p>
<p><br />  &lt;action name="do_loadpolylineslider" &gt;<br />    &lt;!--sliderlinewidth.initial_plugin('polylinewidth',150,'polyline_scroller_container',65,45);<br />    plsliderlinecy.initial_plugin('plsliderlinecy',150,'polyline_scroller_container',65,75);--&gt;<br />  &lt;/action&gt;</p>
<p><br />&lt;!--确定--&gt;<br />  &lt;action name="do_polyline_ok" &gt;<br />    do_polyline_apply('true');<br />  &lt;/action&gt;</p>
<p><br />  &lt;!--线填充颜色--&gt;<br />  &lt;action name="do_linecliamge"&gt;<br />    copy(cl,layer[edit_polyline_linclview].value);<br />    colorpick_initial('edit_polyline_linclview',10,10,'edit_polyline_linclview',get(cl));<br />  &lt;/action&gt;</p>
<p>  &lt;!--开启编辑--&gt;<br />  &lt;action name="do_edit_polyline"&gt;<br />    if(%1!='' AND hotspot[%1] !=null,</p>
<p><br />    set(layer[polyline_container].visible,"true");<br />    set(layer[polyline_container].keep,"true");</p>
<p>    set(layer[polyline_container].value,%1);<br />    copy(hst,hotspot[%1]);<br />    set(layer[edit_polyline_name_val].value,get(hst.hotspottitle));<br />    jscall(calc('document.getElementById("polyline_name").value="'+hst.hotspottitle+'"'));</p>
<p>    &lt;!--slider_setvalue(polylinewidth,get(hst.borderwidth));--&gt;</p>
<p>    jscall(calc('document.getElementById("polylinelwidth").value="'+hst.borderwidth+'"'));</p>
<p>    set(layer[edit_polyline_linclview].bgcolor,get(hst.bdcolor));<br />    set(color,get(hst.bdcolor));<br />    tohex(color,'0x',6);<br />    set(layer[edit_polyline_linclview].value, get(color));</p>
<p>    jscall(calc('document.getElementById("polylinelcy").value="'+hst.borderalpha+'"'));<br />    set(layer[edit_polyline_remark_val].value,get(hst.remark));<br />    jscall(calc('document.getElementById("polyline_remark").value="'+hst.remark+'"'));<br />    &lt;!--js(homeClass.saveSceneblend(get(layer[edit_polygon_ly].value),'000'));--&gt;<br />    );<br />  &lt;/action&gt;</p>
<p>&nbsp;</p>
<p>  &lt;!--应用--&gt;<br />  &lt;action name="do_polyline_apply"&gt;<br />    copy(ply,layer[polyline_container].value);<br />    if(get(ply)!=null  AND get(ply)!='',<br />    copy(hst,hotspot[get(ply)]);<br />    &lt;!--set(hst.hotspottitle,get(layer[edit_polyline_name_val].value));--&gt;</p>
<p>    jsget(plname,"document.getElementById('polyline_name').value");<br />    set(hst.hotspottitle,get(plname));</p>
<p>    &lt;!--slider_getvalue(polylinewidth,vl);--&gt;<br />    jsget(vl,"document.getElementById('polylinelwidth').value");<br />    set(hst.borderwidth,get(vl));<br />    set(hst.bdcolor, get(layer[edit_polyline_linclview].value));<br />    set(hst.bordercolor, get(layer[edit_polyline_linclview].value));</p>
<p>    jsget(dst,"document.getElementById('polylinelcy').value");<br />    set(hst.borderalpha,get(dst));<br />    set(hst.remark,get(layer[edit_polyline_remark_val].value));<br />    );</p>
<p><br />    if(%1=='true',<br />    set(hst.bordercolor,get(hst.bdcolor));<br />    set(layer[polyline_container].visible,"false");<br />    js(XyYyKrp.Line.Xml_PolylineSave(get(ply)));<br />    );</p>
<p><br />    &lt;!--set(hst.bdcolor,get(layer[edit_polygon_linclview].value));--&gt;</p>
<p>  &lt;/action&gt;</p>
<p><br />  &lt;!--删除多边形--&gt;<br />  &lt;action name="do_delete_polyline"&gt;<br />    if(%1!='' AND hotspot[%1] !=null,<br />    removehotspot(%1);<br />    );<br />  &lt;/action&gt;<br />  <br />&lt;/krpano&gt;</p>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>