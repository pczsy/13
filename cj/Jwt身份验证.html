<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Jwt身份验证' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Jwt身份验证</center></div><div class='banquan'>原文出处:本文由博客园博主terryK提供。<br/>
原文连接:https://www.cnblogs.com/terryK/p/11692294.html</div><br>
    <p><em><strong>转载自博友（TerryTon）</strong></em></p>
<p><em><span style="color: #000000; font-family: Verdana, sans-serif;">&nbsp;1</span><span style="color: #000000; font-family: 宋体, sans-serif;">、因为</span><span style="color: #000000; font-family: Verdana, sans-serif;">json</span><span style="color: #000000; font-family: 宋体, sans-serif;">是通用的，所以</span><span style="color: #000000; font-family: Verdana, sans-serif;">jwt</span><span style="color: #000000; font-family: 宋体, sans-serif;">可以在绝大部分平台可以通用，如</span><span style="color: #000000; font-family: Verdana, sans-serif;">java</span><span style="color: #000000; font-family: 宋体, sans-serif;">，</span><span style="color: #000000; font-family: Verdana, sans-serif;">python</span><span style="color: #000000; font-family: 宋体, sans-serif;">，</span><span style="color: #000000; font-family: Verdana, sans-serif;">php</span><span style="color: #000000; font-family: 宋体, sans-serif;">，</span><span style="color: #000000; font-family: Verdana, sans-serif;">.net</span><span style="color: #000000; font-family: 宋体, sans-serif;">等</span></em></p>
<p><em><span style="color: #000000; font-family: Verdana, sans-serif;">&nbsp;2</span><span style="color: #000000; font-family: 宋体, sans-serif;">、基于</span><span style="color: #000000; font-family: Verdana, sans-serif;">jwt</span><span style="color: #000000; font-family: 宋体, sans-serif;">是无状态的，</span><span style="color: #000000; font-family: Verdana, sans-serif;">jwt</span><span style="color: #000000; font-family: 宋体, sans-serif;">可以用于分布式等现在比较流行的一些框架中。</span></em></p>
<p><em><span style="color: #000000; font-family: Verdana, sans-serif;">&nbsp;3</span><span style="color: #000000; font-family: 宋体, sans-serif;">、</span><span style="color: #000000; font-family: Verdana, sans-serif;">jwt</span><span style="color: #000000; font-family: 宋体, sans-serif;">本身不是加密的，所以安全性不是很高，别人知道了你的</span><span style="color: #000000; font-family: Verdana, sans-serif;">token</span><span style="color: #000000; font-family: 宋体, sans-serif;">就可以解析了，</span></em></p>
<p><em><span style="color: #000000; font-family: 宋体, sans-serif;">　　当然你自己也可以对</span><span style="color: #000000; font-family: Verdana, sans-serif;">jwt</span><span style="color: #000000; font-family: 宋体, sans-serif;">进行加密，设置的过期时间不宜过长，同时不要保存一些重要的信息，如密码。</span></em></p>
<p><em><span style="color: #000000; font-family: Verdana, sans-serif;">&nbsp;4</span><span style="color: #000000; font-family: 宋体, sans-serif;">、尽量使用</span><span style="color: #000000; font-family: Verdana, sans-serif;">https</span><span style="color: #000000; font-family: 宋体, sans-serif;">，</span><span style="color: #000000; font-family: 宋体, sans-serif;">这也是为了安全。</span></em></p>
<p><em><span style="color: #000000; font-family: Verdana, sans-serif;">&nbsp;5</span><span style="color: #000000; font-family: 宋体, sans-serif;">、</span><span style="color: #000000; font-family: Verdana, sans-serif;">JWT</span><span style="color: #000000; font-family: 宋体, sans-serif;">字节占用很少，非常的轻便，所以便于传输。</span></em></p>
<p><em><span style="color: #000000; font-family: Verdana, sans-serif;">&nbsp;6</span><span style="color: #000000; font-family: 宋体, sans-serif;">、</span><span style="color: #000000; font-family: Verdana, sans-serif;">JWT</span><span style="color: #000000; font-family: 宋体, sans-serif;">一般放在</span><span style="color: #000000; font-family: Verdana, sans-serif;">http</span><span style="color: #000000; font-family: 宋体, sans-serif;">的头部</span><span style="color: #000000; font-family: Verdana, sans-serif;">Header</span><span style="color: #000000; font-family: 宋体, sans-serif;">中传输。</span></em></p>
<p><strong><em><span style="color: #000000; font-family: 宋体, sans-serif;">直接附上Demo,创建控制台应用程序，添加NuGet包JWT Newtonsoft.Json</span></em></strong></p>
<p><em><span style="color: #000000; font-family: 宋体, sans-serif;"><img src="./images/Jwt身份验证0.png" alt="" /></span></em></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>&nbsp;JWTDemo</strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">using</span><span style="color: #000000;"> JWT;
</span><span style="color: #0000ff;">using</span><span style="color: #000000;"> JWT.Algorithms;
</span><span style="color: #0000ff;">using</span><span style="color: #000000;"> JWT.Serializers;
</span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System;
</span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Collections.Generic;
</span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Linq;
</span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Text;
</span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Threading.Tasks;

</span><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> JWTDemo
{
    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Program
    {
        </span><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)
        {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">载荷（payload）</span>
            <span style="color: #0000ff;">var</span> payload = <span style="color: #0000ff;">new</span> Dictionary&lt;<span style="color: #0000ff;">string</span>, <span style="color: #0000ff;">object</span>&gt;<span style="color: #000000;">{
                { </span><span style="color: #800000;">"</span><span style="color: #800000;">iss</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">terryK</span><span style="color: #800000;">"</span>},<span style="color: #008000;">//</span><span style="color: #008000;">发行人</span>
                { <span style="color: #800000;">"</span><span style="color: #800000;">exp</span><span style="color: #800000;">"</span>, DateTimeOffset.UtcNow.AddSeconds(<span style="color: #800080;">120</span>).ToUnixTimeSeconds() },<span style="color: #008000;">//</span><span style="color: #008000;">到期时间</span>
                { <span style="color: #800000;">"</span><span style="color: #800000;">sub</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">testJWT</span><span style="color: #800000;">"</span> }, <span style="color: #008000;">//</span><span style="color: #008000;">主题</span>
                { <span style="color: #800000;">"</span><span style="color: #800000;">aud</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">USER</span><span style="color: #800000;">"</span> }, <span style="color: #008000;">//</span><span style="color: #008000;">用户</span>
                { <span style="color: #800000;">"</span><span style="color: #800000;">iat</span><span style="color: #800000;">"</span>, DateTime.Now.ToString() }, <span style="color: #008000;">//</span><span style="color: #008000;">发布时间 </span>
                { <span style="color: #800000;">"</span><span style="color: #800000;">data</span><span style="color: #800000;">"</span> ,<span style="color: #0000ff;">new</span> { name=<span style="color: #800000;">"</span><span style="color: #800000;">Admini</span><span style="color: #800000;">"</span>,age=<span style="color: #800080;">20</span>,address=<span style="color: #800000;">"</span><span style="color: #800000;">GuangDong</span><span style="color: #800000;">"</span><span style="color: #000000;">} }
            };

            </span><span style="color: #008000;">//</span><span style="color: #008000;">生成JWT</span>
            Console.WriteLine(<span style="color: #800000;">"</span><span style="color: #800000;">******************生成JWT*******************</span><span style="color: #800000;">"</span><span style="color: #000000;">);
            </span><span style="color: #0000ff;">string</span> JWTString =<span style="color: #000000;"> JwtHelper.CreateJWT(payload);
            Console.WriteLine(JWTString);

            </span><span style="color: #008000;">//</span><span style="color: #008000;">校验JWT</span>
            Console.WriteLine(<span style="color: #800000;">"</span><span style="color: #800000;">*******************校验JWT，获得载荷***************</span><span style="color: #800000;">"</span><span style="color: #000000;">);
            </span><span style="color: #0000ff;">string</span> ResultMessage;<span style="color: #008000;">//</span><span style="color: #008000;">需要解析的消息</span>
            <span style="color: #0000ff;">string</span> Payload;<span style="color: #008000;">//</span><span style="color: #008000;">获取负载</span>
            <span style="color: #0000ff;">if</span> (JwtHelper.ValidateJWT(JWTString, <span style="color: #0000ff;">out</span> Payload, <span style="color: #0000ff;">out</span><span style="color: #000000;"> ResultMessage))
            {
                Console.WriteLine(Payload);
            }

            Console.WriteLine(ResultMessage);</span><span style="color: #008000;">//</span><span style="color: #008000;">验证结果说明</span>
            Console.WriteLine(<span style="color: #800000;">"</span><span style="color: #800000;">*******************END*************************</span><span style="color: #800000;">"</span><span style="color: #000000;">);
            Console.ReadKey();
        }
    }

    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> JwtHelper
    {
        </span><span style="color: #0000ff;">static</span> IJwtAlgorithm algorithm = <span style="color: #0000ff;">new</span> HMACSHA256Algorithm();<span style="color: #008000;">//</span><span style="color: #008000;">HMACSHA256加密</span>
        <span style="color: #0000ff;">static</span> IJsonSerializer serializer = <span style="color: #0000ff;">new</span> JsonNetSerializer();<span style="color: #008000;">//</span><span style="color: #008000;">序列化和反序列</span>
        <span style="color: #0000ff;">static</span> IBase64UrlEncoder urlEncoder = <span style="color: #0000ff;">new</span> JwtBase64UrlEncoder();<span style="color: #008000;">//</span><span style="color: #008000;">Base64编解码</span>
        <span style="color: #0000ff;">static</span> IDateTimeProvider provider = <span style="color: #0000ff;">new</span> UtcDateTimeProvider();<span style="color: #008000;">//</span><span style="color: #008000;">UTC时间获取</span>
        <span style="color: #0000ff;">const</span> <span style="color: #0000ff;">string</span> secret = <span style="color: #800000;">"</span><span style="color: #800000;">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC4aKpVo2OHXPwb1R7duLgg</span><span style="color: #800000;">"</span>;<span style="color: #008000;">//</span><span style="color: #008000;">服务端</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">string</span> CreateJWT(Dictionary&lt;<span style="color: #0000ff;">string</span>, <span style="color: #0000ff;">object</span>&gt;<span style="color: #000000;"> payload)
        {
            IJwtEncoder encoder </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> JwtEncoder(algorithm, serializer, urlEncoder);
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> encoder.Encode(payload, secret);
        }

        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">bool</span> ValidateJWT(<span style="color: #0000ff;">string</span> token, <span style="color: #0000ff;">out</span> <span style="color: #0000ff;">string</span> payload, <span style="color: #0000ff;">out</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> message)
        {
            </span><span style="color: #0000ff;">bool</span> isValidted = <span style="color: #0000ff;">false</span><span style="color: #000000;">;
            payload </span>= <span style="color: #800000;">""</span><span style="color: #000000;">;
            </span><span style="color: #0000ff;">try</span><span style="color: #000000;">
            {
                IJwtValidator validator </span>= <span style="color: #0000ff;">new</span> JwtValidator(serializer, provider);<span style="color: #008000;">//</span><span style="color: #008000;">用于验证JWT的类</span>
<span style="color: #000000;">
                IJwtDecoder decoder </span>= <span style="color: #0000ff;">new</span> JwtDecoder(serializer, validator, urlEncoder);<span style="color: #008000;">//</span><span style="color: #008000;">用于解析JWT的类</span>
                payload = decoder.Decode(token, secret, verify: <span style="color: #0000ff;">true</span><span style="color: #000000;">);

                isValidted </span>= <span style="color: #0000ff;">true</span><span style="color: #000000;">;
                message </span>= <span style="color: #800000;">"</span><span style="color: #800000;">验证成功</span><span style="color: #800000;">"</span><span style="color: #000000;">;
            }
            </span><span style="color: #0000ff;">catch</span> (TokenExpiredException)<span style="color: #008000;">//</span><span style="color: #008000;">当前时间大于负载过期时间（负荷中的exp），会引发Token过期异常</span>
<span style="color: #000000;">            {
                message </span>= <span style="color: #800000;">"</span><span style="color: #800000;">过期了！</span><span style="color: #800000;">"</span><span style="color: #000000;">;
            }
            </span><span style="color: #0000ff;">catch</span> (SignatureVerificationException)<span style="color: #008000;">//</span><span style="color: #008000;">如果签名不匹配，引发签名验证异常</span>
<span style="color: #000000;">            {
                message </span>= <span style="color: #800000;">"</span><span style="color: #800000;">签名错误！</span><span style="color: #800000;">"</span><span style="color: #000000;">;
            }
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> isValidted;
        }

        </span><span style="color: #008000;">/*</span><span style="color: #008000;">
        /// &lt;summary&gt;
        /// 对header和payload进行base64加密
        /// &lt;/summary&gt;
        /// &lt;param name="extraHeaders"&gt;&lt;/param&gt;
        /// &lt;param name="payload"&gt;&lt;/param&gt;
        /// &lt;param name="key"&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public string Encode(IDictionary&lt;string, object&gt; extraHeaders, object payload, byte[] key)
        {
            if (payload is null)
                throw new ArgumentNullException(nameof(payload));

            var segments = new List&lt;string&gt;(3);

            var header = extraHeaders is null ? new Dictionary&lt;string, object&gt;(StringComparer.OrdinalIgnoreCase) : new Dictionary&lt;string, object&gt;(extraHeaders, StringComparer.OrdinalIgnoreCase);
            header.Add("typ", "JWT");
            header.Add("alg", _algorithm.Name);

            var headerBytes = GetBytes(_jsonSerializer.Serialize(header));
            var payloadBytes = GetBytes(_jsonSerializer.Serialize(payload));

            segments.Add(_urlEncoder.Encode(headerBytes));
            segments.Add(_urlEncoder.Encode(payloadBytes));

            var stringToSign = String.Join(".", segments.ToArray());
            var bytesToSign = GetBytes(stringToSign);

            var signature = _algorithm.Sign(key, bytesToSign);
            segments.Add(_urlEncoder.Encode(signature));

            return String.Join(".", segments.ToArray());
        }
        </span><span style="color: #008000;">*/</span><span style="color: #000000;">
    }
}</span></pre>
</div>
<p><strong>查看Token</strong></p>
<p><img src="./images/Jwt身份验证1.png" alt="" /></p>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>