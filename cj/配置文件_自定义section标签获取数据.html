<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修配置文件_自定义section标签获取数据' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>配置文件_自定义section标签获取数据</center></div><div class='banquan'>原文出处:本文由博客园博主深入学习ing提供。<br/>
原文连接:https://www.cnblogs.com/lxhbky/p/11047112.html</div><br>
    <p>　　前言：为了节约时间，先只粘贴关键代码：</p>
<p><strong>1-添加section标签，name为自定义标签名称，type为：命名空间+类型，程序集名称</strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">section </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="watchModel"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="DataCommon.Help.WatchModel,DataCommon"</span> <span style="color: #0000ff;">/&gt;</span></pre>
</div>
<p><strong>2-自定义标签数据：</strong></p>
<p><strong>　　watchModel为自定义标签（ConfigurationSection），watchItems为自定义标签的数据集（ConfigurationElementCollection）；add为数据集里的model（ConfigurationElement）。</strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">watchModel</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">watchItems</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">上   班</span><span style="color: #008000;">--&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">add </span><span style="color: #ff0000;">ID</span><span style="color: #0000ff;">="1"</span><span style="color: #ff0000;"> IsEnable</span><span style="color: #0000ff;">="true"</span><span style="color: #ff0000;"> BeginTime</span><span style="color: #0000ff;">="09:05:00"</span><span style="color: #ff0000;"> EndTime</span><span style="color: #0000ff;">="09:15:00"</span><span style="color: #ff0000;"> MaxActionTimes</span><span style="color: #0000ff;">="2"</span><span style="color: #ff0000;"> ActionSeconds</span><span style="color: #0000ff;">="120"</span><span style="color: #ff0000;"> ActionName</span><span style="color: #0000ff;">="SendTipsToDingding"</span><span style="color: #ff0000;"> ActionData</span><span style="color: #0000ff;">="shangban"</span> <span style="color: #0000ff;">/&gt;</span>
      <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">下   班</span><span style="color: #008000;">--&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">add </span><span style="color: #ff0000;">ID</span><span style="color: #0000ff;">="2"</span><span style="color: #ff0000;"> IsEnable</span><span style="color: #0000ff;">="true"</span><span style="color: #ff0000;"> BeginTime</span><span style="color: #0000ff;">="17:50:00"</span><span style="color: #ff0000;"> EndTime</span><span style="color: #0000ff;">="18:05:00"</span><span style="color: #ff0000;"> MaxActionTimes</span><span style="color: #0000ff;">="2"</span><span style="color: #ff0000;"> ActionSeconds</span><span style="color: #0000ff;">="120"</span><span style="color: #ff0000;"> ActionName</span><span style="color: #0000ff;">="SendTipsToDingding"</span><span style="color: #ff0000;"> ActionData</span><span style="color: #0000ff;">="xiaban"</span> <span style="color: #0000ff;">/&gt;</span>
      <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">每日BUG</span><span style="color: #008000;">--&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">add </span><span style="color: #ff0000;">ID</span><span style="color: #0000ff;">="3"</span><span style="color: #ff0000;"> IsEnable</span><span style="color: #0000ff;">="true"</span><span style="color: #ff0000;"> BeginTime</span><span style="color: #0000ff;">="09:10:00"</span><span style="color: #ff0000;"> EndTime</span><span style="color: #0000ff;">="09:15:00"</span><span style="color: #ff0000;"> MaxActionTimes</span><span style="color: #0000ff;">="1"</span><span style="color: #ff0000;"> ActionSeconds</span><span style="color: #0000ff;">="0"</span><span style="color: #ff0000;"> ActionName</span><span style="color: #0000ff;">="MyProjectBugTips"</span><span style="color: #ff0000;"> ActionData</span><span style="color: #0000ff;">=""</span> <span style="color: #0000ff;">/&gt;</span>
      <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">吃饭提醒</span><span style="color: #008000;">--&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">add </span><span style="color: #ff0000;">ID</span><span style="color: #0000ff;">="4"</span><span style="color: #ff0000;"> IsEnable</span><span style="color: #0000ff;">="true"</span><span style="color: #ff0000;"> BeginTime</span><span style="color: #0000ff;">="11:35:00"</span><span style="color: #ff0000;"> EndTime</span><span style="color: #0000ff;">="11:40:00"</span><span style="color: #ff0000;"> MaxActionTimes</span><span style="color: #0000ff;">="2"</span><span style="color: #ff0000;"> ActionSeconds</span><span style="color: #0000ff;">="120"</span><span style="color: #ff0000;"> ActionName</span><span style="color: #0000ff;">="SendTipsToDingding"</span><span style="color: #ff0000;"> ActionData</span><span style="color: #0000ff;">="chifan"</span> <span style="color: #0000ff;">/&gt;</span>
      <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">项目上线临时时间</span><span style="color: #008000;">--&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">add </span><span style="color: #ff0000;">ID</span><span style="color: #0000ff;">="5"</span><span style="color: #ff0000;"> IsEnable</span><span style="color: #0000ff;">="true"</span><span style="color: #ff0000;"> BeginTime</span><span style="color: #0000ff;">="14:05:00"</span><span style="color: #ff0000;"> EndTime</span><span style="color: #0000ff;">="17:15:00"</span><span style="color: #ff0000;"> MaxActionTimes</span><span style="color: #0000ff;">="10"</span><span style="color: #ff0000;"> ActionSeconds</span><span style="color: #0000ff;">="30"</span><span style="color: #ff0000;"> ActionName</span><span style="color: #0000ff;">="MyProjectBugTips"</span><span style="color: #ff0000;"> ActionData</span><span style="color: #0000ff;">="bugCheck"</span> <span style="color: #0000ff;">/&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">watchItems</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">watchModel</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p><strong>3-创建自定义标签Model：</strong></p>
<p><strong>标签分为3部分，代码也对应3个继承类：ConfigurationSection，ConfigurationElementCollection，ConfigurationElement。</strong></p>
<p><strong>类的属性和标签属性使用：ConfigurationProperty（"标签属性"）进行对应，需要对get,set方法进行改造。</strong></p>
<p><strong>集合标签：需要对key，createElement，和下标获取对象方法，进行重构。</strong></p>
<p>&nbsp;</p>
<p>常见错误-1-对象watchModel需要继承ConfigrationSection，总之每个子标签对应的model都需要继承对应的属性，并对其进行改写或重写：</p>
<p>创建 watchModel 的配置节处理程序时出错: 类型&ldquo;DataCommon.Help.WatchModel&rdquo;不从&ldquo;System.Configuration.IConfigurationSectionHandler&rdquo;继承。</p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ConfigHelper{
    </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 获取Section对象数据集
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;typeparam name="T"&gt;&lt;/typeparam&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> T GetSectionT&lt;T&gt;(<span style="color: #0000ff;">string</span> sectionName) <span style="color: #0000ff;">where</span> T : <span style="color: #0000ff;">class</span><span style="color: #000000;">
        {
            T t </span>= ConfigurationManager.GetSection(sectionName) <span style="color: #0000ff;">as</span><span style="color: #000000;"> T;
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> t;
        }
}</span></pre>
</div>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code>WatchModel watchModel = ConfigHelper.GetSectionT&lt;WatchModel&gt;(<span style="color: #800000;">"</span><span style="color: #800000;">watchModel</span><span style="color: #800000;">"</span>);</pre>
</div>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> DataCommon.Help
{
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> WatchModel : ConfigurationSection
    {
        [ConfigurationProperty(</span><span style="color: #800000;">"</span><span style="color: #800000;">watchItems</span><span style="color: #800000;">"</span><span style="color: #000000;">)]
        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> WatchItems WatchItems
        {
            </span><span style="color: #0000ff;">get</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">watchItems</span><span style="color: #800000;">"</span>] <span style="color: #0000ff;">as</span><span style="color: #000000;"> WatchItems;
            }
            </span><span style="color: #0000ff;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">watchItems</span><span style="color: #800000;">"</span>] =<span style="color: #000000;"> value;
            }
        }
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> WatchItems : ConfigurationElementCollection
    {
        </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">override</span><span style="color: #000000;"> ConfigurationElement CreateNewElement()
        {
            </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> WatchItem();
        }

        </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">object</span><span style="color: #000000;"> GetElementKey(ConfigurationElement element)
        {
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> ((WatchItem)element).ID;
        }

        </span><span style="color: #0000ff;">public</span> WatchItem <span style="color: #0000ff;">this</span>[<span style="color: #0000ff;">object</span><span style="color: #000000;"> id]
        {
            </span><span style="color: #0000ff;">get</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">return</span> (WatchItem)<span style="color: #0000ff;">base</span><span style="color: #000000;">.BaseGet(id);
            }
        }
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> WatchItem : ConfigurationElement
    {
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 唯一标识
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        [ConfigurationProperty(<span style="color: #800000;">"</span><span style="color: #800000;">ID</span><span style="color: #800000;">"</span><span style="color: #000000;">)]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> ID
        {
            </span><span style="color: #0000ff;">get</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">return</span> (<span style="color: #0000ff;">int</span>)<span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">ID</span><span style="color: #800000;">"</span><span style="color: #000000;">];
            }
            </span><span style="color: #0000ff;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">ID</span><span style="color: #800000;">"</span>] =<span style="color: #000000;"> value;
            }
        }
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 是否启用
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        [ConfigurationProperty(<span style="color: #800000;">"</span><span style="color: #800000;">IsEnable</span><span style="color: #800000;">"</span><span style="color: #000000;">)]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">bool</span><span style="color: #000000;"> IsEnable
        {
            </span><span style="color: #0000ff;">get</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">return</span> (<span style="color: #0000ff;">bool</span>)<span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">IsEnable</span><span style="color: #800000;">"</span><span style="color: #000000;">];
            }
            </span><span style="color: #0000ff;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">IsEnable</span><span style="color: #800000;">"</span>] =<span style="color: #000000;"> value;
            }
        }
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 开始时间(误差1秒=取决于计时器默认时间间隔)
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        [ConfigurationProperty(<span style="color: #800000;">"</span><span style="color: #800000;">BeginTime</span><span style="color: #800000;">"</span><span style="color: #000000;">)]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> BeginTime
        {
            </span><span style="color: #0000ff;">get</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">return</span> (<span style="color: #0000ff;">string</span>)<span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">BeginTime</span><span style="color: #800000;">"</span><span style="color: #000000;">];
            }
            </span><span style="color: #0000ff;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">BeginTime</span><span style="color: #800000;">"</span>] =<span style="color: #000000;"> value;
            }
        }
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 结束时间
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        [ConfigurationProperty(<span style="color: #800000;">"</span><span style="color: #800000;">EndTime</span><span style="color: #800000;">"</span><span style="color: #000000;">)]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> EndTime
        {
            </span><span style="color: #0000ff;">get</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">return</span> (<span style="color: #0000ff;">string</span>)<span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">EndTime</span><span style="color: #800000;">"</span><span style="color: #000000;">];
            }
            </span><span style="color: #0000ff;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">EndTime</span><span style="color: #800000;">"</span>] =<span style="color: #000000;"> value;
            }
        }
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 最大执行次数
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        [ConfigurationProperty(<span style="color: #800000;">"</span><span style="color: #800000;">MaxActionTimes</span><span style="color: #800000;">"</span><span style="color: #000000;">)]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> MaxActionTimes
        {
            </span><span style="color: #0000ff;">get</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">return</span> (<span style="color: #0000ff;">int</span>)<span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">MaxActionTimes</span><span style="color: #800000;">"</span><span style="color: #000000;">];
            }
            </span><span style="color: #0000ff;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">MaxActionTimes</span><span style="color: #800000;">"</span>] =<span style="color: #000000;"> value;
            }
        }
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 计时周期内执行的动作(动作会在到达开始时间后的)
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        [ConfigurationProperty(<span style="color: #800000;">"</span><span style="color: #800000;">ActionName</span><span style="color: #800000;">"</span><span style="color: #000000;">)]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> ActionName
        {
            </span><span style="color: #0000ff;">get</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">return</span> (<span style="color: #0000ff;">string</span>)<span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">ActionName</span><span style="color: #800000;">"</span><span style="color: #000000;">];
            }
            </span><span style="color: #0000ff;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">ActionName</span><span style="color: #800000;">"</span>] =<span style="color: #000000;"> value;
            }
        }
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 计时周期内执行的动作传入数据(动作会在到达开始时间后的)
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        [ConfigurationProperty(<span style="color: #800000;">"</span><span style="color: #800000;">ActionData</span><span style="color: #800000;">"</span><span style="color: #000000;">)]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> ActionData
        {
            </span><span style="color: #0000ff;">get</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">return</span> (<span style="color: #0000ff;">string</span>)<span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">ActionData</span><span style="color: #800000;">"</span><span style="color: #000000;">];
            }
            </span><span style="color: #0000ff;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">ActionData</span><span style="color: #800000;">"</span>] =<span style="color: #000000;"> value;
            }
        }
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 动作执行时间间隔（秒）
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        [ConfigurationProperty(<span style="color: #800000;">"</span><span style="color: #800000;">ActionSeconds</span><span style="color: #800000;">"</span><span style="color: #000000;">)]
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> ActionSeconds
        {
            </span><span style="color: #0000ff;">get</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">return</span> (<span style="color: #0000ff;">int</span>)<span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">ActionSeconds</span><span style="color: #800000;">"</span><span style="color: #000000;">];
            }
            </span><span style="color: #0000ff;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">this</span>[<span style="color: #800000;">"</span><span style="color: #800000;">ActionSeconds</span><span style="color: #800000;">"</span>] =<span style="color: #000000;"> value;
            }
        }
    }
}</span></pre>
</div>
<p>&nbsp;</p>
<p>总结：以上就是主要的代码了，中间也遇到过一些问题，上面基本上都写了，以后再补充优化吧。</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>