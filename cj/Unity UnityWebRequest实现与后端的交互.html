<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Unity UnityWebRequest实现与后端的交互' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Unity UnityWebRequest实现与后端的交互</center></div><div class='banquan'>原文出处:本文由博客园博主杰克666提供。<br/>
原文连接:https://www.cnblogs.com/jieke666/p/10839986.html</div><br>
    <p data-spm-anchor-id="a2c4e.11153940.blogcont701908.i1.689e2964MHRGxx">一般我们与后端对接的时候会用到UnityWebRequest<br data-filtered="filtered" />这里简单使用这个与后端进行交互<br data-filtered="filtered" />这个是总类</p>
<p>using UnityEngine;<br data-filtered="filtered" />using System.Collections;<br data-filtered="filtered" />using System.Collections.Generic;<br data-filtered="filtered" />using System;<br data-filtered="filtered" />using UnityEngine.Networking;</p>
<p>public enum EOPERATION<br data-filtered="filtered" />{<br data-filtered="filtered" />LOGIN = 0,//登录<br data-filtered="filtered" />REGISTER,//注册<br data-filtered="filtered" />COLLEGELIST, //学院<br data-filtered="filtered" />MAJORLIST, //专业<br data-filtered="filtered" />CLASSLIST,//班级<br data-filtered="filtered" />EXISTMAIL,//邮箱重复验证<br data-filtered="filtered" />EXISTNUMBER, //学号重复验证<br data-filtered="filtered" />GETPASSWORD,//忘记密码<br data-filtered="filtered" />ADDSCORE,//添加成绩<br data-filtered="filtered" />DownLoad,<br data-filtered="filtered" />}<br data-filtered="filtered" />public class CallBackUser<br data-filtered="filtered" />{<br data-filtered="filtered" />public bool success;<br data-filtered="filtered" />public string msg;<br data-filtered="filtered" />public User obj;<br data-filtered="filtered" />}<br data-filtered="filtered" />public class WebWork : MonoBehaviour<br data-filtered="filtered" />{<br data-filtered="filtered" />Dictionary&gt; _handers = new Dictionary&gt;();<br data-filtered="filtered" />private string filepath;<br data-filtered="filtered" />bool isStartDownload;<br data-filtered="filtered" />UnityWebRequest request;<br data-filtered="filtered" />//根据协议号获取地址后缀<br data-filtered="filtered" />Dictionary mURLs = new Dictionary{<br data-filtered="filtered" />{ EOPERATION.LOGIN,"webapi/login" },<br data-filtered="filtered" />{ EOPERATION.REGISTER,"webapi/register"},<br data-filtered="filtered" />{ EOPERATION.COLLEGELIST,"user/college/list_combo"},<br data-filtered="filtered" />{ EOPERATION.MAJORLIST,"user/major/list_combo"},<br data-filtered="filtered" />{ EOPERATION.CLASSLIST,"user/class/list_combo"},<br data-filtered="filtered" />{ EOPERATION.EXISTMAIL,"webapi/existemail"},<br data-filtered="filtered" />{ EOPERATION.EXISTNUMBER,"webapi/existnumber"},<br data-filtered="filtered" />{EOPERATION.GETPASSWORD, "webapi/forget_pass"},<br data-filtered="filtered" />{EOPERATION.ADDSCORE,"webapi/add_score"},<br data-filtered="filtered" />{EOPERATION.DownLoad,"" }<br data-filtered="filtered" />};</p>
<p>private string ipAddress = "http://192.168.40.153:8000/";</p>
<p>AccountHander accountHander = new AccountHander();</p>
<p>public object JsonConvert { get; private set; }</p>
<p>//在这里注册消息返回后分发处理<br data-filtered="filtered" />public void Init()<br data-filtered="filtered" />{<br data-filtered="filtered" />accountHander.RegisterMsg(_handers);<br data-filtered="filtered" />DontDestroyOnLoad(this);<br data-filtered="filtered" />}<br data-filtered="filtered" />///&nbsp;<br data-filtered="filtered" />/// 传输数据<br data-filtered="filtered" />///&nbsp;<br data-filtered="filtered" />///&nbsp;<br data-filtered="filtered" />///&nbsp;<br data-filtered="filtered" />public void SendPost(EOPERATION op, Dictionary dic)<br data-filtered="filtered" />{<br data-filtered="filtered" />//根据协议号获取完整路径<br data-filtered="filtered" />string url = ipAddress + mURLs[op];<br data-filtered="filtered" />StartCoroutine(Post(url, dic, op));<br data-filtered="filtered" />}</p>
<p>///&nbsp;<br data-filtered="filtered" />/// 获取数据<br data-filtered="filtered" />///&nbsp;<br data-filtered="filtered" />///&nbsp;<br data-filtered="filtered" />public void SendGet(EOPERATION op, string name = "")<br data-filtered="filtered" />{<br data-filtered="filtered" />string url = ipAddress + mURLs[op] + "/" + name;<br data-filtered="filtered" />StartCoroutine(Get(url, op, name));<br data-filtered="filtered" />}<br data-filtered="filtered" />///&nbsp;<br data-filtered="filtered" />/// 获取下载进度<br data-filtered="filtered" />///&nbsp;<br data-filtered="filtered" />///&nbsp;<br data-filtered="filtered" />public float GetProgress()<br data-filtered="filtered" />{<br data-filtered="filtered" />if (request == null || !isStartDownload)<br data-filtered="filtered" />return 0;<br data-filtered="filtered" />return request.downloadProgress;<br data-filtered="filtered" />}</p>
<p>private IEnumerator Get(string url, EOPERATION op, string name)<br data-filtered="filtered" />{</p>
<p>if (!string.IsNullOrEmpty(url))<br data-filtered="filtered" />{<br data-filtered="filtered" />using (request = UnityWebRequest.Get(url))<br data-filtered="filtered" />{<br data-filtered="filtered" />isStartDownload = true;<br data-filtered="filtered" />//设置超时 链接超时返回 且isNetworkError为true<br data-filtered="filtered" />request.timeout = 30;<br data-filtered="filtered" />yield return request.SendWebRequest();<br data-filtered="filtered" />isStartDownload = false;<br data-filtered="filtered" />//结果回传给具体实现<br data-filtered="filtered" />if (request.isHttpError || request.isNetworkError)<br data-filtered="filtered" />{<br data-filtered="filtered" />Debug.Log(request.error);<br data-filtered="filtered" />}<br data-filtered="filtered" />else<br data-filtered="filtered" />{<br data-filtered="filtered" />_handers<a href="https://yq.aliyun.com/articles/name," target="_blank">op</a>;<br data-filtered="filtered" />}<br data-filtered="filtered" />};<br data-filtered="filtered" />}<br data-filtered="filtered" />}<br data-filtered="filtered" />//private WWW http;<br data-filtered="filtered" />private IEnumerator Post(string url, Dictionary dic, EOPERATION op)<br data-filtered="filtered" />{<br data-filtered="filtered" />if (!string.IsNullOrEmpty(url))<br data-filtered="filtered" />{<br data-filtered="filtered" />WWWForm form = new WWWForm();</p>
<p>foreach (var item in dic)<br data-filtered="filtered" />{<br data-filtered="filtered" />form.AddField(item.Key, item.Value);<br data-filtered="filtered" />}<br data-filtered="filtered" />using (request = UnityWebRequest.Post(url, form))<br data-filtered="filtered" />{<br data-filtered="filtered" />yield return request.SendWebRequest();<br data-filtered="filtered" />//结果回传给具体实现<br data-filtered="filtered" />if (request.isHttpError || request.isNetworkError)<br data-filtered="filtered" />{<br data-filtered="filtered" />Debug.Log(request.error);<br data-filtered="filtered" />}<br data-filtered="filtered" />else<br data-filtered="filtered" />{<br data-filtered="filtered" />_handers<a href="https://yq.aliyun.com/articles/name," target="_blank">op</a>;<br data-filtered="filtered" />}<br data-filtered="filtered" />}<br data-filtered="filtered" />}<br data-filtered="filtered" />}<br data-filtered="filtered" />}<br data-filtered="filtered" />工具类</p>
<p>using System.IO;</p>
<p>public class FileTool<br data-filtered="filtered" />{<br data-filtered="filtered" />///&nbsp;<br data-filtered="filtered" />/// 创建文件<br data-filtered="filtered" />///&nbsp;<br data-filtered="filtered" />public static void CreateFile(string filePath,byte[]bytes)<br data-filtered="filtered" />{<br data-filtered="filtered" />using (FileStream fs = new FileStream(filePath,FileMode.Create,FileAccess.Write))<br data-filtered="filtered" />{<br data-filtered="filtered" />fs.Write(bytes, 0, bytes.Length);<br data-filtered="filtered" />}&nbsp;<br data-filtered="filtered" />}<br data-filtered="filtered" />}</p>
<p>消息返回处理类 这只是一个分类</p>
<p>using Newtonsoft.Json;<br data-filtered="filtered" />using System;<br data-filtered="filtered" />using System.Collections.Generic;<br data-filtered="filtered" />using UnityEngine;<br data-filtered="filtered" />using UnityEngine.Networking;</p>
<p>public class AccountHander<br data-filtered="filtered" />{</p>
<p>public void RegisterMsg(Dictionary&gt; handers)<br data-filtered="filtered" />{<br data-filtered="filtered" />handers.Add(EOPERATION.LOGIN, OnRspLogin);<br data-filtered="filtered" />handers.Add(EOPERATION.REGISTER, OnRspRegister);<br data-filtered="filtered" />handers.Add(EOPERATION.DownLoad, OnRspDownLoad);<br data-filtered="filtered" />}</p>
<p>private void OnRspLogin(string name,DownloadHandler data)<br data-filtered="filtered" />{<br data-filtered="filtered" />//用Json转化为类内部数据<br data-filtered="filtered" />JsonConvert.DeserializeObject(data.text);</p>
<p>}<br data-filtered="filtered" />private void OnRspRegister(string name,DownloadHandler data)<br data-filtered="filtered" />{</p>
<p>}</p>
<p>private void OnRspDownLoad(string name,DownloadHandler data)<br data-filtered="filtered" />{<br data-filtered="filtered" />//data.data二进制的文件 视频 图片的信息<br data-filtered="filtered" />FileTool.CreateFile(name, data.data);<br data-filtered="filtered" />}</p>
<p>}</p>
<p>public void RegisterMsg(Dictionary&gt; handers)<br data-filtered="filtered" />{</p>
<p>}<br data-filtered="filtered" />如果想添加一个新的就在主类Init里注册 然后新类写一个注册方法就行了 这样会自动根据枚举转到相应的处理函数<br data-filtered="filtered" />然后name的话只是为了区分下载文件起码要改名吧 不然不知道名字 如果只是传数据可以无视name不调用<br data-filtered="filtered" />来用一个demo使用下</p>
<p>更多unity2018的功能介绍请到paws3d爪爪学院查找。</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>